import{j as e,r as l,L as S,bz as _,W as I,bP as A}from"./vendor-DTXcECKj.js";import{g as P,B as f,L as y}from"./main-D_qbY1gz.js";import{C as R,a as T,b as U,c as L,d as M}from"./Card-ovhP7agJ.js";import{H as O,u as E,e as F}from"./HostedLayout-DYymfZHG.js";import{u as H,m as d}from"./vendor-motion-DirI8ZVJ.js";import"./vendor-sonner-CauEFWQC.js";import"./vendor-sentry-DWdptYQI.js";function G(){return e.jsx(O,{searchParams:new URLSearchParams(window.location.search),children:e.jsx(W,{})})}function W(){const v=P(),{config:u,tenantId:r,redirectUrl:i}=E(),m=H(),[t,a]=l.useState("processing"),[w,c]=l.useState(null),[n,N]=l.useState(!1),[x,C]=l.useState(null);if(l.useEffect(()=>{const o=new URLSearchParams(window.location.search),g=o.get("code"),h=o.get("state"),p=o.get("error"),k=o.get("error_description");if(p){a("error"),c(k||`OAuth error: ${p}`);return}if(!r){a("error"),c("Missing tenant_id parameter");return}if(!g||!h){a("error"),c("Invalid OAuth callback: missing code or state");return}const j=sessionStorage.getItem("hosted_oauth_state");if(j&&j!==h){a("error"),c("Invalid state parameter. Possible CSRF attack.");return}sessionStorage.removeItem("hosted_oauth_state"),(async()=>{try{const s=await F({data:{code:g,state:h,tenantId:r,redirectUrl:i||void 0}});if(s.requiresMfa&&s.mfaToken){sessionStorage.removeItem("hosted_session_token"),N(!0),C(s.mfaToken),a("success");return}s.sessionToken&&sessionStorage.setItem("hosted_session_token",s.sessionToken),a("success"),setTimeout(()=>{window.location.href=s.redirectUrl},1500)}catch(s){a("error"),c(s instanceof Error?s.message:"OAuth authentication failed")}})()},[r,i]),!u||!r)return null;const b=()=>{if(n&&x)v({to:"/hosted/mfa",search:{tenant_id:r,mfa_token:x,redirect_url:i||void 0}});else{const o=i||u.afterSignInUrl||"/hosted/sign-in";window.location.href=o}};return e.jsxs(R,{className:"shadow-elevated",children:[e.jsxs(T,{className:"space-y-1",children:[e.jsxs(U,{className:"text-2xl text-center",children:[t==="processing"&&"Completing Sign In...",t==="success"&&n&&"Additional Verification Required",t==="success"&&!n&&"Sign In Successful!",t==="error"&&"Sign In Failed"]}),e.jsxs(L,{className:"text-center",children:[t==="processing"&&"Please wait while we complete the authentication...",t==="success"&&n&&"Please verify your identity to continue.",t==="success"&&!n&&"Redirecting you to your account...",t==="error"&&"We couldn't complete the sign in process."]})]}),e.jsxs(M,{className:"space-y-6",children:[t==="processing"&&e.jsxs(d.div,{initial:m?!1:{opacity:0},animate:{opacity:1},className:"flex flex-col items-center py-8",children:[e.jsx("div",{className:"w-16 h-16 bg-primary/10 rounded-full flex items-center justify-center mb-4",children:e.jsx(S,{className:"w-8 h-8 text-primary animate-spin"})}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Exchanging authorization code..."})]}),t==="success"&&e.jsxs(d.div,{initial:m?!1:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"text-center space-y-6 py-4",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 dark:bg-green-900/20 rounded-full flex items-center justify-center mx-auto",children:e.jsx(_,{className:"w-8 h-8 text-green-600 dark:text-green-400"})}),n?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"For added security, we need to verify your identity with multi-factor authentication."}),e.jsx(f,{onClick:b,fullWidth:!0,rightIcon:e.jsx(I,{className:"h-4 w-4"}),children:"Continue to Verification"})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"You're being redirected to your account..."}),e.jsx("div",{className:"w-full bg-muted rounded-full h-2 overflow-hidden",children:e.jsx(d.div,{initial:{width:"0%"},animate:{width:"100%"},transition:{duration:1.5,ease:"easeInOut"},className:"h-full bg-primary"})})]})]}),t==="error"&&e.jsxs(d.div,{initial:m?!1:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"text-center space-y-6 py-4",children:[e.jsx("div",{className:"w-16 h-16 bg-destructive/10 rounded-full flex items-center justify-center mx-auto",children:e.jsx(A,{className:"w-8 h-8 text-destructive"})}),e.jsx("div",{className:"bg-destructive/5 border border-destructive/20 rounded-lg p-4",children:e.jsx("p",{className:"text-sm text-destructive",children:w||"An unexpected error occurred"})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(y,{to:"/hosted/sign-in",search:{tenant_id:r,redirect_url:i||void 0},className:"block",children:e.jsx(f,{fullWidth:!0,children:"Try Again"})}),u.allowSignUp&&e.jsx(y,{to:"/hosted/sign-up",search:{tenant_id:r,redirect_url:i||void 0},className:"block",children:e.jsx(f,{variant:"outline",fullWidth:!0,children:"Create Account"})})]})]})]})]})}export{G as component};
