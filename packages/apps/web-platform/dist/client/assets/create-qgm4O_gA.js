import{j as e,r as i,bz as S,W as h,B as x,bt as O,bO as k}from"./vendor-DTXcECKj.js";import{f as I,B as f,j as L,l as B,L as F}from"./main-D_qbY1gz.js";import{I as T}from"./Input-CvXUl1_l.js";import{C as p,d as j,a as A,b as R,c as H}from"./Card-ovhP7agJ.js";import{H as U,u as V,j as q}from"./HostedLayout-DYymfZHG.js";import{u as E,m as P}from"./vendor-motion-DirI8ZVJ.js";import"./vendor-sonner-CauEFWQC.js";import"./vendor-sentry-DWdptYQI.js";function Q(){return e.jsx(U,{searchParams:new URLSearchParams(window.location.search),children:e.jsx(_,{})})}function _(){const{config:d,tenantId:n,redirectUrl:u}=V(),b=E(),[o,m]=i.useState(!1),[g,l]=i.useState(null),[N,v]=i.useState(!1),[c,C]=i.useState(null),w=()=>sessionStorage.getItem("hosted_session_token")||"",a=I({defaultValues:{name:"",slug:""},onSubmit:async({value:t})=>{if(!n)return;const s=w();if(!s){l("You must be signed in to create an organization");return}m(!0),l(null);try{const r=await q({data:{name:t.name,slug:t.slug,tenantId:n,sessionToken:s}});C({name:r.name,slug:r.slug}),v(!0)}catch(r){l(r instanceof Error?r.message:"Failed to create organization")}finally{m(!1)}}}),y=t=>{a.setFieldValue("name",t);const s=a.getFieldValue("slug"),r=t.toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").slice(0,50);(!s||s===a.getFieldValue("name").toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").slice(0,50))&&a.setFieldValue("slug",r)};if(!d||!n)return null;const z=()=>{const t=u||d.afterSignInUrl||"/dashboard";window.location.href=t};return N&&c?e.jsx(p,{className:"shadow-elevated",children:e.jsx(j,{className:"pt-6",children:e.jsxs(P.div,{initial:b?!1:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"text-center space-y-6 py-8",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 dark:bg-green-900/20 rounded-full flex items-center justify-center mx-auto",children:e.jsx(S,{className:"w-8 h-8 text-green-600 dark:text-green-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold",children:"Organization created!"}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-2",children:[e.jsx("strong",{children:c.name})," has been created successfully."]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Organization slug: ",c.slug]})]}),e.jsx(f,{onClick:z,fullWidth:!0,rightIcon:e.jsx(h,{className:"h-4 w-4"}),children:"Continue"})]})})}):e.jsxs(p,{className:"shadow-elevated",children:[e.jsxs(A,{className:"space-y-1",children:[e.jsx("div",{className:"mx-auto w-12 h-12 bg-primary/10 rounded-full flex items-center justify-center mb-2",children:e.jsx(x,{className:"h-6 w-6 text-primary"})}),e.jsx(R,{className:"text-2xl text-center",children:"Create Organization"}),e.jsx(H,{className:"text-center",children:"Set up a new organization for your team"})]}),e.jsxs(j,{className:"space-y-4",children:[g&&e.jsxs(L,{variant:"destructive",children:[e.jsx(O,{className:"h-4 w-4"}),e.jsx(B,{children:g})]}),e.jsxs("form",{onSubmit:t=>{t.preventDefault(),t.stopPropagation(),a.handleSubmit()},className:"space-y-4",children:[e.jsx(a.Field,{name:"name",validators:{onChange:({value:t})=>{if(!t.trim())return"Organization name is required";if(t.trim().length<2)return"Name must be at least 2 characters";if(t.trim().length>50)return"Name must be less than 50 characters"}},children:t=>e.jsx(T,{label:"Organization Name",type:"text",placeholder:"Acme Inc.",value:t.state.value,onChange:s=>y(s.target.value),onBlur:t.handleBlur,error:t.state.meta.isTouched?t.state.meta.errors[0]:void 0,leftIcon:e.jsx(x,{className:"h-4 w-4 text-muted-foreground"}),autoComplete:"organization",required:!0,disabled:o})}),e.jsx(a.Field,{name:"slug",validators:{onChange:({value:t})=>{if(!t.trim())return"Organization slug is required";if(!/^[a-z0-9-]+$/.test(t))return"Slug can only contain lowercase letters, numbers, and hyphens";if(t.length<2)return"Slug must be at least 2 characters";if(t.length>50)return"Slug must be less than 50 characters"}},children:t=>e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("label",{className:"text-sm font-medium text-foreground",children:["Organization Slug",e.jsx("span",{className:"text-destructive ml-1",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground text-sm",children:"/"}),e.jsx("input",{type:"text",value:t.state.value,onChange:s=>t.handleChange(s.target.value.toLowerCase().replace(/[^a-z0-9-]/g,"")),onBlur:t.handleBlur,placeholder:"acme-inc",className:`flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 pl-6 text-sm ring-offset-background transition-colors transition-shadow duration-200 placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 hover:border-muted-foreground/30 ${t.state.meta.isTouched&&t.state.meta.errors[0]?"border-destructive focus-visible:ring-destructive":""}`,required:!0,disabled:o})]}),t.state.meta.isTouched&&t.state.meta.errors[0]&&e.jsx("p",{className:"text-sm text-destructive animate-fade-in",children:t.state.meta.errors[0]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"This will be used in URLs and cannot be changed later"})]})}),e.jsx(f,{type:"submit",fullWidth:!0,size:"lg",isLoading:o,rightIcon:e.jsx(h,{className:"h-4 w-4"}),children:"Create Organization"})]}),e.jsx("div",{className:"text-center pt-4 border-t",children:e.jsxs(F,{to:"/hosted/organization/switch",search:{tenant_id:n,redirect_url:u||void 0},className:"inline-flex items-center gap-2 text-sm text-muted-foreground hover:text-foreground transition-colors",children:[e.jsx(k,{className:"h-4 w-4"}),"Back to Organizations"]})})]})]})}export{Q as component};
