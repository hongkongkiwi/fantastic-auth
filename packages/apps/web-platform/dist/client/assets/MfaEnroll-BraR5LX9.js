import{r as i,bX as D,by as L,m as I,j as e,cn as B,a5 as u,cb as v,bD as M}from"./vendor-DTXcECKj.js";import{B as a}from"./main-D_qbY1gz.js";import{I as O}from"./Input-CvXUl1_l.js";import{A as U,m as l}from"./vendor-motion-DirI8ZVJ.js";import"./vendor-sonner-CauEFWQC.js";import"./vendor-sentry-DWdptYQI.js";function q({method:c,onEnroll:N,onCancel:h}){const[n,o]=i.useState("intro"),[d,C]=i.useState(""),[f,j]=i.useState(!1),[k,m]=i.useState(""),[s,w]=i.useState(null),[y,S]=i.useState(!1),[E,R]=i.useState(!1);i.useEffect(()=>{c==="totp"&&n==="setup"&&fetch("/api/v1/auth/mfa/totp/enroll",{method:"POST"}).then(t=>t.json()).then(t=>w(t)).catch(()=>m("Failed to generate TOTP secret"))},[c,n]);const T=async()=>{j(!0),m("");try{await N(d),c==="totp"&&o("backup")}catch(t){m(t instanceof Error?t.message:"Invalid code")}finally{j(!1)}},g=(t,r)=>{navigator.clipboard.writeText(t),r(!0),setTimeout(()=>r(!1),2e3)},V=()=>{if(!s)return;const t=s.backup_codes.join(`
`),r=new Blob([t],{type:"text/plain"}),b=URL.createObjectURL(r),p=document.createElement("a");p.href=b,p.download="vault-backup-codes.txt",p.click(),URL.revokeObjectURL(b)},x={totp:{icon:I,title:"Authenticator App",description:"Use an app like Google Authenticator, Authy, or 1Password"},email:{icon:L,title:"Email Verification",description:"Receive codes via email"},sms:{icon:D,title:"SMS Verification",description:"Receive codes via text message"}}[c],A=x.icon;return e.jsx("div",{className:"w-full max-w-md mx-auto",children:e.jsxs(U,{mode:"wait",children:[n==="intro"&&e.jsxs(l.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"text-center space-y-6",children:[e.jsx("div",{className:"w-16 h-16 bg-primary/10 rounded-full flex items-center justify-center mx-auto",children:e.jsx(A,{className:"w-8 h-8 text-primary"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold",children:x.title}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:x.description})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(a,{variant:"outline",onClick:h,className:"flex-1",children:"Cancel"}),e.jsx(a,{onClick:()=>o("setup"),className:"flex-1",children:"Continue"})]})]},"intro"),n==="setup"&&c==="totp"&&s&&e.jsxs(l.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Scan QR Code"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Open your authenticator app and scan this code"})]}),e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"p-4 bg-white rounded-lg",children:e.jsx(B,{value:s.qr_uri,size:200})})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs text-center text-muted-foreground",children:"Can't scan? Enter this code manually:"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("code",{className:"flex-1 p-2 bg-muted rounded text-center text-sm font-mono",children:s.secret}),e.jsx(a,{variant:"ghost",size:"icon","aria-label":y?"Secret copied":"Copy setup secret",onClick:()=>g(s.secret,S),children:y?e.jsx(u,{className:"h-4 w-4"}):e.jsx(v,{className:"h-4 w-4"})})]})]}),e.jsx(a,{onClick:()=>o("verify"),fullWidth:!0,children:"I've scanned the code"})]},"setup"),n==="verify"&&e.jsxs(l.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Verify Setup"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Enter the 6-digit code from your ",c==="totp"?"authenticator app":c]})]}),e.jsx("div",{className:"space-y-2",children:e.jsx(O,{type:"text",placeholder:"000000",value:d,onChange:t=>C(t.target.value.replace(/\D/g,"").slice(0,6)),className:"text-center text-2xl tracking-widest font-mono",maxLength:6,name:"verificationCode",autoComplete:"one-time-code",inputMode:"numeric","aria-label":"Verification code",error:k})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(a,{variant:"outline",onClick:()=>o(c==="totp"?"setup":"intro"),className:"flex-1",children:"Back"}),e.jsx(a,{onClick:T,disabled:d.length!==6||f,className:"flex-1",isLoading:f,children:"Verify"})]})]},"verify"),n==="backup"&&s&&e.jsxs(l.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 bg-green-100 dark:bg-green-900/20 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(u,{className:"w-6 h-6 text-green-600 dark:text-green-400"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"MFA Enabled!"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Save these backup codes in a safe place"})]}),e.jsxs("div",{className:"bg-amber-50 dark:bg-amber-900/10 border border-amber-200 dark:border-amber-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-xs text-amber-800 dark:text-amber-200 mb-3",children:"⚠️ These codes can be used to access your account if you lose your authenticator device. Each code can only be used once."}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:s.backup_codes.map(t=>e.jsx("code",{className:"text-sm font-mono text-center",children:t},t))})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(a,{variant:"outline",onClick:()=>g(s.backup_codes.join(`
`),R),className:"flex-1 gap-2",children:[E?e.jsx(u,{className:"h-4 w-4"}):e.jsx(v,{className:"h-4 w-4"}),"Copy Codes"]}),e.jsxs(a,{variant:"outline",onClick:V,className:"flex-1 gap-2",children:[e.jsx(M,{className:"h-4 w-4"}),"Download"]})]}),e.jsx(a,{onClick:h,fullWidth:!0,children:"Done"})]},"backup")]})})}export{q as MfaEnroll};
