import{r as o,j as e,bz as O,by as E,W as T,m as M,D as C,bA as P,bB as _,ab as q}from"./vendor-DTXcECKj.js";import{f as L,B as N,g as F,h as D,i as y,A as H}from"./main-D_qbY1gz.js";import{I as j}from"./Input-CvXUl1_l.js";import{C as R,a as U,b as V,c as z,d as G}from"./Card-ovhP7agJ.js";import{T as W,a as $,b as S,c as k}from"./Tabs-B49fZEnE.js";import{m as n,u as J}from"./vendor-motion-DirI8ZVJ.js";import{S as Y}from"./SocialLoginButtons-DGrqqYSa.js";import{c as Z}from"./client-logger-BYl5UQzQ.js";import"./vendor-sonner-CauEFWQC.js";import"./vendor-sentry-DWdptYQI.js";import"./logger-BML-1mmb.js";function K({onSuccess:v}){const[c,u]=o.useState(!1),[l,h]=o.useState(!1),[w,d]=o.useState(""),[x,p]=o.useState(""),m=L({defaultValues:{email:""},onSubmit:async({value:s})=>{d(""),u(!0);try{const r=await fetch("/api/v1/auth/magic-link",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:s.email})});if(!r.ok){const b=await r.json();throw new Error(b.error?.message||"Failed to send magic link")}p(s.email),h(!0),v?.()}catch(r){d(r instanceof Error?r.message:"An error occurred")}finally{u(!1)}}});return l?e.jsxs(n.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"text-center space-y-4 py-8",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 dark:bg-green-900/20 rounded-full flex items-center justify-center mx-auto",children:e.jsx(O,{className:"w-8 h-8 text-green-600 dark:text-green-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Check your email"}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["We've sent a magic link to ",e.jsx("strong",{children:x})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"Link expires in 15 minutes"})]}),e.jsx(N,{variant:"ghost",size:"sm",onClick:()=>{h(!1),p(""),m.reset()},children:"Use a different email"})]}):e.jsxs("form",{onSubmit:s=>{s.preventDefault(),s.stopPropagation(),m.handleSubmit()},className:"space-y-4",children:[e.jsx("div",{className:"space-y-2",children:e.jsx(m.Field,{name:"email",validators:{onChange:({value:s})=>{if(!s.trim())return"Email is required";if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s))return"Please enter a valid email"}},children:s=>e.jsx(j,{label:"Email",type:"email",placeholder:"you@example.com",value:s.state.value,onChange:r=>s.handleChange(r.target.value),onBlur:s.handleBlur,leftIcon:e.jsx(E,{className:"h-4 w-4 text-muted-foreground"}),name:"email",autoComplete:"email",autoCapitalize:"none",spellCheck:!1,required:!0,disabled:c,error:w||(s.state.meta.isTouched?s.state.meta.errors[0]:void 0)})})}),e.jsx(N,{type:"submit",fullWidth:!0,isLoading:c,rightIcon:e.jsx(T,{className:"h-4 w-4"}),children:c?"Sending…":"Send Magic Link"}),e.jsx("p",{className:"text-xs text-center text-muted-foreground",children:"You'll receive an email with a secure link to sign in instantly"})]})}function ce(){const v=F(),{login:c,isAuthenticated:u}=D(),[l,h]=o.useState(!1),[w,d]=o.useState(!1),[x,p]=o.useState("password"),[m,s]=o.useState(null),[r,b]=o.useState(!1),[A,B]=o.useState(void 0),t=J(),f=L({defaultValues:{email:"",password:"",mfaCode:""},onSubmit:async({value:a})=>{d(!0);try{await c(a.email,a.password,r&&a.mfaCode||void 0,A)}catch(i){if(i instanceof H){b(!0),B(i.mfaToken);return}throw i}finally{d(!1)}}});if(u)return v({to:"/"}),null;const g=async a=>{s(a);try{const i=await fetch(`/api/v1/auth/oauth/${a}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({redirectUri:window.location.origin+"/oauth/callback"})});if(!i.ok)throw new Error("Failed to initiate OAuth");const{authUrl:I}=await i.json();window.location.href=I}catch(i){Z.error("OAuth error",i)}finally{s(null)}};return e.jsxs("div",{className:"min-h-screen flex items-center justify-center p-4 bg-gradient-to-br from-background via-background to-muted",children:[e.jsxs("div",{className:"fixed inset-0 overflow-hidden pointer-events-none",children:[e.jsx("div",{className:"absolute -top-1/2 -right-1/2 w-full h-full bg-primary/5 rounded-full blur-3xl"}),e.jsx("div",{className:"absolute -bottom-1/2 -left-1/2 w-full h-full bg-secondary/5 rounded-full blur-3xl"})]}),e.jsxs(n.div,{initial:t?!1:{opacity:0,y:20},animate:{opacity:1,y:0},transition:t?{duration:0}:{duration:.5},className:"w-full max-w-md relative z-10",children:[e.jsx("div",{className:"flex justify-center mb-8",children:e.jsxs(n.div,{initial:t?!1:{scale:.8},animate:{scale:1},transition:t?{duration:0}:{delay:.2,type:"spring"},className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-12 w-12 rounded-xl bg-primary flex items-center justify-center shadow-glow",children:e.jsx(M,{className:"h-7 w-7 text-primary-foreground"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Vault"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Admin Console"})]})]})}),e.jsxs(R,{className:"shadow-elevated",children:[e.jsxs(U,{className:"space-y-1",children:[e.jsx(V,{className:"text-2xl text-center",children:"Welcome back"}),e.jsx(z,{className:"text-center",children:"Sign in to access your admin panel"})]}),e.jsx(G,{children:e.jsxs(W,{value:x,onValueChange:a=>p(a),className:"mb-6",children:[e.jsxs($,{className:"grid w-full grid-cols-2",children:[e.jsxs(S,{value:"password",className:"gap-2",children:[e.jsx(C,{className:"h-4 w-4"}),"Password"]}),e.jsxs(S,{value:"magic-link",className:"gap-2",children:[e.jsx(P,{className:"h-4 w-4"}),"Magic Link"]})]}),e.jsxs(k,{value:"password",className:"mt-4",children:[e.jsxs("form",{onSubmit:a=>{a.preventDefault(),a.stopPropagation(),f.handleSubmit()},className:"space-y-4",children:[e.jsx(n.div,{initial:t?!1:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:t?{duration:0}:{delay:.3},children:e.jsx(f.Field,{name:"email",validators:{onChange:({value:a})=>{if(!a.trim())return"Email is required";if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a))return"Please enter a valid email"}},children:a=>e.jsx(j,{label:"Email",type:"email",placeholder:"admin@vault.local",value:a.state.value,onChange:i=>a.handleChange(i.target.value),onBlur:a.handleBlur,error:a.state.meta.isTouched?a.state.meta.errors[0]:void 0,leftIcon:e.jsx(E,{className:"h-4 w-4 text-muted-foreground"}),autoComplete:"email",autoCapitalize:"none",spellCheck:!1,required:!0})})}),e.jsx(n.div,{initial:t?!1:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:t?{duration:0}:{delay:.4},children:e.jsx("div",{className:"relative",children:e.jsx(f.Field,{name:"password",validators:{onChange:({value:a})=>{if(x==="password"&&!a)return"Password is required"}},children:a=>e.jsx(j,{label:"Password",type:l?"text":"password",placeholder:"••••••••",value:a.state.value,onChange:i=>a.handleChange(i.target.value),onBlur:a.handleBlur,error:a.state.meta.isTouched?a.state.meta.errors[0]:void 0,leftIcon:e.jsx(C,{className:"h-4 w-4 text-muted-foreground"}),autoComplete:"current-password",rightIcon:e.jsx("button",{type:"button",onClick:()=>h(!l),className:"text-muted-foreground hover:text-foreground transition-colors","aria-label":l?"Hide password":"Show password",children:l?e.jsx(_,{className:"h-4 w-4"}):e.jsx(q,{className:"h-4 w-4"})}),required:!0})})})}),r&&e.jsx("p",{className:"text-sm text-muted-foreground",children:"Multi-factor authentication is required. Enter your verification code to continue."}),r&&e.jsx(n.div,{initial:t?!1:{opacity:0,y:20},animate:{opacity:1,y:0},transition:t?{duration:0}:{delay:.5},children:e.jsx(f.Field,{name:"mfaCode",children:a=>e.jsx(j,{label:"2FA Code",type:"text",placeholder:"123456",value:a.state.value,onChange:i=>a.handleChange(i.target.value),onBlur:a.handleBlur,autoComplete:"one-time-code",inputMode:"numeric",required:r})})}),e.jsxs(n.div,{initial:t?!1:{opacity:0,y:20},animate:{opacity:1,y:0},transition:t?{duration:0}:{delay:.55},className:"flex items-center justify-between text-sm",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"rounded border-input"}),e.jsx("span",{className:"text-muted-foreground",children:"Remember me"})]}),e.jsx("a",{href:"#",className:"text-primary hover:underline",children:"Forgot password?"})]}),e.jsx(n.div,{initial:t?!1:{opacity:0,y:20},animate:{opacity:1,y:0},transition:t?{duration:0}:{delay:.6},children:e.jsx(N,{type:"submit",fullWidth:!0,size:"lg",isLoading:w,rightIcon:e.jsx(T,{className:"h-4 w-4"}),children:"Sign In"})})]}),e.jsx(n.div,{initial:t?!1:{opacity:0},animate:{opacity:1},transition:t?{duration:0}:{delay:.7},className:"mt-6",children:e.jsx(Y,{onGoogleClick:y.VITE_OAUTH_GOOGLE_ENABLED==="true"?()=>g("google"):void 0,onGitHubClick:y.VITE_OAUTH_GITHUB_ENABLED==="true"?()=>g("github"):void 0,onMicrosoftClick:y.VITE_OAUTH_MICROSOFT_ENABLED==="true"?()=>g("microsoft"):void 0,onAppleClick:y.VITE_OAUTH_APPLE_ENABLED==="true"?()=>g("apple"):void 0,isLoading:!!m})})]}),e.jsx(k,{value:"magic-link",className:"mt-4",children:e.jsx(K,{})})]})})]}),e.jsx(n.p,{initial:t?!1:{opacity:0},animate:{opacity:1},transition:t?{duration:0}:{delay:.9},className:"text-center text-sm text-muted-foreground mt-6",children:"Protected by industry-standard encryption"})]})]})}export{ce as component};
