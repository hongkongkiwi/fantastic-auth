import{j as e,r as d,bt as N,D as E,bA as P,bQ as _,by as v,bB as R,ab as V,W as $}from"./vendor-DTXcECKj.js";import{g as z,f as S,j as L,l as M,B as w,L as I}from"./main-D_qbY1gz.js";import{I as f}from"./Input-CvXUl1_l.js";import{C as G,a as Q,b as Y,c as Z,d as J}from"./Card-ovhP7agJ.js";import{T as K,a as X,b as A,c as F}from"./Tabs-B49fZEnE.js";import{H as ee,u as se,c as ae,d as te,b as re}from"./HostedLayout-DYymfZHG.js";import{S as ne}from"./SocialLoginButtons-DGrqqYSa.js";import{u as oe,m as ie}from"./vendor-motion-DirI8ZVJ.js";import"./vendor-sonner-CauEFWQC.js";import"./vendor-sentry-DWdptYQI.js";function be(){return e.jsx(ee,{searchParams:new URLSearchParams(window.location.search),children:e.jsx(le,{})})}function le(){const i=z(),{config:t,tenantId:a,redirectUrl:n,error:g}=se(),m=oe(),[s,l]=d.useState(!1),[x,p]=d.useState(!1),[b,c]=d.useState(null),[B,q]=d.useState("password"),[W,y]=d.useState(null),[U,D]=d.useState(!1),[j,H]=d.useState(!1),C=S({defaultValues:{email:"",password:"",mfaCode:""},onSubmit:async({value:o})=>{if(a){p(!0),c(null);try{const r=await ae({data:{email:o.email,password:o.password,mfaCode:j?o.mfaCode:void 0,tenantId:a,redirectUrl:n||void 0}});if(r.requiresMfa&&r.mfaToken){sessionStorage.removeItem("hosted_session_token"),i({to:"/hosted/mfa",search:{tenant_id:a,mfa_token:r.mfaToken,redirect_url:n||void 0}});return}if(r.requiresMfa){sessionStorage.removeItem("hosted_session_token"),H(!0),c("Enter your MFA code to continue");return}r.sessionToken&&sessionStorage.setItem("hosted_session_token",r.sessionToken),window.location.href=r.redirectUrl}catch(r){c(r instanceof Error?r.message:"Sign in failed")}finally{p(!1)}}}}),k=S({defaultValues:{email:""},onSubmit:async({value:o})=>{if(a){p(!0),c(null);try{await te({data:{email:o.email,tenantId:a,redirectUrl:n||void 0}}),D(!0)}catch(r){c(r instanceof Error?r.message:"Failed to send magic link")}finally{p(!1)}}}}),h=async o=>{if(a){y(o),c(null);try{const r=await re({data:{provider:o,tenantId:a,redirectUrl:n||void 0}});sessionStorage.setItem("hosted_oauth_state",r.state),window.location.href=r.authUrl}catch(r){c(r instanceof Error?r.message:"OAuth failed"),y(null)}}},O=async()=>{c("WebAuthn coming soon")};if(!t||!a)return null;const u=t.oauthProviders.filter(o=>["google","github","apple","slack","discord"].includes(o));return e.jsxs(G,{className:"shadow-elevated",children:[e.jsxs(Q,{className:"space-y-1",children:[e.jsx(Y,{className:"text-2xl text-center",children:t.signInTitle||`Sign in to ${t.companyName}`}),e.jsx(Z,{className:"text-center",children:"Enter your credentials to access your account"})]}),e.jsxs(J,{className:"space-y-4",children:[b&&e.jsxs(L,{variant:"destructive",children:[e.jsx(N,{className:"h-4 w-4"}),e.jsx(M,{children:b})]}),g&&e.jsxs(L,{variant:"destructive",children:[e.jsx(N,{className:"h-4 w-4"}),e.jsx(M,{children:g})]}),u.length>0&&e.jsx(ie.div,{initial:m?!1:{opacity:0},animate:{opacity:1},transition:m?{duration:0}:{delay:.1},children:e.jsx(ne,{onGoogleClick:u.includes("google")?()=>h("google"):void 0,onGitHubClick:u.includes("github")?()=>h("github"):void 0,onAppleClick:u.includes("apple")?()=>h("apple"):void 0,onSlackClick:u.includes("slack")?()=>h("slack"):void 0,onDiscordClick:u.includes("discord")?()=>h("discord"):void 0,isLoading:!!W})}),t.showMagicLink||t.showWebAuthn?e.jsxs(K,{value:B,onValueChange:o=>q(o),children:[e.jsxs(X,{className:"grid w-full grid-cols-2",children:[e.jsxs(A,{value:"password",className:"gap-2",children:[e.jsx(E,{className:"h-4 w-4"}),"Password"]}),t.showMagicLink&&e.jsxs(A,{value:"magic-link",className:"gap-2",children:[e.jsx(P,{className:"h-4 w-4"}),"Magic Link"]})]}),e.jsx(F,{value:"password",className:"mt-4 space-y-4",children:e.jsx(T,{form:C,showPassword:s,setShowPassword:l,isLoading:x,config:t,requiresMfaStep:j})}),t.showMagicLink&&e.jsx(F,{value:"magic-link",className:"mt-4",children:U?e.jsx(de,{email:k.getFieldValue("email")}):e.jsx(ce,{form:k,isLoading:x})})]}):e.jsx(T,{form:C,showPassword:s,setShowPassword:l,isLoading:x,config:t,requiresMfaStep:j}),t.showWebAuthn&&e.jsxs(w,{variant:"outline",fullWidth:!0,onClick:O,disabled:x,className:"gap-2",children:[e.jsx(_,{className:"h-4 w-4"}),"Sign in with Passkey"]}),e.jsxs("div",{className:"flex items-center justify-between text-sm pt-4 border-t",children:[t.allowSignUp?e.jsx(I,{to:"/hosted/sign-up",search:{tenant_id:a,redirect_url:n||void 0},className:"text-primary hover:underline",children:"Create account"}):e.jsx("span",{}),e.jsx(I,{to:"/hosted/forgot-password",search:{tenant_id:a},className:"text-primary hover:underline",children:"Forgot password?"})]})]})]})}function T({form:i,showPassword:t,setShowPassword:a,isLoading:n,config:g,requiresMfaStep:m}){return e.jsxs("form",{onSubmit:s=>{s.preventDefault(),s.stopPropagation(),i.handleSubmit()},className:"space-y-4",children:[e.jsx(i.Field,{name:"email",validators:{onChange:({value:s})=>{if(!s.trim())return"Email is required";if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s))return"Please enter a valid email"}},children:s=>e.jsx(f,{label:"Email",type:"email",placeholder:`you@${g.companyName.toLowerCase().replace(/\s+/g,"")}.com`,value:s.state.value,onChange:l=>s.handleChange(l.target.value),onBlur:s.handleBlur,error:s.state.meta.isTouched?s.state.meta.errors[0]:void 0,leftIcon:e.jsx(v,{className:"h-4 w-4 text-muted-foreground"}),autoComplete:"email",autoCapitalize:"none",spellCheck:!1,required:!0,disabled:n})}),m&&e.jsx(i.Field,{name:"mfaCode",validators:{onChange:({value:s})=>{if(!s||s.trim().length<6)return"MFA code is required"}},children:s=>e.jsx(f,{label:"MFA Code",type:"text",placeholder:"123456",value:s.state.value,onChange:l=>s.handleChange(l.target.value.replace(/\D/g,"").slice(0,8)),onBlur:s.handleBlur,error:s.state.meta.isTouched?s.state.meta.errors[0]:void 0,leftIcon:e.jsx(_,{className:"h-4 w-4 text-muted-foreground"}),inputMode:"numeric",autoComplete:"one-time-code",required:!0,disabled:n})}),e.jsx(i.Field,{name:"password",validators:{onChange:({value:s})=>{if(!s)return"Password is required"}},children:s=>e.jsx(f,{label:"Password",type:t?"text":"password",placeholder:"••••••••",value:s.state.value,onChange:l=>s.handleChange(l.target.value),onBlur:s.handleBlur,error:s.state.meta.isTouched?s.state.meta.errors[0]:void 0,leftIcon:e.jsx(E,{className:"h-4 w-4 text-muted-foreground"}),autoComplete:"current-password",rightIcon:e.jsx("button",{type:"button",onClick:()=>a(!t),className:"text-muted-foreground hover:text-foreground transition-colors","aria-label":t?"Hide password":"Show password",children:t?e.jsx(R,{className:"h-4 w-4"}):e.jsx(V,{className:"h-4 w-4"})}),required:!0,disabled:n})}),e.jsx(w,{type:"submit",fullWidth:!0,size:"lg",isLoading:n,rightIcon:e.jsx($,{className:"h-4 w-4"}),children:m?"Verify MFA":"Sign In"})]})}function ce({form:i,isLoading:t}){return e.jsxs("form",{onSubmit:a=>{a.preventDefault(),a.stopPropagation(),i.handleSubmit()},className:"space-y-4",children:[e.jsx(i.Field,{name:"email",validators:{onChange:({value:a})=>{if(!a.trim())return"Email is required";if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a))return"Please enter a valid email"}},children:a=>e.jsx(f,{label:"Email",type:"email",placeholder:"you@example.com",value:a.state.value,onChange:n=>a.handleChange(n.target.value),onBlur:a.handleBlur,error:a.state.meta.isTouched?a.state.meta.errors[0]:void 0,leftIcon:e.jsx(v,{className:"h-4 w-4 text-muted-foreground"}),autoComplete:"email",required:!0,disabled:t})}),e.jsx(w,{type:"submit",fullWidth:!0,isLoading:t,rightIcon:e.jsx(P,{className:"h-4 w-4"}),children:"Send Magic Link"}),e.jsx("p",{className:"text-xs text-center text-muted-foreground",children:"You'll receive an email with a secure link to sign in instantly"})]})}function de({email:i}){return e.jsxs("div",{className:"text-center space-y-4 py-8",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 dark:bg-green-900/20 rounded-full flex items-center justify-center mx-auto",children:e.jsx(v,{className:"w-8 h-8 text-green-600 dark:text-green-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Check your email"}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["We've sent a magic link to ",e.jsx("strong",{children:i})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"Link expires in 15 minutes"})]})]})}export{be as component};
