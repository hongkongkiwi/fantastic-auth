import{r as a,j as e,N as S,$ as D,aa as F,bL as J,m as X,bB as Z,ab as _,cb as ee}from"./vendor-DTXcECKj.js";import{u as se,a as N,b as ae,c as E,t as r,B as i,d as T,D as te,w as ie,x as ne,y as re,z as le,E as M,C as ce,P as de}from"./main-D_qbY1gz.js";import{C as c,d as f}from"./Card-ovhP7agJ.js";import{I as oe}from"./Input-CvXUl1_l.js";import"./Switch-C_TaIxIx.js";import"./Tabs-B49fZEnE.js";import{n as me,o as xe,p as ue}from"./internal-api-CvC1OOUg.js";import{m as l,A as pe}from"./vendor-motion-DirI8ZVJ.js";import"./vendor-sonner-CauEFWQC.js";import"./vendor-sentry-DWdptYQI.js";import"./logger-BML-1mmb.js";const he=[{id:"read:users",label:"Read Users",description:"View user data"},{id:"write:users",label:"Write Users",description:"Create and modify users"},{id:"read:tenants",label:"Read Tenants",description:"View tenant data"},{id:"write:tenants",label:"Write Tenants",description:"Manage tenants"},{id:"read:audit",label:"Read Audit",description:"View audit logs"},{id:"admin",label:"Admin",description:"Full admin access"}];function ye(){const v=se(),R=N(me),O=N(xe),V=N(ue),{data:d=[],isLoading:q}=ae({queryKey:["api-keys"],queryFn:()=>R()}),[L,o]=a.useState(!1),[U,m]=a.useState(!1),[x,u]=a.useState(null),[b,w]=a.useState(null),[n,A]=a.useState(!1),[C,k]=a.useState(!1),[p,K]=a.useState(""),[h,I]=a.useState("never"),[y,P]=a.useState(["read:users"]),z=a.useMemo(()=>[...d].sort((s,t)=>new Date(t.createdAt||0).getTime()-new Date(s.createdAt||0).getTime()),[d]),B=E({mutationFn:async()=>O({data:{name:p,scopes:y,expiresInDays:h==="never"?void 0:Number(h)}}),onSuccess:s=>{w(s),v.invalidateQueries({queryKey:["api-keys"]}),r.success("API key created")},onError:()=>r.error("Failed to create API key"),onSettled:()=>k(!1)}),Q=async()=>{k(!0),B.mutate()},H=E({mutationFn:async s=>V({data:{keyId:s}}),onSuccess:()=>{v.invalidateQueries({queryKey:["api-keys"]}),r.success("API key revoked")},onError:()=>r.error("Failed to revoke API key")}),W=async()=>{x?.id&&(await H.mutateAsync(x.id),m(!1),u(null))},Y=s=>{navigator.clipboard.writeText(s)},j=()=>{o(!1),w(null),K(""),I("never"),P(["read:users"]),A(!1)},g=s=>s?new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"Never",$=s=>{P(t=>t.includes(s)?t.filter(G=>G!==s):[...t,s])};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:"API Keys"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage API keys for programmatic access to the Vault API"})]}),e.jsxs(i,{onClick:()=>o(!0),children:[e.jsx(S,{className:"mr-2 h-4 w-4"}),"Create API Key"]})]}),e.jsxs("div",{className:"space-y-4",children:[q&&e.jsx(c,{children:e.jsx(f,{className:"p-6 text-sm text-muted-foreground",children:"Loading API keys…"})}),z.map(s=>e.jsx(l.div,{layout:!0,initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},children:e.jsx(c,{children:e.jsxs(f,{className:"flex items-center justify-between p-6",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-lg bg-primary/10",children:e.jsx(D,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-semibold",children:s.name}),e.jsxs(T,{variant:"outline",className:"font-mono text-xs",children:[s.prefix,"..."]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(F,{className:"h-3 w-3"}),"Created ",g(s.createdAt)]}),s.expiresAt&&e.jsxs("span",{className:"flex items-center gap-1 text-amber-600",children:[e.jsx(F,{className:"h-3 w-3"}),"Expires ",g(s.expiresAt)]}),s.lastUsedAt&&e.jsxs("span",{children:["Last used ",g(s.lastUsedAt)]})]}),e.jsx("div",{className:"flex flex-wrap gap-1 pt-1",children:(s.scopes??[]).map(t=>e.jsx(T,{variant:"secondary",className:"text-xs",children:t},t))})]})]}),e.jsx(i,{variant:"ghost",size:"sm",className:"text-destructive hover:text-destructive",onClick:()=>{u(s),m(!0)},children:e.jsx(J,{className:"h-4 w-4"})})]})})},s.id)),d.length===0&&e.jsx(c,{className:"border-dashed",children:e.jsxs(f,{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(D,{className:"h-12 w-12 text-muted-foreground/50"}),e.jsx("h3",{className:"mt-4 text-lg font-semibold",children:"No API keys"}),e.jsx("p",{className:"text-muted-foreground",children:"Create an API key to get started with the Vault API"}),e.jsxs(i,{className:"mt-4",onClick:()=>o(!0),children:[e.jsx(S,{className:"mr-2 h-4 w-4"}),"Create API Key"]})]})})]}),e.jsx(te,{open:L,onOpenChange:j,children:e.jsxs(ie,{className:"max-w-lg",children:[e.jsxs(ne,{children:[e.jsx(re,{children:"Create API Key"}),e.jsx(le,{children:"Create a new API key for programmatic access"})]}),e.jsx(pe,{mode:"wait",children:b?e.jsxs(l.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"space-y-4",children:[e.jsxs("div",{className:"rounded-lg bg-green-50 p-4 text-green-800 dark:bg-green-900/20 dark:text-green-400",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(X,{className:"h-5 w-5"}),e.jsx("span",{className:"font-medium",children:"API Key Created Successfully"})]}),e.jsx("p",{className:"mt-1 text-sm",children:"Copy this key now. You won't be able to see it again!"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Your API Key"}),(()=>{const s=b.key??"";return e.jsxs("div",{className:"flex gap-2",children:[e.jsx("code",{className:"flex-1 overflow-hidden rounded bg-muted px-3 py-2 text-sm",children:n?s:"•".repeat(s.length)}),e.jsx(i,{variant:"outline",size:"icon",onClick:()=>A(!n),"aria-label":n?"Hide API key":"Show API key",children:n?e.jsx(Z,{className:"h-4 w-4"}):e.jsx(_,{className:"h-4 w-4"})}),e.jsx(i,{variant:"outline",size:"icon",onClick:()=>Y(s),"aria-label":"Copy API key",children:e.jsx(ee,{className:"h-4 w-4"})})]})})()]}),e.jsx(M,{children:e.jsx(i,{onClick:j,children:"I've Copied My Key"})})]},"success"):e.jsxs(l.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",htmlFor:"key-name",children:"Key Name"}),e.jsx(oe,{id:"key-name",placeholder:"e.g., Production API, Testing Key",value:p,onChange:s=>K(s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",htmlFor:"key-expiry",children:"Expiration"}),e.jsxs("select",{id:"key-expiry",className:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm",value:h,onChange:s=>I(s.target.value),children:[e.jsx("option",{value:"never",children:"Never"}),e.jsx("option",{value:"30",children:"30 days"}),e.jsx("option",{value:"90",children:"90 days"}),e.jsx("option",{value:"365",children:"1 year"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Scopes"}),e.jsx("div",{className:"space-y-2 rounded-lg border p-3",children:he.map(s=>e.jsxs("label",{className:"flex cursor-pointer items-center gap-3 rounded-md p-2 hover:bg-muted",children:[e.jsx("input",{type:"checkbox",checked:y.includes(s.id),onChange:()=>$(s.id),className:"h-4 w-4 rounded border-primary"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:s.label}),e.jsx("code",{className:"text-xs text-muted-foreground",children:s.id})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.description})]})]},s.id))})]}),e.jsxs(M,{children:[e.jsx(i,{variant:"outline",onClick:j,children:"Cancel"}),e.jsx(i,{onClick:Q,disabled:!p||y.length===0||C,children:C?e.jsxs(e.Fragment,{children:[e.jsx(l.div,{className:"mr-2 h-4 w-4 animate-spin rounded-full border-2 border-current border-t-transparent"}),"Creating…"]}):"Create Key"})]})]},"form")})]})}),e.jsx(ce,{isOpen:U,onClose:()=>{m(!1),u(null)},onConfirm:W,title:"Revoke API Key",description:`Are you sure you want to revoke the API key "${x?.name}"? This action cannot be undone and any applications using this key will immediately stop working.`,confirmText:"Revoke Key",variant:"destructive"})]})}function Ie(){return e.jsxs("div",{className:"space-y-6",children:[e.jsx(de,{title:"API Keys",description:"Manage API access tokens",breadcrumbs:[{label:"Settings",href:"/settings"},{label:"API Keys"}]}),e.jsx(c,{className:"p-6",children:e.jsx(ye,{})})]})}export{Ie as component};
