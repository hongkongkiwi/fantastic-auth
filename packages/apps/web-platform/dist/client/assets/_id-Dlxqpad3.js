import{r as d,j as e,bt as b,bs as H,bJ as ce,bK as oe,bL as de,D as me,U as xe,C as ue,bE as pe,bq as he,bF as V,a8 as I,ab as W,a7 as je}from"./vendor-DTXcECKj.js";import{r as fe,i as ge,a as j,B as c,L as ve,s as Ne,m as P,P as be,j as U,k as L,l as O,e as y,d as E,S as w,o as T,I as ye,n as we,C as F,v as Te,D as Ae,w as Ce,x as Se,y as ke,z as De,E as Ie,t as n}from"./main-D_qbY1gz.js";import{C as r,d as i,a as u,b as p,c as f}from"./Card-ovhP7agJ.js";import{T as Pe,a as Ue,b as g,c as v}from"./Tabs-B49fZEnE.js";import{a as R}from"./Skeleton-Dk1LJCqK.js";import{j as Le,s as Oe,e as Ee,f as Fe,k as Re}from"./internal-api-CvC1OOUg.js";import{u as Be,m as ze}from"./vendor-motion-DirI8ZVJ.js";import{R as Ge,A as Ke,C as Me,X as $e,Y as Ye,T as _e,a as He}from"./vendor-charts-CwKjLNYJ.js";import"./vendor-sonner-CauEFWQC.js";import"./vendor-sentry-DWdptYQI.js";import"./logger-BML-1mmb.js";const Ve=[{day:"Mon",apiCalls:1200,users:45},{day:"Tue",apiCalls:1800,users:52},{day:"Wed",apiCalls:2400,users:58},{day:"Thu",apiCalls:2100,users:61},{day:"Fri",apiCalls:2800,users:65},{day:"Sat",apiCalls:1500,users:42},{day:"Sun",apiCalls:1200,users:38}],B=Date.now(),We=[{id:1,action:"Tenant Updated",user:"Platform Admin",timestamp:new Date(B-120*1e3).toISOString(),status:"success"},{id:2,action:"Plan Changed",user:"Billing System",timestamp:new Date(B-900*1e3).toISOString(),status:"success"},{id:3,action:"Domain Verified",user:"System",timestamp:new Date(B-3600*1e3).toISOString(),status:"success"}];function is(){const{id:N}=fe({from:"/tenants/$id"}),A=ge.VITE_ENABLE_SUPPORT_IMPERSONATION==="true",[s,z]=d.useState(null),[X,q]=d.useState(!0),[m,l]=d.useState(null),[C,G]=d.useState(!1),[J,S]=d.useState(!1),[o,k]=d.useState(null),K=Be(),M=j(Le),Z=j(Oe),Q=j(Ee),ee=j(Fe),se=j(Re);d.useEffect(()=>{(async()=>{try{const a=await M({data:{tenantId:N}});z(a)}catch{n.error("Failed to load tenant details")}finally{q(!1)}})()},[N]);const D=async()=>{if(!(!s||!m)){if(!s.id){n.error("Tenant ID is missing");return}G(!0);try{switch(m){case"suspend":await Z({data:{tenantId:s.id}}),n.success("Tenant suspended");break;case"activate":await Q({data:{tenantId:s.id}}),n.success("Tenant activated");break;case"delete":await ee({data:{tenantId:s.id}}),n.success("Tenant deleted"),window.location.href="/tenants";return}const t=await M({data:{tenantId:N}});z(t)}catch{n.error(`Failed to ${m} tenant`)}finally{G(!1),l(null)}}},te=()=>{S(!0)},ae=async t=>{if(!s?.id||!s.owner?.id){n.error("Tenant owner is unavailable for support access");return}try{const a=await se({data:{tenantId:s.id,userId:s.owner.id,reason:t.trim(),duration:900}});S(!1),k({token:a.token,expiresAt:a.expiresAt,userEmail:s.owner.email}),n.success("Support access token created")}catch(a){n.error(a instanceof Error?a.message:"Failed to create support access token")}},$={active:{label:"Active",variant:"success",icon:H},suspended:{label:"Suspended",variant:"warning",icon:b},inactive:{label:"Inactive",variant:"destructive",icon:b}};if(X)return e.jsxs("div",{className:"space-y-6",children:[e.jsx(R,{className:"h-8 w-48"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[...Array(4)].map((t,a)=>e.jsx(R,{variant:"card"},a))}),e.jsx(R,{variant:"card",className:"h-96"})]});if(!s)return e.jsxs("div",{className:"flex flex-col items-center justify-center py-20",children:[e.jsx(b,{className:"h-12 w-12 text-muted-foreground mb-4"}),e.jsx("h2",{className:"text-xl font-semibold",children:"Tenant not found"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"The tenant you're looking for doesn't exist"}),e.jsx(c,{asChild:!0,children:e.jsx(ve,{to:"/tenants",children:"Back to Tenants"})})]});const ne=s.status??"inactive",x=$[ne]||$.inactive,re=x.icon,h=s.plan??"unknown",Y=h==="unknown"?"Unknown":h.charAt(0).toUpperCase()+h.slice(1),ie=s.createdAt?Ne(s.createdAt):"—",_=s.createdAt?P(s.createdAt):"—",le=s.updatedAt?P(s.updatedAt):_;return e.jsxs("div",{className:"space-y-6",children:[e.jsx(be,{title:s.name??"Tenant",description:s.slug??"—",breadcrumbs:[{label:"Tenants",href:"/tenants"},{label:s.name??"Tenant"}],actions:e.jsxs("div",{className:"flex items-center gap-2",children:[s.status==="active"?e.jsxs(c,{variant:"outline",onClick:()=>l("suspend"),children:[e.jsx(ce,{className:"mr-2 h-4 w-4"}),"Suspend"]}):e.jsxs(c,{variant:"outline",onClick:()=>l("activate"),children:[e.jsx(oe,{className:"mr-2 h-4 w-4"}),"Activate"]}),e.jsxs(c,{variant:"destructive",onClick:()=>l("delete"),children:[e.jsx(de,{className:"mr-2 h-4 w-4"}),"Delete"]})]})}),e.jsxs(U,{children:[e.jsx(me,{className:"h-4 w-4"}),e.jsx(L,{children:"Privacy-First Platform"}),e.jsx(O,{children:'As a platform administrator, you do not have direct access to tenant user data. Use "Support Access" below only when necessary for legitimate support purposes.'})]}),e.jsx(r,{className:y("border-l-4",s.status==="active"?"border-l-green-500":"border-l-amber-500"),children:e.jsxs(i,{className:"flex items-center justify-between py-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:y("p-2 rounded-full",s.status==="active"?"bg-green-500/10":"bg-amber-500/10"),children:e.jsx(re,{className:y("h-5 w-5",s.status==="active"?"text-green-600":"text-amber-600")})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:x.label}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.status==="active"?"All services operational":"Tenant access restricted"})]})]}),e.jsx(E,{variant:x.variant,size:"lg",children:x.label})]})}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(w,{title:"Total Users",value:T(s.usage?.currentUsers??0),icon:e.jsx(xe,{className:"h-5 w-5"}),color:"blue"}),e.jsx(w,{title:"Plan",value:Y,icon:e.jsx(ue,{className:"h-5 w-5"}),color:"purple"}),e.jsx(w,{title:"Created",value:ie,icon:e.jsx(pe,{className:"h-5 w-5"}),color:"green"}),e.jsx(w,{title:"API Calls (24h)",value:T(2450),trend:{value:12,isPositive:!0},icon:e.jsx(he,{className:"h-5 w-5"}),color:"amber"})]}),e.jsxs(Pe,{defaultValue:"overview",className:"space-y-6",children:[e.jsxs(Ue,{children:[e.jsx(g,{value:"overview",children:"Overview"}),e.jsx(g,{value:"usage",children:"Usage"}),A?e.jsx(g,{value:"support",children:"Support Access"}):null,e.jsx(g,{value:"activity",children:"Activity"}),e.jsx(g,{value:"settings",children:"Settings"})]}),e.jsx(v,{value:"overview",className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(r,{children:[e.jsx(u,{children:e.jsx(p,{children:"Tenant Details"})}),e.jsx(i,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Tenant ID"}),e.jsx("p",{className:"font-medium font-mono text-sm",children:s.id??"—"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Slug"}),e.jsx("p",{className:"font-medium",children:s.slug??"—"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Plan"}),e.jsx(E,{variant:h==="enterprise"?"warning":h==="pro"?"success":"default",children:Y})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Status"}),e.jsx(E,{variant:x.variant,children:x.label})]}),s.customDomain&&e.jsxs("div",{className:"col-span-2",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Custom Domain"}),e.jsx("p",{className:"font-medium",children:s.customDomain})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Created"}),e.jsx("p",{className:"font-medium",children:_})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Last Updated"}),e.jsx("p",{className:"font-medium",children:le})]})]})})]}),e.jsxs(r,{children:[e.jsxs(u,{children:[e.jsx(p,{children:"Owner Information"}),e.jsx(f,{children:"Contact information for tenant owner"})]}),e.jsx(i,{className:"space-y-4",children:s.owner?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"h-12 w-12 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx(V,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.owner.name||"Unknown"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.owner.email??"unknown"})]})]}),e.jsxs(U,{variant:"warning",className:"mt-4",children:[e.jsx(I,{className:"h-4 w-4"}),e.jsx(L,{children:"Privacy Notice"}),e.jsx(O,{children:"Detailed user information is not accessible at the platform level. Use Support Access if you need to investigate user-specific issues."})]})]}):e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(V,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No owner assigned"})]})})]})]})}),e.jsxs(v,{value:"usage",className:"space-y-6",children:[e.jsxs(r,{children:[e.jsxs(u,{children:[e.jsx(p,{children:"API Usage (Last 7 Days)"}),e.jsx(f,{children:"Daily API calls and active users"})]}),e.jsx(i,{children:e.jsx("div",{className:"h-[300px]",children:e.jsx(Ge,{width:"100%",height:"100%",children:e.jsxs(Ke,{data:Ve,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"colorApi",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#6366f1",stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:"#6366f1",stopOpacity:0})]})}),e.jsx(Me,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),e.jsx($e,{dataKey:"day",stroke:"#64748b",fontSize:12}),e.jsx(Ye,{stroke:"#64748b",fontSize:12}),e.jsx(_e,{}),e.jsx(He,{type:"monotone",dataKey:"apiCalls",stroke:"#6366f1",strokeWidth:2,fillOpacity:1,fill:"url(#colorApi)",name:"API Calls"})]})})})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(r,{children:e.jsxs(i,{className:"pt-6",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"API Calls (This Month)"}),e.jsx("p",{className:"text-2xl font-bold mt-1",children:T(45200)}),e.jsx("p",{className:"text-sm text-green-600 mt-1",children:"↑ 12% from last month"})]})}),e.jsx(r,{children:e.jsxs(i,{className:"pt-6",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Storage Used"}),e.jsx("p",{className:"text-2xl font-bold mt-1",children:"2.4 GB"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"of 10 GB limit"})]})}),e.jsx(r,{children:e.jsxs(i,{className:"pt-6",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Active Sessions"}),e.jsx("p",{className:"text-2xl font-bold mt-1",children:T(156)}),e.jsx("p",{className:"text-sm text-green-600 mt-1",children:"↑ 5% from yesterday"})]})})]})]}),A?e.jsx(v,{value:"support",className:"space-y-6",children:e.jsxs(r,{className:"border-amber-200 dark:border-amber-800",children:[e.jsxs(u,{children:[e.jsxs(p,{className:"flex items-center gap-2 text-amber-600",children:[e.jsx(I,{className:"h-5 w-5"}),"Support Access (Impersonation)"]}),e.jsx(f,{children:"Generate a short-lived support token scoped to this tenant owner. Token creation is audited."})]}),e.jsxs(i,{className:"space-y-4",children:[e.jsxs(U,{variant:"destructive",children:[e.jsx(I,{className:"h-4 w-4"}),e.jsx(L,{children:"Restricted Access"}),e.jsx(O,{children:"This feature should only be used for legitimate support purposes. You will have full access to tenant user data during the impersonation session. Your actions will be logged."})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg bg-muted/50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-amber-100 dark:bg-amber-900 flex items-center justify-center",children:e.jsx(W,{className:"h-5 w-5 text-amber-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Start Support Session"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Issue a temporary API token scoped to this tenant owner"})]})]}),e.jsxs(c,{onClick:te,className:"bg-amber-600 hover:bg-amber-700",children:[e.jsx(W,{className:"mr-2 h-4 w-4"}),"Access Tenant"]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsxs("h4",{className:"text-sm font-medium mb-3 flex items-center gap-2",children:[e.jsx(je,{className:"h-4 w-4"}),"Recent Impersonation Activity"]}),e.jsx(ye,{})]})]})]})}):null,e.jsx(v,{value:"activity",className:"space-y-6",children:e.jsxs(r,{children:[e.jsxs(u,{children:[e.jsx(p,{children:"Platform-Level Activity"}),e.jsx(f,{children:"Platform administrator actions on this tenant"})]}),e.jsx(i,{children:e.jsx("div",{className:"space-y-4",children:We.map((t,a)=>e.jsxs(ze.div,{initial:K?!1:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:K?{duration:0}:{delay:a*.05},className:"flex items-start gap-4 p-3 rounded-lg hover:bg-muted/50 transition-colors",children:[e.jsx("div",{className:y("p-2 rounded-full shrink-0",t.status==="success"&&"bg-green-500/10 text-green-600",t.status==="error"&&"bg-red-500/10 text-red-600"),children:t.status==="success"?e.jsx(H,{className:"h-4 w-4"}):e.jsx(b,{className:"h-4 w-4"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium",children:t.action}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t.user})]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:e.jsx("span",{title:t.timestamp,children:we(t.timestamp)})})]},t.id))})})]})}),e.jsx(v,{value:"settings",className:"space-y-6",children:e.jsxs(r,{children:[e.jsxs(u,{children:[e.jsx(p,{children:"Danger Zone"}),e.jsx(f,{children:"Destructive actions for this tenant"})]}),e.jsx(i,{className:"space-y-4",children:e.jsxs("div",{className:"flex items-center justify-between p-4 border border-destructive/20 rounded-lg bg-destructive/5",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-destructive",children:"Delete Tenant"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Permanently delete this tenant and all associated data"})]}),e.jsx(c,{variant:"destructive",onClick:()=>l("delete"),children:"Delete"})]})})]})})]}),e.jsx(F,{isOpen:m==="suspend",onClose:()=>l(null),onConfirm:D,title:"Suspend Tenant",description:`Are you sure you want to suspend "${s.name}"? This will prevent users from accessing the tenant.`,confirmText:"Suspend",variant:"destructive",isLoading:C}),e.jsx(F,{isOpen:m==="activate",onClose:()=>l(null),onConfirm:D,title:"Activate Tenant",description:`Are you sure you want to activate "${s.name}"?`,confirmText:"Activate",isLoading:C}),e.jsx(F,{isOpen:m==="delete",onClose:()=>l(null),onConfirm:D,title:"Delete Tenant",description:`Are you sure you want to delete "${s.name}"? This action cannot be undone.`,confirmText:"Delete",variant:"destructive",isLoading:C}),A?e.jsx(Te,{tenantId:s.id??N,tenantName:s.name??"Unknown Tenant",open:J,onConfirm:ae,onCancel:()=>S(!1)}):null,e.jsx(Ae,{open:!!o,onOpenChange:t=>{t||k(null)},children:e.jsxs(Ce,{size:"lg",children:[e.jsxs(Se,{children:[e.jsx(ke,{children:"Support Access Token"}),e.jsx(De,{children:"Use this short-lived bearer token for support API calls. Do not store this token long-term."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Target user: ",e.jsx("span",{className:"font-medium text-foreground",children:o?.userEmail??"unknown"})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Expires at:"," ",e.jsx("span",{className:"font-medium text-foreground",children:o?.expiresAt?P(o.expiresAt):"unknown"})]}),e.jsx("textarea",{readOnly:!0,value:o?.token??"",className:"w-full min-h-[120px] rounded-md border border-input bg-muted px-3 py-2 text-xs font-mono"})]}),e.jsxs(Ie,{children:[e.jsx(c,{variant:"outline",onClick:async()=>{if(o?.token)try{await navigator.clipboard.writeText(o.token),n.success("Support token copied")}catch{n.error("Unable to copy token")}},children:"Copy Token"}),e.jsx(c,{onClick:()=>k(null),children:"Close"})]})]})})]})}export{is as component};
