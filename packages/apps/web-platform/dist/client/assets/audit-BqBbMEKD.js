import{r as m,j as e,bC as _,bD as q,m as L,bE as z,q as w,ab as U,a8 as H,z as G,bF as J,bt as P,bs as Q,v as X,B as Y}from"./vendor-DTXcECKj.js";import{e as f,i as Z,a as M,P as ee,B,j as ae,k as te,l as se,d as y,t as T,m as ne,n as re}from"./main-D_qbY1gz.js";import{D as ie}from"./DataTable-B1vFbS0r.js";import{C as F,a as le,b as oe,d as ce}from"./Card-ovhP7agJ.js";import{I as R}from"./Input-CvXUl1_l.js";import{T as de,a as ue,b as E,c as k}from"./Tabs-B49fZEnE.js";import{a as me,d as pe}from"./internal-api-CvC1OOUg.js";import{u as xe,m as he}from"./vendor-motion-DirI8ZVJ.js";import"./vendor-sonner-CauEFWQC.js";import"./vendor-sentry-DWdptYQI.js";import"./logger-BML-1mmb.js";const O=m.forwardRef(({className:o,options:i,label:n,error:r,helperText:p,placeholder:s,onChange:c,fullWidth:l,id:d,...g},A)=>{const x=d||m.useId(),v=!!r;return e.jsxs("div",{className:f("space-y-1.5",l&&"w-full"),children:[n&&e.jsxs("label",{htmlFor:x,className:"text-sm font-medium text-foreground",children:[n,g.required&&e.jsx("span",{className:"text-destructive ml-1",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{id:x,className:f("flex h-10 w-full appearance-none rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background transition-colors transition-shadow duration-200","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2","disabled:cursor-not-allowed disabled:opacity-50","hover:border-muted-foreground/30",v&&"border-destructive focus-visible:ring-destructive",o),ref:A,onChange:u=>c?.(u.target.value),"aria-invalid":v,"aria-describedby":v?`${x}-error`:void 0,...g,children:[s&&e.jsx("option",{value:"",disabled:!0,children:s}),i.map(u=>e.jsx("option",{value:u.value,disabled:u.disabled,children:u.label},u.value))]}),e.jsx(_,{className:"absolute right-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground pointer-events-none","aria-hidden":"true"})]}),v?e.jsx("p",{id:`${x}-error`,className:"text-sm text-destructive animate-fade-in",children:r}):p?e.jsx("p",{className:"text-sm text-muted-foreground",children:p}):null]})});O.displayName="Select";const ge={"tenant.create":e.jsx(Y,{className:"h-4 w-4","aria-hidden":"true"}),"tenant.update":e.jsx(X,{className:"h-4 w-4","aria-hidden":"true"}),"tenant.suspend":e.jsx(P,{className:"h-4 w-4","aria-hidden":"true"}),"tenant.activate":e.jsx(Q,{className:"h-4 w-4","aria-hidden":"true"}),"tenant.delete":e.jsx(P,{className:"h-4 w-4","aria-hidden":"true"}),"user.create":e.jsx(J,{className:"h-4 w-4","aria-hidden":"true"}),"auth.login":e.jsx(L,{className:"h-4 w-4","aria-hidden":"true"}),"auth.logout":e.jsx(L,{className:"h-4 w-4","aria-hidden":"true"}),"impersonation.start":e.jsx(U,{className:"h-4 w-4","aria-hidden":"true"}),"impersonation.end":e.jsx(G,{className:"h-4 w-4","aria-hidden":"true"}),"impersonation.action":e.jsx(H,{className:"h-4 w-4","aria-hidden":"true"})},ve={"tenant.create":"bg-blue-500/10 text-blue-600","tenant.update":"bg-slate-500/10 text-slate-600","tenant.suspend":"bg-amber-500/10 text-amber-600","tenant.activate":"bg-green-500/10 text-green-600","tenant.delete":"bg-red-500/10 text-red-600","user.create":"bg-purple-500/10 text-purple-600","auth.login":"bg-emerald-500/10 text-emerald-600","auth.logout":"bg-gray-500/10 text-gray-600","impersonation.start":"bg-amber-500/10 text-amber-600","impersonation.end":"bg-gray-500/10 text-gray-600","impersonation.action":"bg-orange-500/10 text-orange-600"},be={"tenant.create":"Tenant Created","tenant.update":"Tenant Updated","tenant.suspend":"Tenant Suspended","tenant.activate":"Tenant Activated","tenant.delete":"Tenant Deleted","tenant.migrate":"Tenant Migrated","user.create":"User Created","user.update":"User Updated","user.delete":"User Deleted","auth.login":"Login","auth.logout":"Logout","auth.expired":"Session Expired","subscription.update":"Subscription Updated","invoice.generate":"Invoice Generated","impersonation.start":"Support Access Started","impersonation.end":"Support Access Ended","impersonation.action":"Action During Support Access"},fe=[{value:"",label:"All Actions"},{value:"tenant",label:"Tenant Actions"},{value:"user",label:"User Actions"},{value:"auth",label:"Authentication"},{value:"subscription",label:"Billing"},{value:"impersonation",label:"Support Access"}];function Ie(){const o=Z.VITE_ENABLE_SUPPORT_IMPERSONATION==="true",[i,n]=m.useState([]),[r,p]=m.useState(!0),[s,c]=m.useState(""),[l,d]=m.useState({since:"",until:""}),[g,A]=m.useState("platform"),x=xe(),v=M(me),u=M(pe),K=async(a=1)=>{p(!0);try{const t=await v({data:{action:s||void 0,since:l.since||void 0,until:l.until||void 0,page:a,perPage:50,sort:"desc"}});n(t.data||[])}catch{T.error("Failed to load audit logs")}finally{p(!1)}};m.useEffect(()=>{K()},[s,l]);const W=async()=>{try{const a=await u({data:{action:s||void 0,since:l.since||void 0,until:l.until||void 0}}),t=new Blob([a],{type:"text/csv"}),b=URL.createObjectURL(t),h=document.createElement("a");h.href=b,h.download=`audit-log-${new Date().toISOString().split("T")[0]}.csv`,h.click(),URL.revokeObjectURL(b),T.success("Audit log downloaded")}catch{T.error("Failed to download audit log")}},j=i.filter(a=>(a.action||"").startsWith("impersonation")),$=i.filter(a=>!(a.action||"").startsWith("impersonation")),C=g==="platform"?$:g==="impersonation"?j:i,S=[{accessorKey:"timestamp",header:"Time",cell:({getValue:a})=>{const t=a();return e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm",children:ne(t)}),e.jsx("span",{className:"text-xs text-muted-foreground",children:re(t)})]})}},{accessorKey:"action",header:"Action",cell:({getValue:a})=>{const t=a(),b=ge[t]||e.jsx(w,{className:"h-4 w-4","aria-hidden":"true"}),h=ve[t]||"bg-gray-500/10 text-gray-600",V=be[t]||t;return e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:f("p-2 rounded-full",h),children:b}),e.jsx("span",{className:"font-medium",children:V})]})}},{accessorKey:"actor",header:"Actor",cell:({row:a,getValue:t})=>{const b=t(),h=a.original.action?.startsWith("impersonation");return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm",children:b}),h&&e.jsx(y,{variant:"warning",className:"text-xs",children:"Support Access"})]})}},{accessorKey:"tenantName",header:"Tenant",cell:({getValue:a})=>{const t=a();return t?e.jsx(y,{variant:"secondary",className:"font-mono text-xs",children:t}):e.jsx("span",{className:"text-muted-foreground",children:"â€”"})}},{accessorKey:"detail",header:"Details",cell:({getValue:a})=>e.jsx("p",{className:"text-sm text-muted-foreground max-w-md truncate",children:a()})},{accessorKey:"source",header:"Source",cell:({getValue:a})=>{const t=a();return e.jsx(y,{variant:t==="ui"?"default":"secondary",children:t?.toUpperCase()||"API"})}}],N={today:245,thisWeek:1847,thisMonth:8934,impersonationSessions:o?j.filter(a=>a.action==="impersonation.start").length:0};return e.jsxs("div",{className:"space-y-6",children:[e.jsx(ee,{title:"Platform Audit Logs",description:"Track all platform administrative actions and support access sessions",breadcrumbs:[{label:"Platform Audit"}],actions:e.jsx(B,{variant:"outline",leftIcon:e.jsx(q,{className:"h-4 w-4"}),onClick:W,children:"Export CSV"})}),e.jsxs(ae,{children:[e.jsx(L,{className:"h-4 w-4"}),e.jsx(te,{children:"Privacy & Accountability"}),e.jsx(se,{children:"This audit log tracks all platform-level actions. Support access sessions (impersonation) are logged separately and include the reason for access and duration. All actions taken during support access are attributed to the platform admin."})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[{label:"Today",value:N.today,icon:z,color:"blue"},{label:"This Week",value:N.thisWeek,icon:w,color:"green"},{label:"This Month",value:N.thisMonth,icon:w,color:"purple"},{label:"Support Sessions",value:N.impersonationSessions,icon:U,color:"amber"}].map((a,t)=>e.jsx(he.div,{initial:x?!1:{opacity:0,y:20},animate:{opacity:1,y:0},transition:x?{duration:0}:{delay:t*.1},children:e.jsx(F,{className:"p-6 card-hover",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:a.label}),e.jsx("p",{className:"text-2xl font-bold mt-1",children:a.value.toLocaleString()})]}),e.jsx("div",{className:f("p-3 rounded-lg",`bg-${a.color}-500/10`),children:e.jsx(a.icon,{className:f("h-5 w-5",`text-${a.color}-600`)})})]})})},a.label))}),e.jsxs(de,{value:g,onValueChange:A,className:"space-y-6",children:[e.jsxs(ue,{children:[e.jsx(E,{value:"all",children:"All Events"}),e.jsx(E,{value:"platform",children:"Platform Actions"}),o?e.jsxs(E,{value:"impersonation",className:"flex items-center gap-2",children:[e.jsx(U,{className:"h-4 w-4"}),"Support Access",j.length>0&&e.jsx(y,{variant:"secondary",className:"ml-1 text-xs",children:j.length})]}):null]}),e.jsxs(k,{value:"all",className:"space-y-6",children:[e.jsx(D,{filter:s,setFilter:c,dateRange:l,setDateRange:d,onClear:()=>{c(""),d({since:"",until:""})}}),e.jsx(I,{columns:S,data:C,isLoading:r,emptyMessage:"No audit events found"})]}),e.jsxs(k,{value:"platform",className:"space-y-6",children:[e.jsx(D,{filter:s,setFilter:c,dateRange:l,setDateRange:d,onClear:()=>{c(""),d({since:"",until:""})}}),e.jsx(I,{columns:S,data:C,isLoading:r,emptyMessage:"No platform actions found"})]}),o?e.jsxs(k,{value:"impersonation",className:"space-y-6",children:[e.jsx(D,{filter:s,setFilter:c,dateRange:l,setDateRange:d,onClear:()=>{c(""),d({since:"",until:""})}}),e.jsx(I,{columns:S,data:C,isLoading:r,emptyMessage:"No support access events found"})]}):null]})]})}function D({filter:o,setFilter:i,dateRange:n,setDateRange:r,onClear:p}){return e.jsxs(F,{children:[e.jsx(le,{children:e.jsx(oe,{className:"text-base",children:"Filters"})}),e.jsx(ce,{children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx("div",{className:"w-full sm:w-64",children:e.jsx(O,{label:"Action Type",options:fe,value:o,onChange:s=>i(s),name:"actionFilter",autoComplete:"off"})}),e.jsx("div",{className:"w-full sm:w-48",children:e.jsx(R,{label:"From",type:"date",value:n.since,onChange:s=>r({...n,since:s.target.value}),name:"sinceDate",autoComplete:"off"})}),e.jsx("div",{className:"w-full sm:w-48",children:e.jsx(R,{label:"To",type:"date",value:n.until,onChange:s=>r({...n,until:s.target.value}),name:"untilDate",autoComplete:"off"})}),e.jsx("div",{className:"flex items-end",children:e.jsx(B,{variant:"outline",onClick:p,children:"Clear Filters"})})]})})]})}function I({columns:o,data:i,isLoading:n,emptyMessage:r}){return e.jsx(F,{children:i.length===0&&!n?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(w,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:r})]}):e.jsx(ie,{columns:o,data:i,isLoading:n,pagination:!0,pageSize:50,exportable:!1})})}export{Ie as component};
