const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/MfaEnroll-BraR5LX9.js","assets/vendor-DTXcECKj.js","assets/main-D_qbY1gz.js","assets/vendor-sonner-CauEFWQC.js","assets/vendor-motion-DirI8ZVJ.js","assets/vendor-sentry-DWdptYQI.js","assets/Input-CvXUl1_l.js","assets/SessionManager-Dl4AqQbi.js"])))=>i.map(i=>d[i]);
import{f as L,P as R,d as o,B as r,D as U,w as V,x as q,y as G,z as H,_ as A}from"./main-D_qbY1gz.js";import{r as t,j as e,m,$ as K,by as E,bX as T,bz as J,bL as X,bt as $}from"./vendor-DTXcECKj.js";import{C as c}from"./Card-ovhP7agJ.js";import{T as Q,a as W,b as v,c as f}from"./Tabs-B49fZEnE.js";import{a as g}from"./Skeleton-Dk1LJCqK.js";import{I as N}from"./Input-CvXUl1_l.js";import{m as Y}from"./vendor-motion-DirI8ZVJ.js";import"./vendor-sonner-CauEFWQC.js";import"./vendor-sentry-DWdptYQI.js";const Z=t.lazy(()=>A(()=>import("./MfaEnroll-BraR5LX9.js"),__vite__mapDeps([0,1,2,3,4,5,6])).then(n=>({default:n.MfaEnroll}))),ee=t.lazy(()=>A(()=>import("./SessionManager-Dl4AqQbi.js"),__vite__mapDeps([7,1,2,3,4,5])).then(n=>({default:n.SessionManager})));function de(){const[n,_]=t.useState("mfa"),[M,l]=t.useState(!1),[u,p]=t.useState("totp"),[D,y]=t.useState(!1),[b,P]=t.useState(null),[S,h]=t.useState(null),[d,k]=t.useState(null),[x,F]=t.useState(null),[j,B]=t.useState(null),i=L({defaultValues:{currentPassword:"",newPassword:"",confirmPassword:""},onSubmit:async({value:s})=>{if(s.newPassword!==s.confirmPassword){h("Passwords do not match");return}y(!0),h(null),P(null);try{if(!(await fetch("/api/v1/users/me/password",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({current_password:s.currentPassword,new_password:s.newPassword})})).ok)throw new Error("Failed to update password. Step-up authentication may be required.");P("Password updated successfully")}catch(a){h(a instanceof Error?a.message:"Failed to update password")}finally{y(!1)}}}),O=[{type:"totp",name:"Authenticator App",enabled:!0,created_at:"2024-01-15"}];return t.useEffect(()=>{let s=!1;async function a(){try{const[w,C]=await Promise.all([fetch("/api/v1/admin/security/data-encryption/providers"),fetch("/api/v1/admin/security/data-encryption")]);if(!w.ok||!C.ok)throw new Error("Failed to load providers");const z=await w.json(),I=await C.json();s||(k(z),F(I))}catch{s||B("Unable to load data encryption providers")}}return a(),()=>{s=!0}},[]),e.jsxs("div",{className:"space-y-6",children:[e.jsx(R,{title:"Security Settings",description:"Manage your account security and authentication methods",breadcrumbs:[{label:"Settings",href:"/settings"},{label:"Security"}]}),e.jsxs(Q,{value:n,onValueChange:_,children:[e.jsxs(W,{className:"grid w-full grid-cols-3 lg:w-auto",children:[e.jsxs(v,{value:"mfa",className:"gap-2",children:[e.jsx(m,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"MFA"})]}),e.jsxs(v,{value:"sessions",className:"gap-2",children:[e.jsx(K,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Sessions"})]}),e.jsxs(v,{value:"password",className:"gap-2",children:[e.jsx(m,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Password"})]})]}),e.jsxs(f,{value:"mfa",className:"space-y-6",children:[e.jsxs(c,{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium",children:"Multi-Factor Authentication"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Add an extra layer of security to your account"})]}),e.jsx(o,{variant:"success",children:"Enabled"})]}),e.jsxs("div",{className:"mt-6 space-y-3",children:[O.map(s=>e.jsxs(Y.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"p-2 bg-primary/10 rounded-lg",children:[s.type==="totp"&&e.jsx(m,{className:"h-5 w-5 text-primary"}),s.type==="email"&&e.jsx(E,{className:"h-5 w-5 text-primary"}),s.type==="sms"&&e.jsx(T,{className:"h-5 w-5 text-primary"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.name}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Added ",new Date(s.created_at).toLocaleDateString()]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(o,{variant:"success",className:"gap-1",children:[e.jsx(J,{className:"h-3 w-3"}),"Active"]}),e.jsx(r,{variant:"ghost",size:"icon","aria-label":"Remove MFA method",children:e.jsx(X,{className:"h-4 w-4 text-destructive"})})]})]},s.type)),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3 mt-4",children:[e.jsxs(r,{variant:"outline",className:"h-auto py-4 flex-col items-center gap-2",onClick:()=>{p("totp"),l(!0)},children:[e.jsx(m,{className:"h-6 w-6"}),e.jsx("span",{className:"text-sm",children:"Authenticator App"})]}),e.jsxs(r,{variant:"outline",className:"h-auto py-4 flex-col items-center gap-2",onClick:()=>{p("email"),l(!0)},children:[e.jsx(E,{className:"h-6 w-6"}),e.jsx("span",{className:"text-sm",children:"Email OTP"})]}),e.jsxs(r,{variant:"outline",className:"h-auto py-4 flex-col items-center gap-2",onClick:()=>{p("sms"),l(!0)},children:[e.jsx(T,{className:"h-6 w-6"}),e.jsx("span",{className:"text-sm",children:"SMS OTP"})]})]})]})]}),e.jsx(c,{className:"p-6",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"p-3 bg-amber-100 dark:bg-amber-900/20 rounded-lg",children:e.jsx($,{className:"h-6 w-6 text-amber-600 dark:text-amber-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Backup Codes"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Generate backup codes to access your account if you lose your MFA device"}),e.jsx(r,{variant:"outline",className:"mt-4",children:"Generate New Codes"})]})]})})]}),e.jsx(f,{value:"sessions",children:e.jsx(c,{className:"p-6",children:e.jsx(t.Suspense,{fallback:e.jsx(g,{className:"h-64 w-full"}),children:e.jsx(ee,{})})})}),e.jsx(f,{value:"password",children:e.jsxs(c,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-medium mb-4",children:"Change Password"}),S&&e.jsx("p",{className:"mb-3 text-sm text-destructive",children:S}),b&&e.jsx("p",{className:"mb-3 text-sm text-green-600",children:b}),e.jsxs("form",{onSubmit:s=>{s.preventDefault(),s.stopPropagation(),i.handleSubmit()},className:"space-y-4 max-w-md",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Current Password"}),e.jsx(i.Field,{name:"currentPassword",validators:{onChange:({value:s})=>{if(!s)return"Current password is required"}},children:s=>e.jsx(N,{type:"password",placeholder:"Enter current password",value:s.state.value,onChange:a=>s.handleChange(a.target.value),onBlur:s.handleBlur,error:s.state.meta.isTouched?s.state.meta.errors[0]:void 0})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"New Password"}),e.jsx(i.Field,{name:"newPassword",validators:{onChange:({value:s})=>{if(!s)return"New password is required";if(s.length<8)return"Password must be at least 8 characters"}},children:s=>e.jsx(N,{type:"password",placeholder:"Enter new password",value:s.state.value,onChange:a=>s.handleChange(a.target.value),onBlur:s.handleBlur,error:s.state.meta.isTouched?s.state.meta.errors[0]:void 0})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Confirm New Password"}),e.jsx(i.Field,{name:"confirmPassword",validators:{onChange:({value:s})=>{if(!s)return"Please confirm your new password"}},children:s=>e.jsx(N,{type:"password",placeholder:"Confirm new password",value:s.state.value,onChange:a=>s.handleChange(a.target.value),onBlur:s.handleBlur,error:s.state.meta.isTouched?s.state.meta.errors[0]:void 0})}),e.jsx(i.Subscribe,{selector:s=>({newPassword:s.values.newPassword,confirmPassword:s.values.confirmPassword}),children:({newPassword:s,confirmPassword:a})=>a&&s&&a!==s?e.jsx("p",{className:"text-sm text-destructive",children:"Passwords do not match"}):null})]}),e.jsx(r,{type:"submit",isLoading:D,children:"Update Password"})]})]})})]}),e.jsxs(c,{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium",children:"Data Encryption Providers"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Available KMS backends are determined by the current build"})]}),x?.initialized?e.jsx(o,{variant:"success",children:"Initialized"}):e.jsx(o,{variant:"warning",children:"Not Initialized"})]}),e.jsxs("div",{className:"mt-4 space-y-2",children:[j&&e.jsx("p",{className:"text-sm text-destructive",children:j}),!d&&!j&&e.jsx(g,{className:"h-20 w-full"}),d&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex flex-wrap gap-2",children:d.supported.map(s=>e.jsx(o,{variant:"outline",children:s.replace("_"," ").toUpperCase()},s))}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Default provider: ",e.jsx("span",{className:"font-medium",children:d.default})]}),x&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Active provider: ",e.jsx("span",{className:"font-medium",children:x.provider})]})]})]})]}),e.jsx(U,{open:M,onOpenChange:l,children:e.jsxs(V,{className:"max-w-md",children:[e.jsxs(q,{children:[e.jsxs(G,{children:["Set Up ",u==="totp"?"Authenticator App":u==="email"?"Email OTP":"SMS OTP"]}),e.jsx(H,{children:"Add an extra layer of security to your account"})]}),e.jsx(t.Suspense,{fallback:e.jsx(g,{className:"h-72 w-full"}),children:e.jsx(Z,{method:u,onEnroll:async s=>{await new Promise(a=>setTimeout(a,1e3))},onCancel:()=>l(!1)})})]})})]})}export{de as component};
