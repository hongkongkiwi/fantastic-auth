import{b}from"./main-BdAAzOp_.js";var j=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(t){return this.listeners.add(t),this.onSubscribe(),()=>{this.listeners.delete(t),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},$={setTimeout:(t,e)=>setTimeout(t,e),clearTimeout:t=>clearTimeout(t),setInterval:(t,e)=>setInterval(t,e),clearInterval:t=>clearInterval(t)},q=class{#e=$;#t=!1;setTimeoutProvider(t){this.#e=t}setTimeout(t,e){return this.#e.setTimeout(t,e)}clearTimeout(t){this.#e.clearTimeout(t)}setInterval(t,e){return this.#e.setInterval(t,e)}clearInterval(t){this.#e.clearInterval(t)}},I=new q;function tt(t){setTimeout(t,0)}var O=typeof window>"u"||"Deno"in globalThis;function P(){}function A(t){return typeof t=="number"&&t>=0&&t!==1/0}function et(t,e){return Math.max(t+(e||0)-Date.now(),0)}function S(t,e){return typeof t=="function"?t(e):t}function p(t,e){return typeof t=="function"?t(e):t}function Mt(t){return JSON.stringify(t,(e,s)=>Q(s)?Object.keys(s).sort().reduce((r,i)=>(r[i]=s[i],r),{}):s)}var st=Object.prototype.hasOwnProperty;function Z(t,e,s=0){if(t===e)return t;if(s>500)return e;const r=B(t)&&B(e);if(!r&&!(Q(t)&&Q(e)))return e;const h=(r?t:Object.keys(t)).length,a=r?e:Object.keys(e),n=a.length,l=r?new Array(n):{};let u=0;for(let o=0;o<n;o++){const f=r?o:a[o],c=t[f],v=e[f];if(c===v){l[f]=c,(r?o<h:st.call(t,f))&&u++;continue}if(c===null||v===null||typeof c!="object"||typeof v!="object"){l[f]=v;continue}const m=Z(c,v,s+1);l[f]=m,m===c&&u++}return h===n&&u===h?t:l}function x(t,e){if(!e||Object.keys(t).length!==Object.keys(e).length)return!1;for(const s in t)if(t[s]!==e[s])return!1;return!0}function B(t){return Array.isArray(t)&&t.length===Object.keys(t).length}function Q(t){if(!z(t))return!1;const e=t.constructor;if(e===void 0)return!0;const s=e.prototype;return!(!z(s)||!s.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(t)!==Object.prototype)}function z(t){return Object.prototype.toString.call(t)==="[object Object]"}function H(t,e,s){return typeof s.structuralSharing=="function"?s.structuralSharing(t,e):s.structuralSharing!==!1?Z(t,e):e}function G(t,e){return typeof t=="function"?t(...e):!!t}var rt=class extends j{#e;#t;#r;constructor(){super(),this.#r=t=>{if(!O&&window.addEventListener){const e=()=>t();return window.addEventListener("visibilitychange",e,!1),()=>{window.removeEventListener("visibilitychange",e)}}}}onSubscribe(){this.#t||this.setEventListener(this.#r)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(t){this.#r=t,this.#t?.(),this.#t=t(e=>{typeof e=="boolean"?this.setFocused(e):this.onFocus()})}setFocused(t){this.#e!==t&&(this.#e=t,this.onFocus())}onFocus(){const t=this.isFocused();this.listeners.forEach(e=>{e(t)})}isFocused(){return typeof this.#e=="boolean"?this.#e:globalThis.document?.visibilityState!=="hidden"}},it=new rt;function W(){let t,e;const s=new Promise((i,h)=>{t=i,e=h});s.status="pending",s.catch(()=>{});function r(i){Object.assign(s,i),delete s.resolve,delete s.reject}return s.resolve=i=>{r({status:"fulfilled",value:i}),t(i)},s.reject=i=>{r({status:"rejected",reason:i}),e(i)},s}var nt=tt;function ot(){let t=[],e=0,s=n=>{n()},r=n=>{n()},i=nt;const h=n=>{e?t.push(n):i(()=>{s(n)})},a=()=>{const n=t;t=[],n.length&&i(()=>{r(()=>{n.forEach(l=>{s(l)})})})};return{batch:n=>{let l;e++;try{l=n()}finally{e--,e||a()}return l},batchCalls:n=>(...l)=>{h(()=>{n(...l)})},schedule:h,setNotifyFunction:n=>{s=n},setBatchNotifyFunction:n=>{r=n},setScheduler:n=>{i=n}}}var X=ot(),at=class extends j{#e=!0;#t;#r;constructor(){super(),this.#r=t=>{if(!O&&window.addEventListener){const e=()=>t(!0),s=()=>t(!1);return window.addEventListener("online",e,!1),window.addEventListener("offline",s,!1),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",s)}}}}onSubscribe(){this.#t||this.setEventListener(this.#r)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(t){this.#r=t,this.#t?.(),this.#t=t(this.setOnline.bind(this))}setOnline(t){this.#e!==t&&(this.#e=t,this.listeners.forEach(s=>{s(t)}))}isOnline(){return this.#e}},ct=new at;function ht(t){return(t??"online")==="online"?ct.isOnline():!0}function ut(t,e){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:ht(e.networkMode)?"fetching":"paused",...t===void 0&&{error:null,status:"pending"}}}var lt=class extends j{constructor(t,e){super(),this.options=e,this.#e=t,this.#n=null,this.#i=W(),this.bindMethods(),this.setOptions(e)}#e;#t=void 0;#r=void 0;#s=void 0;#a;#l;#i;#n;#b;#f;#d;#c;#h;#o;#p=new Set;bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(this.#t.addObserver(this),V(this.#t,this.options)?this.#u():this.updateResult(),this.#m())}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return L(this.#t,this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return L(this.#t,this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,this.#R(),this.#S(),this.#t.removeObserver(this)}setOptions(t){const e=this.options,s=this.#t;if(this.options=this.#e.defaultQueryOptions(t),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof p(this.options.enabled,this.#t)!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");this.#O(),this.#t.setOptions(this.options),e._defaulted&&!x(this.options,e)&&this.#e.getQueryCache().notify({type:"observerOptionsUpdated",query:this.#t,observer:this});const r=this.hasListeners();r&&K(this.#t,s,this.options,e)&&this.#u(),this.updateResult(),r&&(this.#t!==s||p(this.options.enabled,this.#t)!==p(e.enabled,this.#t)||S(this.options.staleTime,this.#t)!==S(e.staleTime,this.#t))&&this.#v();const i=this.#y();r&&(this.#t!==s||p(this.options.enabled,this.#t)!==p(e.enabled,this.#t)||i!==this.#o)&&this.#g(i)}getOptimisticResult(t){const e=this.#e.getQueryCache().build(this.#e,t),s=this.createResult(e,t);return dt(this,s)&&(this.#s=s,this.#l=this.options,this.#a=this.#t.state),s}getCurrentResult(){return this.#s}trackResult(t,e){return new Proxy(t,{get:(s,r)=>(this.trackProp(r),e?.(r),r==="promise"&&(this.trackProp("data"),!this.options.experimental_prefetchInRender&&this.#i.status==="pending"&&this.#i.reject(new Error("experimental_prefetchInRender feature flag is not enabled"))),Reflect.get(s,r))})}trackProp(t){this.#p.add(t)}getCurrentQuery(){return this.#t}refetch({...t}={}){return this.fetch({...t})}fetchOptimistic(t){const e=this.#e.defaultQueryOptions(t),s=this.#e.getQueryCache().build(this.#e,e);return s.fetch().then(()=>this.createResult(s,e))}fetch(t){return this.#u({...t,cancelRefetch:t.cancelRefetch??!0}).then(()=>(this.updateResult(),this.#s))}#u(t){this.#O();let e=this.#t.fetch(this.options,t);return t?.throwOnError||(e=e.catch(P)),e}#v(){this.#R();const t=S(this.options.staleTime,this.#t);if(O||this.#s.isStale||!A(t))return;const s=et(this.#s.dataUpdatedAt,t)+1;this.#c=I.setTimeout(()=>{this.#s.isStale||this.updateResult()},s)}#y(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(this.#t):this.options.refetchInterval)??!1}#g(t){this.#S(),this.#o=t,!(O||p(this.options.enabled,this.#t)===!1||!A(this.#o)||this.#o===0)&&(this.#h=I.setInterval(()=>{(this.options.refetchIntervalInBackground||it.isFocused())&&this.#u()},this.#o))}#m(){this.#v(),this.#g(this.#y())}#R(){this.#c&&(I.clearTimeout(this.#c),this.#c=void 0)}#S(){this.#h&&(I.clearInterval(this.#h),this.#h=void 0)}createResult(t,e){const s=this.#t,r=this.options,i=this.#s,h=this.#a,a=this.#l,l=t!==s?t.state:this.#r,{state:u}=t;let o={...u},f=!1,c;if(e._optimisticResults){const d=this.hasListeners(),R=!d&&V(t,e),E=d&&K(t,s,e,r);(R||E)&&(o={...o,...ut(u.data,t.options)}),e._optimisticResults==="isRestoring"&&(o.fetchStatus="idle")}let{error:v,errorUpdatedAt:m,status:g}=o;c=o.data;let U=!1;if(e.placeholderData!==void 0&&c===void 0&&g==="pending"){let d;i?.isPlaceholderData&&e.placeholderData===a?.placeholderData?(d=i.data,U=!0):d=typeof e.placeholderData=="function"?e.placeholderData(this.#d?.state.data,this.#d):e.placeholderData,d!==void 0&&(g="success",c=H(i?.data,d,e),f=!0)}if(e.select&&c!==void 0&&!U)if(i&&c===h?.data&&e.select===this.#b)c=this.#f;else try{this.#b=e.select,c=e.select(c),c=H(i?.data,c,e),this.#f=c,this.#n=null}catch(d){this.#n=d}this.#n&&(v=this.#n,c=this.#f,m=Date.now(),g="error");const T=o.fetchStatus==="fetching",F=g==="pending",M=g==="error",D=F&&T,k=c!==void 0,y={status:g,fetchStatus:o.fetchStatus,isPending:F,isSuccess:g==="success",isError:M,isInitialLoading:D,isLoading:D,data:c,dataUpdatedAt:o.dataUpdatedAt,error:v,errorUpdatedAt:m,failureCount:o.fetchFailureCount,failureReason:o.fetchFailureReason,errorUpdateCount:o.errorUpdateCount,isFetched:o.dataUpdateCount>0||o.errorUpdateCount>0,isFetchedAfterMount:o.dataUpdateCount>l.dataUpdateCount||o.errorUpdateCount>l.errorUpdateCount,isFetching:T,isRefetching:T&&!F,isLoadingError:M&&!k,isPaused:o.fetchStatus==="paused",isPlaceholderData:f,isRefetchError:M&&k,isStale:_(t,e),refetch:this.refetch,promise:this.#i,isEnabled:p(e.enabled,t)!==!1};if(this.options.experimental_prefetchInRender){const d=y.data!==void 0,R=y.status==="error"&&!d,E=C=>{R?C.reject(y.error):d&&C.resolve(y.data)},N=()=>{const C=this.#i=y.promise=W();E(C)},w=this.#i;switch(w.status){case"pending":t.queryHash===s.queryHash&&E(w);break;case"fulfilled":(R||y.data!==w.value)&&N();break;case"rejected":(!R||y.error!==w.reason)&&N();break}}return y}updateResult(){const t=this.#s,e=this.createResult(this.#t,this.options);if(this.#a=this.#t.state,this.#l=this.options,this.#a.data!==void 0&&(this.#d=this.#t),x(e,t))return;this.#s=e;const s=()=>{if(!t)return!0;const{notifyOnChangeProps:r}=this.options,i=typeof r=="function"?r():r;if(i==="all"||!i&&!this.#p.size)return!0;const h=new Set(i??this.#p);return this.options.throwOnError&&h.add("error"),Object.keys(this.#s).some(a=>{const n=a;return this.#s[n]!==t[n]&&h.has(n)})};this.#E({listeners:s()})}#O(){const t=this.#e.getQueryCache().build(this.#e,this.options);if(t===this.#t)return;const e=this.#t;this.#t=t,this.#r=t.state,this.hasListeners()&&(e?.removeObserver(this),t.addObserver(this))}onQueryUpdate(){this.updateResult(),this.hasListeners()&&this.#m()}#E(t){X.batch(()=>{t.listeners&&this.listeners.forEach(e=>{e(this.#s)}),this.#e.getQueryCache().notify({query:this.#t,type:"observerResultsUpdated"})})}};function ft(t,e){return p(e.enabled,t)!==!1&&t.state.data===void 0&&!(t.state.status==="error"&&e.retryOnMount===!1)}function V(t,e){return ft(t,e)||t.state.data!==void 0&&L(t,e,e.refetchOnMount)}function L(t,e,s){if(p(e.enabled,t)!==!1&&S(e.staleTime,t)!=="static"){const r=typeof s=="function"?s(t):s;return r==="always"||r!==!1&&_(t,e)}return!1}function K(t,e,s,r){return(t!==e||p(r.enabled,t)===!1)&&(!s.suspense||t.state.status!=="error")&&_(t,s)}function _(t,e){return p(e.enabled,t)!==!1&&t.isStaleByTime(S(e.staleTime,t))}function dt(t,e){return!x(t.getCurrentResult(),e)}var pt=b.createContext(void 0),bt=t=>{const e=b.useContext(pt);if(!e)throw new Error("No QueryClient set, use QueryClientProvider to set one");return e},Y=b.createContext(!1),vt=()=>b.useContext(Y);Y.Provider;function yt(){let t=!1;return{clearReset:()=>{t=!1},reset:()=>{t=!0},isReset:()=>t}}var gt=b.createContext(yt()),mt=()=>b.useContext(gt),Rt=(t,e,s)=>{const r=s?.state.error&&typeof t.throwOnError=="function"?G(t.throwOnError,[s.state.error,s]):t.throwOnError;(t.suspense||t.experimental_prefetchInRender||r)&&(e.isReset()||(t.retryOnMount=!1))},St=t=>{b.useEffect(()=>{t.clearReset()},[t])},Ot=({result:t,errorResetBoundary:e,throwOnError:s,query:r,suspense:i})=>t.isError&&!e.isReset()&&!t.isFetching&&r&&(i&&t.data===void 0||G(s,[t.error,r])),Et=t=>{if(t.suspense){const s=i=>i==="static"?i:Math.max(i??1e3,1e3),r=t.staleTime;t.staleTime=typeof r=="function"?(...i)=>s(r(...i)):s(r),typeof t.gcTime=="number"&&(t.gcTime=Math.max(t.gcTime,1e3))}},wt=(t,e)=>t.isLoading&&t.isFetching&&!e,Ct=(t,e)=>t?.suspense&&e.isPending,J=(t,e,s)=>e.fetchOptimistic(t).catch(()=>{s.clearReset()});function It(t,e,s){const r=vt(),i=mt(),h=bt(),a=h.defaultQueryOptions(t);h.getDefaultOptions().queries?._experimental_beforeQuery?.(a);const n=h.getQueryCache().get(a.queryHash);a._optimisticResults=r?"isRestoring":"optimistic",Et(a),Rt(a,i,n),St(i);const l=!h.getQueryCache().get(a.queryHash),[u]=b.useState(()=>new e(h,a)),o=u.getOptimisticResult(a),f=!r&&t.subscribed!==!1;if(b.useSyncExternalStore(b.useCallback(c=>{const v=f?u.subscribe(X.batchCalls(c)):P;return u.updateResult(),v},[u,f]),()=>u.getCurrentResult(),()=>u.getCurrentResult()),b.useEffect(()=>{u.setOptions(a)},[a,u]),Ct(a,o))throw J(a,u,i);if(Ot({result:o,errorResetBoundary:i,throwOnError:a.throwOnError,query:n,suspense:a.suspense}))throw o.error;return h.getDefaultOptions().queries?._experimental_afterQuery?.(a,o),a.experimental_prefetchInRender&&!O&&wt(o,r)&&(l?J(a,u,i):n?.promise)?.catch(P).finally(()=>{u.updateResult()}),a.notifyOnChangeProps?o:u.trackResult(o)}function Pt(t,e){return It(t,lt)}export{j as S,Pt as a,P as b,G as c,Mt as h,X as n,x as s,bt as u};
