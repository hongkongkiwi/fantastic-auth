import{c as W,b as m,L as g,j as e,al as D,m as i,aj as F,W as f,D as N,f as k,h as C,i as w,k as L,l as E}from"./main-BdAAzOp_.js";import{u as S,a as T}from"./useQuery-ButOQx42.js";import{u as j}from"./useMutation-BBfU30nI.js";import{I as y}from"./Input-DmXcK8Ek.js";import{C as M}from"./circle-check-big-BtZ3JG_-.js";import{C as O}from"./circle-x-SXQhcWML.js";import{T as U}from"./trash-2-BL6sv700.js";const A=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],P=W("pen",A),q=[{value:"user.created",label:"User Created"},{value:"user.updated",label:"User Updated"},{value:"user.deleted",label:"User Deleted"},{value:"user.login",label:"User Login"},{value:"user.login_failed",label:"Login Failed"},{value:"session.created",label:"Session Created"},{value:"session.revoked",label:"Session Revoked"},{value:"mfa.enabled",label:"MFA Enabled"},{value:"mfa.disabled",label:"MFA Disabled"},{value:"*",label:"All Events"}];function J(){const[r,t]=m.useState(!1),[n,o]=m.useState(null),l=S(),{data:c,isLoading:d}=T({queryKey:["webhooks"],queryFn:async()=>{const s=await fetch("/api/v1/admin/webhooks");if(!s.ok)throw new Error("Failed to load webhooks");return s.json()}}),u=j({mutationFn:async({id:s,active:x})=>{await fetch(`/api/v1/admin/webhooks/${s}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({active:x})})},onSuccess:()=>{l.invalidateQueries({queryKey:["webhooks"]})}}),h=j({mutationFn:async s=>{await fetch(`/api/v1/admin/webhooks/${s}`,{method:"DELETE"})},onSuccess:()=>{l.invalidateQueries({queryKey:["webhooks"]}),g.success("Webhook deleted")}});return d?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(D,{className:"h-6 w-6 animate-spin"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium",children:"Webhook Endpoints"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Configure endpoints to receive event notifications"})]}),e.jsxs(i,{onClick:()=>t(!0),children:[e.jsx(F,{className:"mr-2 h-4 w-4"}),"Add Webhook"]})]}),c?.length===0?e.jsxs("div",{className:"text-center py-12 border rounded-lg",children:[e.jsx(f,{className:"h-12 w-12 mx-auto text-muted-foreground/50 mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"No webhooks configured"}),e.jsx(i,{variant:"outline",className:"mt-4",onClick:()=>t(!0),children:"Create your first webhook"})]}):e.jsx("div",{className:"space-y-3",children:c?.map(s=>e.jsxs("div",{className:"p-4 border rounded-lg flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`p-2 rounded-full ${s.active?"bg-green-100 text-green-600":"bg-gray-100 text-gray-600"}`,children:e.jsx(f,{className:"h-4 w-4"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.url}),e.jsx("div",{className:"flex items-center gap-2 mt-1",children:s.events.includes("*")?e.jsx("span",{className:"text-xs px-2 py-0.5 bg-primary/10 rounded",children:"All events"}):e.jsxs("span",{className:"text-xs text-muted-foreground",children:[s.events.length," event",s.events.length!==1?"s":""]})})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(i,{variant:"ghost",size:"sm",onClick:()=>u.mutate({id:s.id,active:!s.active}),children:s.active?e.jsx(M,{className:"h-4 w-4 text-green-500"}):e.jsx(O,{className:"h-4 w-4 text-gray-400"})}),e.jsx(i,{variant:"ghost",size:"sm",onClick:()=>o(s),children:e.jsx(P,{className:"h-4 w-4"})}),e.jsx(i,{variant:"ghost",size:"sm",onClick:()=>h.mutate(s.id),disabled:h.isPending,children:e.jsx(U,{className:"h-4 w-4 text-destructive"})})]})]},s.id))}),e.jsx(I,{open:r,onClose:()=>t(!1)}),n&&e.jsx(Q,{webhook:n,open:!0,onClose:()=>o(null)})]})}function I({open:r,onClose:t}){const[n,o]=m.useState(""),[l,c]=m.useState(""),[d,u]=m.useState([]),h=S(),s=j({mutationFn:async()=>{const a=await fetch("/api/v1/admin/webhooks",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:n,url:l,events:d})});if(!a.ok)throw new Error("Failed to create webhook");return a.json()},onSuccess:()=>{h.invalidateQueries({queryKey:["webhooks"]}),g.success("Webhook created"),t(),o(""),c(""),u([])},onError:()=>g.error("Failed to create webhook")}),x=a=>{u(a==="*"?["*"]:v=>{const b=v.filter(p=>p!=="*");return v.includes(a)?b.filter(p=>p!==a):[...b,a]})};return e.jsx(N,{open:r,onOpenChange:t,children:e.jsxs(k,{className:"max-w-lg",children:[e.jsxs(C,{children:[e.jsx(w,{children:"Add Webhook Endpoint"}),e.jsx(L,{children:"Configure a URL to receive event notifications"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsx("div",{className:"space-y-2",children:e.jsx(y,{label:"Name",value:n,onChange:a=>o(a.target.value),placeholder:"My Webhook",name:"webhookName",autoComplete:"off"})}),e.jsx("div",{className:"space-y-2",children:e.jsx(y,{label:"URL",value:l,onChange:a=>c(a.target.value),placeholder:"https://example.com/webhook",type:"url",name:"webhookUrl",autoComplete:"url"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Events"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:q.map(a=>e.jsx("button",{onClick:()=>x(a.value),className:`px-3 py-1 text-xs rounded-full border transition-colors ${d.includes(a.value)?"bg-primary text-primary-foreground border-primary":"bg-background hover:bg-muted"}`,children:a.label},a.value))})]})]}),e.jsxs(E,{children:[e.jsx(i,{variant:"outline",onClick:t,children:"Cancel"}),e.jsx(i,{onClick:()=>s.mutate(),disabled:!n||!l||d.length===0||s.isPending,isLoading:s.isPending,children:"Create Webhook"})]})]})})}function Q({webhook:r,open:t,onClose:n}){return e.jsx(N,{open:t,onOpenChange:n,children:e.jsxs(k,{children:[e.jsx(C,{children:e.jsx(w,{children:"Edit Webhook"})}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:['Editing webhook "',r.name,'" is not yet implemented']}),e.jsx(E,{children:e.jsx(i,{onClick:n,children:"Close"})})]})})}export{J as WebhookManager};
