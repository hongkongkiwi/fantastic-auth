import{b as A,j as U,ay as _}from"./main-BdAAzOp_.js";const R=new WeakMap,Z=new WeakMap,st={current:[]};let at=!1,K=0;const x=new Set,z=new Map;function bt(r){const a=Array.from(r).sort((t,e)=>t instanceof I&&t.options.deps.includes(e)?1:e instanceof I&&e.options.deps.includes(t)?-1:0);for(const t of a){if(st.current.includes(t))continue;st.current.push(t),t.recompute();const e=Z.get(t);if(e)for(const i of e){const s=R.get(i);s&&bt(s)}}}function Et(r){const a={prevVal:r.prevState,currentVal:r.state};for(const t of r.listeners)t(a)}function At(r){const a={prevVal:r.prevState,currentVal:r.state};for(const t of r.listeners)t(a)}function yt(r){if(K>0&&!z.has(r)&&z.set(r,r.prevState),x.add(r),!(K>0)&&!at)try{for(at=!0;x.size>0;){const a=Array.from(x);x.clear();for(const t of a){const e=z.get(t)??t.prevState;t.prevState=e,Et(t)}for(const t of a){const e=R.get(t);e&&(st.current.push(t),bt(e))}for(const t of a){const e=R.get(t);if(e)for(const i of e)At(i)}}}finally{at=!1,st.current=[],z.clear()}}function L(r){K++;try{r()}finally{if(K--,K===0){const a=x.values().next().value;a&&yt(a)}}}function wt(r){return typeof r=="function"}class ot{constructor(a,t){this.listeners=new Set,this.subscribe=e=>{var i,s;this.listeners.add(e);const n=(s=(i=this.options)==null?void 0:i.onSubscribe)==null?void 0:s.call(i,e,this);return()=>{this.listeners.delete(e),n?.()}},this.prevState=a,this.state=a,this.options=t}setState(a){var t,e,i;this.prevState=this.state,(t=this.options)!=null&&t.updateFn?this.state=this.options.updateFn(this.prevState)(a):wt(a)?this.state=a(this.prevState):this.state=a,(i=(e=this.options)==null?void 0:e.onUpdate)==null||i.call(e),yt(this)}}class I{constructor(a){this.listeners=new Set,this._subscriptions=[],this.lastSeenDepValues=[],this.getDepVals=()=>{const t=this.options.deps.length,e=new Array(t),i=new Array(t);for(let s=0;s<t;s++){const n=this.options.deps[s];e[s]=n.prevState,i[s]=n.state}return this.lastSeenDepValues=i,{prevDepVals:e,currDepVals:i,prevVal:this.prevState??void 0}},this.recompute=()=>{var t,e;this.prevState=this.state;const i=this.getDepVals();this.state=this.options.fn(i),(e=(t=this.options).onUpdate)==null||e.call(t)},this.checkIfRecalculationNeededDeeply=()=>{for(const s of this.options.deps)s instanceof I&&s.checkIfRecalculationNeededDeeply();let t=!1;const e=this.lastSeenDepValues,{currDepVals:i}=this.getDepVals();for(let s=0;s<i.length;s++)if(i[s]!==e[s]){t=!0;break}t&&this.recompute()},this.mount=()=>(this.registerOnGraph(),this.checkIfRecalculationNeededDeeply(),()=>{this.unregisterFromGraph();for(const t of this._subscriptions)t()}),this.subscribe=t=>{var e,i;this.listeners.add(t);const s=(i=(e=this.options).onSubscribe)==null?void 0:i.call(e,t,this);return()=>{this.listeners.delete(t),s?.()}},this.options=a,this.state=a.fn({prevDepVals:void 0,prevVal:void 0,currDepVals:this.getDepVals().currDepVals})}registerOnGraph(a=this.options.deps){for(const t of a)if(t instanceof I)t.registerOnGraph(),this.registerOnGraph(t.options.deps);else if(t instanceof ot){let e=R.get(t);e||(e=new Set,R.set(t,e)),e.add(this);let i=Z.get(this);i||(i=new Set,Z.set(this,i)),i.add(t)}}unregisterFromGraph(a=this.options.deps){for(const t of a)if(t instanceof I)this.unregisterFromGraph(t.options.deps);else if(t instanceof ot){const e=R.get(t);e&&e.delete(this);const i=Z.get(this);i&&i.delete(t)}}}var Lt=class{constructor(r,a){this.fn=r,this.options=a,this.lastExecutionTime=0,this.isPending=!1,this.maybeExecute=(...t)=>{const e=Date.now()-this.lastExecutionTime;if(this.options.leading&&e>=this.options.wait)this.execute(...t);else if(this.lastArgs=t,!this.timeoutId&&this.options.trailing){const i=this.options.wait-e;this.isPending=!0,this.timeoutId=setTimeout(()=>{this.lastArgs!==void 0&&this.execute(...this.lastArgs)},i)}},this.execute=(...t)=>{this.fn(...t),this.options.onExecute?.(t,this),this.lastExecutionTime=Date.now(),this.clearTimeout(),this.lastArgs=void 0,this.isPending=!1},this.flush=()=>{this.isPending&&this.lastArgs&&this.execute(...this.lastArgs)},this.cancel=()=>{this.clearTimeout(),this.lastArgs=void 0,this.isPending=!1},this.clearTimeout=()=>{this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=void 0)},this.options.leading===void 0&&this.options.trailing===void 0&&(this.options.leading=!0,this.options.trailing=!0)}};function It(r,a){return new Lt(r,a).maybeExecute}class Tt{#a=!0;#e;#t;#c;#s;#o;#i;#l;#h=0;#m=5;#n=!1;#u=!1;#r=null;#f=()=>{this.debugLog("Connected to event bus"),this.#o=!0,this.#n=!1,this.debugLog("Emitting queued events",this.#s),this.#s.forEach(a=>this.emitEventToBus(a)),this.#s=[],this.stopConnectLoop(),this.#t().removeEventListener("tanstack-connect-success",this.#f)};#d=()=>{if(this.#h<this.#m){this.#h++,this.dispatchCustomEvent("tanstack-connect",{});return}this.#t().removeEventListener("tanstack-connect",this.#d),this.#u=!0,this.debugLog("Max retries reached, giving up on connection"),this.stopConnectLoop()};#v=()=>{this.#n||(this.#n=!0,this.#t().addEventListener("tanstack-connect-success",this.#f),this.#d())};constructor({pluginId:a,debug:t=!1,enabled:e=!0,reconnectEveryMs:i=300}){this.#e=a,this.#a=e,this.#t=this.getGlobalTarget,this.#c=t,this.debugLog(" Initializing event subscription for plugin",this.#e),this.#s=[],this.#o=!1,this.#u=!1,this.#i=null,this.#l=i}startConnectLoop(){this.#i!==null||this.#o||(this.debugLog(`Starting connect loop (every ${this.#l}ms)`),this.#i=setInterval(this.#d,this.#l))}stopConnectLoop(){this.#n=!1,this.#i!==null&&(clearInterval(this.#i),this.#i=null,this.#s=[],this.debugLog("Stopped connect loop"))}debugLog(...a){this.#c&&console.log(`ðŸŒ´ [tanstack-devtools:${this.#e}-plugin]`,...a)}getGlobalTarget(){if(typeof globalThis<"u"&&globalThis.__TANSTACK_EVENT_TARGET__)return this.debugLog("Using global event target"),globalThis.__TANSTACK_EVENT_TARGET__;if(typeof window<"u"&&typeof window.addEventListener<"u")return this.debugLog("Using window as event target"),window;const a=typeof EventTarget<"u"?new EventTarget:void 0;return typeof a>"u"||typeof a.addEventListener>"u"?(this.debugLog("No event mechanism available, running in non-web environment"),{addEventListener:()=>{},removeEventListener:()=>{},dispatchEvent:()=>!1}):(this.debugLog("Using new EventTarget as fallback"),a)}getPluginId(){return this.#e}dispatchCustomEventShim(a,t){try{const e=new Event(a,{detail:t});this.#t().dispatchEvent(e)}catch{this.debugLog("Failed to dispatch shim event")}}dispatchCustomEvent(a,t){try{this.#t().dispatchEvent(new CustomEvent(a,{detail:t}))}catch{this.dispatchCustomEventShim(a,t)}}emitEventToBus(a){this.debugLog("Emitting event to client bus",a),this.dispatchCustomEvent("tanstack-dispatch-event",a)}createEventPayload(a,t){return{type:`${this.#e}:${a}`,payload:t,pluginId:this.#e}}emit(a,t){if(!this.#a){this.debugLog("Event bus client is disabled, not emitting event",a,t);return}if(this.#r&&(this.debugLog("Emitting event to internal event target",a,t),this.#r.dispatchEvent(new CustomEvent(`${this.#e}:${a}`,{detail:this.createEventPayload(a,t)}))),this.#u){this.debugLog("Previously failed to connect, not emitting to bus");return}if(!this.#o){this.debugLog("Bus not available, will be pushed as soon as connected"),this.#s.push(this.createEventPayload(a,t)),typeof CustomEvent<"u"&&!this.#n&&(this.#v(),this.startConnectLoop());return}return this.emitEventToBus(this.createEventPayload(a,t))}on(a,t,e){const i=e?.withEventTarget??!1,s=`${this.#e}:${a}`;if(i&&(this.#r||(this.#r=new EventTarget),this.#r.addEventListener(s,l=>{t(l.detail)})),!this.#a)return this.debugLog("Event bus client is disabled, not registering event",s),()=>{};const n=l=>{this.debugLog("Received event from bus",l.detail),t(l.detail)};return this.#t().addEventListener(s,n),this.debugLog("Registered event to bus",s),()=>{i&&this.#r?.removeEventListener(s,n),this.#t().removeEventListener(s,n)}}onAll(a){if(!this.#a)return this.debugLog("Event bus client is disabled, not registering event"),()=>{};const t=e=>{const i=e.detail;a(i)};return this.#t().addEventListener("tanstack-devtools-global",t),()=>this.#t().removeEventListener("tanstack-devtools-global",t)}onAllPluginEvents(a){if(!this.#a)return this.debugLog("Event bus client is disabled, not registering event"),()=>{};const t=e=>{const i=e.detail;this.#e&&i.pluginId!==this.#e||a(i)};return this.#t().addEventListener("tanstack-devtools-global",t),()=>this.#t().removeEventListener("tanstack-devtools-global",t)}}class Dt extends Tt{constructor(){super({pluginId:"form-devtools",reconnectEveryMs:1e3})}}const E=new Dt;function rt(r,a){return typeof r=="function"?r(a):r}function q(r,a){return ht(a).reduce((e,i)=>{if(e===null)return null;if(typeof e<"u")return e[i]},r)}function H(r,a,t){const e=ht(a);function i(s){if(!e.length)return rt(t,s);const n=e.shift();if(typeof n=="string"||typeof n=="number"&&!Array.isArray(s))return typeof s=="object"?(s===null&&(s={}),{...s,[n]:i(s[n])}):{[n]:i()};if(Array.isArray(s)&&typeof n=="number"){const l=s.slice(0,n);return[...l.length?l:new Array(n),i(s[n]),...s.slice(n+1)]}return[...new Array(n),i()]}return i(r)}function _t(r,a){const t=ht(a);function e(i){if(!i)return;if(t.length===1){const n=t[0];if(Array.isArray(i)&&typeof n=="number")return i.filter((h,o)=>o!==n);const{[n]:l,...u}=i;return u}const s=t.shift();if((typeof s=="string"||typeof s=="number"&&!Array.isArray(i))&&typeof i=="object")return{...i,[s]:e(i[s])};if(typeof s=="number"&&Array.isArray(i)){if(s>=i.length)return i;const n=i.slice(0,s);return[...n.length?n:new Array(s),e(i[s]),...i.slice(s+1)]}throw new Error("It seems we have created an infinite loop in deleteBy. ")}return e(r)}const kt=/^(\d+)$/gm,Ot=/\.(\d+)(?=\.)/gm,Ct=/^(\d+)\./gm,Bt=/\.(\d+$)/gm,Pt=/\.{2,}/gm,lt="__int__",X=`${lt}$1`;function ht(r){if(Array.isArray(r))return[...r];if(typeof r!="string")throw new Error("Path must be a string.");return r.replace(/(^\[)|]/gm,"").replace(/\[/g,".").replace(kt,X).replace(Ot,`.${X}.`).replace(Ct,`${X}.`).replace(Bt,`.${X}`).replace(Pt,".").split(".").map(a=>{if(a.startsWith(lt)){const t=a.substring(lt.length),e=parseInt(t,10);return String(e)===t?e:t}return a})}function $t(r){return!(Array.isArray(r)&&r.length===0)}function ut(r,a){const t=e=>e.validators.filter(Boolean).map(i=>({cause:i.cause,validate:i.fn}));return a.validationLogic({form:a.form,validators:a.validators,event:{type:r,async:!1},runValidation:t})}function dt(r,a){const{asyncDebounceMs:t}=a,{onBlurAsyncDebounceMs:e,onChangeAsyncDebounceMs:i,onDynamicAsyncDebounceMs:s}=a.validators||{},n=t??0,l=u=>u.validators.filter(Boolean).map(h=>{const o=h?.cause||r;let c=n;switch(o){case"change":c=i??n;break;case"blur":c=e??n;break;case"dynamic":c=s??n;break;case"submit":c=0;break}return r==="submit"&&(c=0),{cause:o,validate:h.fn,debounceMs:c}});return a.validationLogic({form:a.form,validators:a.validators,event:{type:r,async:!0},runValidation:l})}const ct=r=>!!r&&typeof r=="object"&&"fields"in r;function k(r,a){if(Object.is(r,a))return!0;if(typeof r!="object"||r===null||typeof a!="object"||a===null)return!1;if(r instanceof Date&&a instanceof Date)return r.getTime()===a.getTime();if(r instanceof Map&&a instanceof Map){if(r.size!==a.size)return!1;for(const[i,s]of r)if(!a.has(i)||!Object.is(s,a.get(i)))return!1;return!0}if(r instanceof Set&&a instanceof Set){if(r.size!==a.size)return!1;for(const i of r)if(!a.has(i))return!1;return!0}const t=Object.keys(r),e=Object.keys(a);if(t.length!==e.length)return!1;for(const i of t)if(!e.includes(i)||!k(r[i],a[i]))return!1;return!0}const ft=({newFormValidatorError:r,isPreviousErrorFromFormValidator:a,previousErrorValue:t})=>r?{newErrorValue:r,newSource:"form"}:a?{newErrorValue:void 0,newSource:void 0}:t?{newErrorValue:t,newSource:"field"}:{newErrorValue:void 0,newSource:void 0},mt=({formLevelError:r,fieldLevelError:a})=>a?{newErrorValue:a,newSource:"field"}:r?{newErrorValue:r,newSource:"form"}:{newErrorValue:void 0,newSource:void 0};function S(r,a){return r==null?a:{...r,...a}}let C=256;const tt=[];let J;for(;C--;)tt[C]=(C+256).toString(16).substring(1);function Vt(){let r=0,a,t="";if(!J||C+16>256){for(J=new Array(256),r=256;r--;)J[r]=256*Math.random()|0;r=0,C=0}for(;r<16;r++)a=J[C+r],r===6?t+=tt[a&15|64]:r===8?t+=tt[a&63|128]:t+=tt[a],r&1&&r>1&&r<11&&(t+="-");return C++,t}const Rt=It(r=>E.emit("form-state",{id:r.formId,state:r.store.state}),{wait:300}),P=r=>{if(!r.validators)return r.runValidation({validators:[],form:r.form});const a=r.event.async,t=a?void 0:{fn:r.validators.onMount,cause:"mount"},e={fn:a?r.validators.onChangeAsync:r.validators.onChange,cause:"change"},i={fn:a?r.validators.onBlurAsync:r.validators.onBlur,cause:"blur"},s={fn:a?r.validators.onSubmitAsync:r.validators.onSubmit,cause:"submit"},n=a?void 0:{fn:()=>{},cause:"server"};switch(r.event.type){case"mount":return r.runValidation({validators:[t],form:r.form});case"submit":return r.runValidation({validators:[e,i,s,n],form:r.form});case"server":return r.runValidation({validators:[],form:r.form});case"blur":return r.runValidation({validators:[i,n],form:r.form});case"change":return r.runValidation({validators:[e,n],form:r.form});default:throw new Error(`Unknown validation event type: ${r.event.type}`)}};function jt(r,a){const t=new Map;for(const e of r){const i=e.path??[];let s=a,n="";for(let l=0;l<i.length;l++){const u=i[l];if(u===void 0)continue;const h=typeof u=="object"?u.key:u,o=Number(h);Array.isArray(s)&&!Number.isNaN(o)?n+=`[${o}]`:n+=(l>0?".":"")+String(h),typeof s=="object"&&s!==null?s=s[h]:s=void 0}t.set(n,(t.get(n)??[]).concat(e))}return Object.fromEntries(t)}const vt=(r,a)=>{const t=jt(r,a);return{form:t,fields:t}},j={validate({value:r,validationSource:a},t){const e=t["~standard"].validate(r);if(e instanceof Promise)throw new Error("async function passed to sync validator");if(e.issues)return a==="field"?e.issues:vt(e.issues,r)},async validateAsync({value:r,validationSource:a},t){const e=await t["~standard"].validate(r);if(e.issues)return a==="field"?e.issues:vt(e.issues,r)}},St=r=>!!r&&"~standard"in r,$={isValidating:!1,isTouched:!1,isBlurred:!1,isDirty:!1,isPristine:!0,isValid:!0,isDefaultValue:!0,errors:[],errorMap:{},errorSourceMap:{}};function Q(r){function a(o,c,m){const d=n(o,c,"move",m),f=Math.min(c,m),g=Math.max(c,m);for(let v=f;v<=g;v++)d.push(s(o,v));const p=Object.keys(r.fieldInfo).reduce((v,b)=>(b.startsWith(s(o,c))&&v.set(b,r.getFieldMeta(b)),v),new Map);u(d,c<m?"up":"down"),Object.keys(r.fieldInfo).filter(v=>v.startsWith(s(o,m))).forEach(v=>{const b=v.replace(s(o,m),s(o,c)),y=p.get(b);y&&r.setFieldMeta(v,y)})}function t(o,c){const m=n(o,c,"remove");u(m,"up")}function e(o,c,m){n(o,c,"swap",m).forEach(f=>{if(!f.toString().startsWith(s(o,c)))return;const g=f.toString().replace(s(o,c),s(o,m)),[p,v]=[r.getFieldMeta(f),r.getFieldMeta(g)];p&&r.setFieldMeta(g,p),v&&r.setFieldMeta(f,v)})}function i(o,c){const m=n(o,c,"insert");u(m,"down"),m.forEach(d=>{d.toString().startsWith(s(o,c))&&r.setFieldMeta(d,h())})}function s(o,c){return`${o}[${c}]`}function n(o,c,m,d){const f=[s(o,c)];switch(m){case"swap":f.push(s(o,d));break;case"move":{const[g,p]=[Math.min(c,d),Math.max(c,d)];for(let v=g;v<=p;v++)f.push(s(o,v));break}default:{const g=r.getFieldValue(o),p=Array.isArray(g)?g.length:0;for(let v=c+1;v<p;v++)f.push(s(o,v));break}}return Object.keys(r.fieldInfo).filter(g=>f.some(p=>g.startsWith(p)))}function l(o,c){return o.replace(/\[(\d+)\]/,(m,d)=>{const f=parseInt(d,10);return`[${c==="up"?f+1:Math.max(0,f-1)}]`})}function u(o,c){(c==="up"?o:[...o].reverse()).forEach(d=>{const f=l(d.toString(),c),g=r.getFieldMeta(f);g?r.setFieldMeta(d,g):r.setFieldMeta(d,h())})}const h=()=>$;return{handleArrayMove:a,handleArrayRemove:t,handleArraySwap:e,handleArrayInsert:i}}function nt(r){return{values:r.values??{},errorMap:r.errorMap??{},fieldMetaBase:r.fieldMetaBase??{},isSubmitted:r.isSubmitted??!1,isSubmitting:r.isSubmitting??!1,isValidating:r.isValidating??!1,submissionAttempts:r.submissionAttempts??0,isSubmitSuccessful:r.isSubmitSuccessful??!1,validationMetaMap:r.validationMetaMap??{onChange:void 0,onBlur:void 0,onSubmit:void 0,onMount:void 0,onServer:void 0,onDynamic:void 0}}}class gt{constructor(a){this.options={},this.fieldInfo={},this.prevTransformArray=[],this.mount=()=>{const t=this.fieldMetaDerived.mount(),e=this.store.mount(),i=this.store.subscribe(()=>{Rt(this)}),s=E.on("request-form-state",o=>{o.payload.id===this._formId&&E.emit("form-api",{id:this._formId,state:this.store.state,options:this.options})}),n=E.on("request-form-reset",o=>{o.payload.id===this._formId&&this.reset()}),l=E.on("request-form-force-submit",o=>{o.payload.id===this._formId&&(this._devtoolsSubmissionOverride=!0,this.handleSubmit(),this._devtoolsSubmissionOverride=!1)}),u=()=>{l(),n(),s(),i(),t(),e(),E.emit("form-unmounted",{id:this._formId})};this.options.listeners?.onMount?.({formApi:this});const{onMount:h}=this.options.validators||{};return E.emit("form-api",{id:this._formId,state:this.store.state,options:this.options}),h&&this.validateSync("mount"),u},this.update=t=>{if(!t)return;const e=this.options;this.options=t;const i=!!t.transform?.deps?.some((l,u)=>l!==this.prevTransformArray[u]),s=t.defaultValues&&!k(t.defaultValues,e.defaultValues)&&!this.state.isTouched,n=!k(t.defaultState,e.defaultState)&&!this.state.isTouched;!s&&!n&&!i||(L(()=>{this.baseStore.setState(()=>nt(Object.assign({},this.state,n?t.defaultState:{},s?{values:t.defaultValues}:{},i?{_force_re_eval:!this.state._force_re_eval}:{})))}),E.emit("form-api",{id:this._formId,state:this.store.state,options:this.options}))},this.reset=(t,e)=>{const{fieldMeta:i}=this.state,s=this.resetFieldMeta(i);t&&!e?.keepDefaultValues&&(this.options={...this.options,defaultValues:t}),this.baseStore.setState(()=>nt({...this.options.defaultState,values:t??this.options.defaultValues??this.options.defaultState?.values,fieldMetaBase:s}))},this.validateAllFields=async t=>{const e=[];return L(()=>{Object.values(this.fieldInfo).forEach(s=>{if(!s.instance)return;const n=s.instance;e.push(Promise.resolve().then(()=>n.validate(t,{skipFormValidation:!0}))),s.instance.state.meta.isTouched||s.instance.setMeta(l=>({...l,isTouched:!0}))})}),(await Promise.all(e)).flat()},this.validateArrayFieldsStartingFrom=async(t,e,i)=>{const s=this.getFieldValue(t),n=Array.isArray(s)?Math.max(s.length-1,0):null,l=[`${t}[${e}]`];for(let c=e+1;c<=(n??0);c++)l.push(`${t}[${c}]`);const u=Object.keys(this.fieldInfo).filter(c=>l.some(m=>c.startsWith(m))),h=[];return L(()=>{u.forEach(c=>{h.push(Promise.resolve().then(()=>this.validateField(c,i)))})}),(await Promise.all(h)).flat()},this.validateField=(t,e)=>{const i=this.fieldInfo[t]?.instance;if(!i){const{hasErrored:s}=this.validateSync(e);return s&&!this.options.asyncAlways?this.getFieldMeta(t)?.errors??[]:this.validateAsync(e).then(()=>this.getFieldMeta(t)?.errors??[])}return i.state.meta.isTouched||i.setMeta(s=>({...s,isTouched:!0})),i.validate(e)},this.validateSync=t=>{const e=ut(t,{...this.options,form:this,validationLogic:this.options.validationLogic||P});let i=!1;const s={};return L(()=>{for(const u of e){if(!u.validate)continue;const h=this.runValidator({validate:u.validate,value:{value:this.state.values,formApi:this,validationSource:"form"},type:"validate"}),{formError:o,fieldErrors:c}=et(h),m=G(u.cause),d=new Set([...Object.keys(this.state.fieldMeta),...Object.keys(c||{})]);for(const f of d){if(this.baseStore.state.fieldMetaBase[f]===void 0&&!c?.[f])continue;const g=this.getFieldMeta(f)??$,{errorMap:p,errorSourceMap:v}=g,b=c?.[f],{newErrorValue:y,newSource:V}=ft({newFormValidatorError:b,isPreviousErrorFromFormValidator:v?.[m]==="form",previousErrorValue:p?.[m]});V==="form"&&(s[f]={...s[f],[m]:b}),p?.[m]!==y&&this.setFieldMeta(f,(w=$)=>({...w,errorMap:{...w.errorMap,[m]:y},errorSourceMap:{...w.errorSourceMap,[m]:V}}))}this.state.errorMap?.[m]!==o&&this.baseStore.setState(f=>({...f,errorMap:{...f.errorMap,[m]:o}})),(o||c)&&(i=!0)}const n=G("submit");this.state.errorMap?.[n]&&t!=="submit"&&!i&&this.baseStore.setState(u=>({...u,errorMap:{...u.errorMap,[n]:void 0}}));const l=G("server");this.state.errorMap?.[l]&&t!=="server"&&!i&&this.baseStore.setState(u=>({...u,errorMap:{...u.errorMap,[l]:void 0}}))}),{hasErrored:i,fieldsErrorMap:s}},this.validateAsync=async t=>{const e=dt(t,{...this.options,form:this,validationLogic:this.options.validationLogic||P});this.state.isFormValidating||this.baseStore.setState(u=>({...u,isFormValidating:!0}));const i=[];let s;for(const u of e){if(!u.validate)continue;const h=G(u.cause);this.state.validationMetaMap[h]?.lastAbortController.abort();const c=new AbortController;this.state.validationMetaMap[h]={lastAbortController:c},i.push(new Promise(async m=>{let d;try{d=await new Promise((v,b)=>{setTimeout(async()=>{if(c.signal.aborted)return v(void 0);try{v(await this.runValidator({validate:u.validate,value:{value:this.state.values,formApi:this,validationSource:"form",signal:c.signal},type:"validateAsync"}))}catch(y){b(y)}},u.debounceMs)})}catch(v){d=v}const{formError:f,fieldErrors:g}=et(d);g&&(s=s?{...s,...g}:g);const p=G(u.cause);for(const v of Object.keys(this.state.fieldMeta)){if(this.baseStore.state.fieldMetaBase[v]===void 0)continue;const b=this.getFieldMeta(v);if(!b)continue;const{errorMap:y,errorSourceMap:V}=b,w=s?.[v],{newErrorValue:T,newSource:B}=ft({newFormValidatorError:w,isPreviousErrorFromFormValidator:V?.[p]==="form",previousErrorValue:y?.[p]});y?.[p]!==T&&this.setFieldMeta(v,D=>({...D,errorMap:{...D.errorMap,[p]:T},errorSourceMap:{...D.errorSourceMap,[p]:B}}))}this.baseStore.setState(v=>({...v,errorMap:{...v.errorMap,[p]:f}})),m(s?{fieldErrors:s,errorMapKey:p}:void 0)}))}let n=[];const l={};if(i.length){n=await Promise.all(i);for(const u of n)if(u?.fieldErrors){const{errorMapKey:h}=u;for(const[o,c]of Object.entries(u.fieldErrors)){const d={...l[o]||{},[h]:c};l[o]=d}}}return this.baseStore.setState(u=>({...u,isFormValidating:!1})),l},this.validate=t=>{const{hasErrored:e,fieldsErrorMap:i}=this.validateSync(t);return e&&!this.options.asyncAlways?i:this.validateAsync(t)},this._handleSubmit=async t=>{this.baseStore.setState(s=>({...s,isSubmitted:!1,submissionAttempts:s.submissionAttempts+1,isSubmitSuccessful:!1})),L(()=>{Object.values(this.fieldInfo).forEach(s=>{s.instance&&(s.instance.state.meta.isTouched||s.instance.setMeta(n=>({...n,isTouched:!0})))})});const e=t??this.options.onSubmitMeta;if(!this.state.canSubmit&&!this._devtoolsSubmissionOverride){this.options.onSubmitInvalid?.({value:this.state.values,formApi:this,meta:e});return}this.baseStore.setState(s=>({...s,isSubmitting:!0}));const i=()=>{this.baseStore.setState(s=>({...s,isSubmitting:!1}))};if(await this.validateAllFields("submit"),!this.state.isFieldsValid){i(),this.options.onSubmitInvalid?.({value:this.state.values,formApi:this,meta:e}),E.emit("form-submission",{id:this._formId,submissionAttempt:this.state.submissionAttempts,successful:!1,stage:"validateAllFields",errors:Object.values(this.state.fieldMeta).map(s=>s.errors).flat()});return}if(await this.validate("submit"),!this.state.isValid){i(),this.options.onSubmitInvalid?.({value:this.state.values,formApi:this,meta:e}),E.emit("form-submission",{id:this._formId,submissionAttempt:this.state.submissionAttempts,successful:!1,stage:"validate",errors:this.state.errors});return}L(()=>{Object.values(this.fieldInfo).forEach(s=>{s.instance?.options.listeners?.onSubmit?.({value:s.instance.state.value,fieldApi:s.instance})})}),this.options.listeners?.onSubmit?.({formApi:this,meta:e});try{await this.options.onSubmit?.({value:this.state.values,formApi:this,meta:e}),L(()=>{this.baseStore.setState(s=>({...s,isSubmitted:!0,isSubmitSuccessful:!0})),E.emit("form-submission",{id:this._formId,submissionAttempt:this.state.submissionAttempts,successful:!0}),i()})}catch(s){throw this.baseStore.setState(n=>({...n,isSubmitSuccessful:!1})),E.emit("form-submission",{id:this._formId,submissionAttempt:this.state.submissionAttempts,successful:!1,stage:"inflight",onError:s}),i(),s}},this.getFieldValue=t=>q(this.state.values,t),this.getFieldMeta=t=>this.state.fieldMeta[t],this.getFieldInfo=t=>this.fieldInfo[t]||={instance:null,validationMetaMap:{onChange:void 0,onBlur:void 0,onSubmit:void 0,onMount:void 0,onServer:void 0,onDynamic:void 0}},this.setFieldMeta=(t,e)=>{this.baseStore.setState(i=>({...i,fieldMetaBase:{...i.fieldMetaBase,[t]:rt(e,i.fieldMetaBase[t])}}))},this.resetFieldMeta=t=>Object.keys(t).reduce((e,i)=>{const s=i;return e[s]=$,e},{}),this.setFieldValue=(t,e,i)=>{const s=i?.dontUpdateMeta??!1,n=i?.dontRunListeners??!1,l=i?.dontValidate??!1;L(()=>{s||this.setFieldMeta(t,u=>({...u,isTouched:!0,isDirty:!0,errorMap:{...u?.errorMap,onMount:void 0}})),this.baseStore.setState(u=>({...u,values:H(u.values,t,e)}))}),n||this.getFieldInfo(t).instance?.triggerOnChangeListener(),l||this.validateField(t,"change")},this.deleteField=t=>{const i=[...Object.keys(this.fieldInfo).filter(s=>{const n=t.toString();return s!==n&&s.startsWith(n)}),t];this.baseStore.setState(s=>{const n={...s};return i.forEach(l=>{n.values=_t(n.values,l),delete this.fieldInfo[l],delete n.fieldMetaBase[l]}),n})},this.pushFieldValue=(t,e,i)=>{this.setFieldValue(t,s=>[...Array.isArray(s)?s:[],e],i)},this.insertFieldValue=async(t,e,i,s)=>{this.setFieldValue(t,l=>[...l.slice(0,e),i,...l.slice(e)],S(s,{dontValidate:!0}));const n=s?.dontValidate??!1;n||await this.validateField(t,"change"),Q(this).handleArrayInsert(t,e),n||await this.validateArrayFieldsStartingFrom(t,e,"change")},this.replaceFieldValue=async(t,e,i,s)=>{this.setFieldValue(t,l=>l.map((u,h)=>h===e?i:u),S(s,{dontValidate:!0})),(s?.dontValidate??!1)||(await this.validateField(t,"change"),await this.validateArrayFieldsStartingFrom(t,e,"change"))},this.removeFieldValue=async(t,e,i)=>{const s=this.getFieldValue(t),n=Array.isArray(s)?Math.max(s.length-1,0):null;if(this.setFieldValue(t,u=>u.filter((h,o)=>o!==e),S(i,{dontValidate:!0})),Q(this).handleArrayRemove(t,e),n!==null){const u=`${t}[${n}]`;this.deleteField(u)}(i?.dontValidate??!1)||(await this.validateField(t,"change"),await this.validateArrayFieldsStartingFrom(t,e,"change"))},this.swapFieldValues=(t,e,i,s)=>{this.setFieldValue(t,l=>{const u=l[e],h=l[i];return H(H(l,`${e}`,h),`${i}`,u)},S(s,{dontValidate:!0})),Q(this).handleArraySwap(t,e,i),(s?.dontValidate??!1)||(this.validateField(t,"change"),this.validateField(`${t}[${e}]`,"change"),this.validateField(`${t}[${i}]`,"change"))},this.moveFieldValues=(t,e,i,s)=>{this.setFieldValue(t,l=>{const u=[...l];return u.splice(i,0,u.splice(e,1)[0]),u},S(s,{dontValidate:!0})),Q(this).handleArrayMove(t,e,i),(s?.dontValidate??!1)||(this.validateField(t,"change"),this.validateField(`${t}[${e}]`,"change"),this.validateField(`${t}[${i}]`,"change"))},this.clearFieldValues=(t,e)=>{const i=this.getFieldValue(t),s=Array.isArray(i)?Math.max(i.length-1,0):null;if(this.setFieldValue(t,[],S(e,{dontValidate:!0})),s!==null)for(let l=0;l<=s;l++){const u=`${t}[${l}]`;this.deleteField(u)}(e?.dontValidate??!1)||this.validateField(t,"change")},this.resetField=t=>{this.baseStore.setState(e=>({...e,fieldMetaBase:{...e.fieldMetaBase,[t]:$},values:this.options.defaultValues?H(e.values,t,q(this.options.defaultValues,t)):e.values}))},this.setErrorMap=t=>{L(()=>{Object.entries(t).forEach(([e,i])=>{const s=e;if(ct(i)){const{formError:n,fieldErrors:l}=et(i);for(const u of Object.keys(this.fieldInfo))this.getFieldMeta(u)&&this.setFieldMeta(u,o=>({...o,errorMap:{...o.errorMap,[s]:l?.[u]},errorSourceMap:{...o.errorSourceMap,[s]:"form"}}));this.baseStore.setState(u=>({...u,errorMap:{...u.errorMap,[s]:n}}))}else this.baseStore.setState(n=>({...n,errorMap:{...n.errorMap,[s]:i}}))})})},this.getAllErrors=()=>({form:{errors:this.state.errors,errorMap:this.state.errorMap},fields:Object.entries(this.state.fieldMeta).reduce((t,[e,i])=>(Object.keys(i).length&&i.errors.length&&(t[e]={errors:i.errors,errorMap:i.errorMap}),t),{})}),this.parseValuesWithSchema=t=>j.validate({value:this.state.values,validationSource:"form"},t),this.parseValuesWithSchemaAsync=t=>j.validateAsync({value:this.state.values,validationSource:"form"},t),this.timeoutIds={validations:{},listeners:{},formListeners:{}},this._formId=a?.formId??Vt(),this._devtoolsSubmissionOverride=!1,this.baseStore=new ot(nt({...a?.defaultState,values:a?.defaultValues??a?.defaultState?.values})),this.fieldMetaDerived=new I({deps:[this.baseStore],fn:({prevDepVals:t,currDepVals:e,prevVal:i})=>{const s=i,n=t?.[0],l=e[0];let u=0;const h={};for(const o of Object.keys(l.fieldMetaBase)){const c=l.fieldMetaBase[o],m=n?.fieldMetaBase[o],d=s?.[o],f=q(l.values,o);let g=d?.errors;if(!m||c.errorMap!==m.errorMap){g=Object.values(c.errorMap??{}).filter(V=>V!==void 0);const y=this.getFieldInfo(o)?.instance;(!y||!y.options.disableErrorFlat)&&(g=g.flat(1))}const p=!$t(g),v=!c.isDirty,b=k(f,q(this.options.defaultValues,o))||k(f,this.getFieldInfo(o)?.instance?.options.defaultValue);if(d&&d.isPristine===v&&d.isValid===p&&d.isDefaultValue===b&&d.errors===g&&c===m){h[o]=d,u++;continue}h[o]={...c,errors:g??[],isPristine:v,isValid:p,isDefaultValue:b}}return Object.keys(l.fieldMetaBase).length&&s&&u===Object.keys(l.fieldMetaBase).length?s:h}}),this.store=new I({deps:[this.baseStore,this.fieldMetaDerived],fn:({prevDepVals:t,currDepVals:e,prevVal:i})=>{const s=i,n=t?.[0],l=e[0],u=e[1],h=Object.values(u).filter(Boolean),o=h.some(M=>M.isValidating),c=h.every(M=>M.isValid),m=h.some(M=>M.isTouched),d=h.some(M=>M.isBlurred),f=h.every(M=>M.isDefaultValue),g=m&&l.errorMap?.onMount,p=h.some(M=>M.isDirty),v=!p,b=!!(l.errorMap?.onMount||h.some(M=>M?.errorMap?.onMount)),y=!!o;let V=s?.errors??[];(!n||l.errorMap!==n.errorMap)&&(V=Object.values(l.errorMap).reduce((M,O)=>O===void 0?M:O&&ct(O)?(M.push(O.form),M):(M.push(O),M),[]));const w=V.length===0,T=c&&w,B=this.options.canSubmitWhenInvalid??!1,D=l.submissionAttempts===0&&!m&&!b||!y&&!l.isSubmitting&&T||B;let F=l.errorMap;if(g&&(V=V.filter(M=>M!==l.errorMap.onMount),F=Object.assign(F,{onMount:void 0})),s&&n&&s.errorMap===F&&s.fieldMeta===this.fieldMetaDerived.state&&s.errors===V&&s.isFieldsValidating===o&&s.isFieldsValid===c&&s.isFormValid===w&&s.isValid===T&&s.canSubmit===D&&s.isTouched===m&&s.isBlurred===d&&s.isPristine===v&&s.isDefaultValue===f&&s.isDirty===p&&k(n,l))return s;let W={...l,errorMap:F,fieldMeta:this.fieldMetaDerived.state,errors:V,isFieldsValidating:o,isFieldsValid:c,isFormValid:w,isValid:T,canSubmit:D,isTouched:m,isBlurred:d,isPristine:v,isDefaultValue:f,isDirty:p};const N=this.options.transform?.deps??[];if(N.length!==this.prevTransformArray.length||N.some((M,O)=>M!==this.prevTransformArray[O])){const M=Object.assign({},this,{state:W});this.options.transform?.fn(M),W=M.state,this.prevTransformArray=N}return W}}),this.handleSubmit=this.handleSubmit.bind(this),this.update(a||{})}get state(){return this.store.state}get formId(){return this._formId}runValidator(a){return St(a.validate)?j[a.type](a.value,a.validate):a.validate(a.value)}handleSubmit(a){return this._handleSubmit(a)}}function et(r){if(r){if(ct(r)){const a=et(r.form).formError,t=r.fields;return{formError:a,fieldErrors:t}}return{formError:r}}return{formError:void 0}}function G(r){switch(r){case"submit":return"onSubmit";case"blur":return"onBlur";case"mount":return"onMount";case"server":return"onServer";case"dynamic":return"onDynamic";default:return"onChange"}}class pt{constructor(a){this.options={},this.mount=()=>{const t=this.store.mount();this.options.defaultValue!==void 0&&!this.getMeta().isTouched&&this.form.setFieldValue(this.name,this.options.defaultValue,{dontUpdateMeta:!0});const e=this.getInfo();e.instance=this,this.update(this.options);const{onMount:i}=this.options.validators||{};if(i){const s=this.runValidator({validate:i,value:{value:this.state.value,fieldApi:this,validationSource:"field"},type:"validate"});s&&this.setMeta(n=>({...n,errorMap:{...n?.errorMap,onMount:s},errorSourceMap:{...n?.errorSourceMap,onMount:"field"}}))}return this.options.listeners?.onMount?.({value:this.state.value,fieldApi:this}),t},this.update=t=>{if(this.options=t,this.name=t.name,!this.state.meta.isTouched&&this.options.defaultValue!==void 0){const e=this.form.getFieldValue(this.name);k(e,t.defaultValue)||this.form.setFieldValue(this.name,t.defaultValue,{dontUpdateMeta:!0,dontValidate:!0,dontRunListeners:!0})}this.form.getFieldMeta(this.name)||this.form.setFieldMeta(this.name,this.state.meta)},this.getValue=()=>this.form.getFieldValue(this.name),this.setValue=(t,e)=>{this.form.setFieldValue(this.name,t,S(e,{dontRunListeners:!0,dontValidate:!0})),e?.dontRunListeners||this.triggerOnChangeListener(),e?.dontValidate||this.validate("change")},this.getMeta=()=>this.store.state.meta,this.setMeta=t=>this.form.setFieldMeta(this.name,t),this.getInfo=()=>this.form.getFieldInfo(this.name),this.pushValue=(t,e)=>{this.form.pushFieldValue(this.name,t,S(e,{dontRunListeners:!0})),e?.dontRunListeners||this.triggerOnChangeListener()},this.insertValue=(t,e,i)=>{this.form.insertFieldValue(this.name,t,e,S(i,{dontRunListeners:!0})),i?.dontRunListeners||this.triggerOnChangeListener()},this.replaceValue=(t,e,i)=>{this.form.replaceFieldValue(this.name,t,e,S(i,{dontRunListeners:!0})),i?.dontRunListeners||this.triggerOnChangeListener()},this.removeValue=(t,e)=>{this.form.removeFieldValue(this.name,t,S(e,{dontRunListeners:!0})),e?.dontRunListeners||this.triggerOnChangeListener()},this.swapValues=(t,e,i)=>{this.form.swapFieldValues(this.name,t,e,S(i,{dontRunListeners:!0})),i?.dontRunListeners||this.triggerOnChangeListener()},this.moveValue=(t,e,i)=>{this.form.moveFieldValues(this.name,t,e,S(i,{dontRunListeners:!0})),i?.dontRunListeners||this.triggerOnChangeListener()},this.clearValues=t=>{this.form.clearFieldValues(this.name,S(t,{dontRunListeners:!0})),t?.dontRunListeners||this.triggerOnChangeListener()},this.getLinkedFields=t=>{const e=Object.values(this.form.fieldInfo),i=[];for(const s of e){if(!s.instance)continue;const{onChangeListenTo:n,onBlurListenTo:l}=s.instance.options.validators||{};t==="change"&&n?.includes(this.name)&&i.push(s.instance),t==="blur"&&l?.includes(this.name)&&i.push(s.instance)}return i},this.validateSync=(t,e)=>{const i=ut(t,{...this.options,form:this.form,validationLogic:this.form.options.validationLogic||P}),n=this.getLinkedFields(t).reduce((h,o)=>{const c=ut(t,{...o.options,form:o.form,validationLogic:o.form.options.validationLogic||P});return c.forEach(m=>{m.field=o}),h.concat(c)},[]);let l=!1;L(()=>{const h=(o,c)=>{const m=Y(c.cause),d=c.validate?Mt(o.runValidator({validate:c.validate,value:{value:o.store.state.value,validationSource:"field",fieldApi:o},type:"validate"})):void 0,f=e[m],{newErrorValue:g,newSource:p}=mt({formLevelError:f,fieldLevelError:d});o.state.meta.errorMap?.[m]!==g&&o.setMeta(v=>({...v,errorMap:{...v.errorMap,[m]:g},errorSourceMap:{...v.errorSourceMap,[m]:p}})),g&&(l=!0)};for(const o of i)h(this,o);for(const o of n)o.validate&&h(o.field,o)});const u=Y("submit");return this.state.meta.errorMap?.[u]&&t!=="submit"&&!l&&this.setMeta(h=>({...h,errorMap:{...h.errorMap,[u]:void 0},errorSourceMap:{...h.errorSourceMap,[u]:void 0}})),{hasErrored:l}},this.validateAsync=async(t,e)=>{const i=dt(t,{...this.options,form:this.form,validationLogic:this.form.options.validationLogic||P}),s=await e,n=this.getLinkedFields(t),l=n.reduce((d,f)=>{const g=dt(t,{...f.options,form:f.form,validationLogic:f.form.options.validationLogic||P});return g.forEach(p=>{p.field=f}),d.concat(g)},[]),u=[],h=[],o=i.some(d=>d.validate)||l.some(d=>d.validate);if(o){this.state.meta.isValidating||this.setMeta(d=>({...d,isValidating:!0}));for(const d of n)d.setMeta(f=>({...f,isValidating:!0}))}const c=(d,f,g)=>{const p=Y(f.cause);d.getInfo().validationMetaMap[p]?.lastAbortController.abort();const b=new AbortController;this.getInfo().validationMetaMap[p]={lastAbortController:b},g.push(new Promise(async y=>{let V;try{V=await new Promise((F,W)=>{this.timeoutIds.validations[f.cause]&&clearTimeout(this.timeoutIds.validations[f.cause]),this.timeoutIds.validations[f.cause]=setTimeout(async()=>{if(b.signal.aborted)return F(void 0);try{F(await this.runValidator({validate:f.validate,value:{value:d.store.state.value,fieldApi:d,signal:b.signal,validationSource:"field"},type:"validateAsync"}))}catch(N){W(N)}},f.debounceMs)})}catch(F){V=F}if(b.signal.aborted)return y(void 0);const w=Mt(V),T=s[this.name]?.[p],{newErrorValue:B,newSource:D}=mt({formLevelError:T,fieldLevelError:w});d.setMeta(F=>({...F,errorMap:{...F?.errorMap,[p]:B},errorSourceMap:{...F.errorSourceMap,[p]:D}})),y(B)}))};for(const d of i)d.validate&&c(this,d,u);for(const d of l)d.validate&&c(d.field,d,h);let m=[];if((u.length||h.length)&&(m=await Promise.all(u),await Promise.all(h)),o){this.setMeta(d=>({...d,isValidating:!1}));for(const d of n)d.setMeta(f=>({...f,isValidating:!1}))}return m.filter(Boolean)},this.validate=(t,e)=>{if(!this.state.meta.isTouched)return[];const{fieldsErrorMap:i}=e?.skipFormValidation?{fieldsErrorMap:{}}:this.form.validateSync(t),{hasErrored:s}=this.validateSync(t,i[this.name]??{});if(s&&!this.options.asyncAlways)return this.getInfo().validationMetaMap[Y(t)]?.lastAbortController.abort(),this.state.meta.errors;const n=e?.skipFormValidation?Promise.resolve({}):this.form.validateAsync(t);return this.validateAsync(t,n)},this.handleChange=t=>{this.setValue(t)},this.handleBlur=()=>{this.state.meta.isTouched||this.setMeta(e=>({...e,isTouched:!0})),this.state.meta.isBlurred||this.setMeta(e=>({...e,isBlurred:!0})),this.validate("blur"),this.triggerOnBlurListener()},this.setErrorMap=t=>{this.setMeta(e=>({...e,errorMap:{...e.errorMap,...t}}))},this.parseValueWithSchema=t=>j.validate({value:this.state.value,validationSource:"field"},t),this.parseValueWithSchemaAsync=t=>j.validateAsync({value:this.state.value,validationSource:"field"},t),this.triggerOnChangeListener=()=>{const t=this.form.options.listeners?.onChangeDebounceMs;t&&t>0?(this.timeoutIds.formListeners.change&&clearTimeout(this.timeoutIds.formListeners.change),this.timeoutIds.formListeners.change=setTimeout(()=>{this.form.options.listeners?.onChange?.({formApi:this.form,fieldApi:this})},t)):this.form.options.listeners?.onChange?.({formApi:this.form,fieldApi:this});const e=this.options.listeners?.onChangeDebounceMs;e&&e>0?(this.timeoutIds.listeners.change&&clearTimeout(this.timeoutIds.listeners.change),this.timeoutIds.listeners.change=setTimeout(()=>{this.options.listeners?.onChange?.({value:this.state.value,fieldApi:this})},e)):this.options.listeners?.onChange?.({value:this.state.value,fieldApi:this})},this.form=a.form,this.name=a.name,this.options=a,this.timeoutIds={validations:{},listeners:{},formListeners:{}},this.store=new I({deps:[this.form.store],fn:({prevVal:t})=>{const e=t,i=this.form.getFieldMeta(this.name)??{...$,...a.defaultMeta};let s=this.form.getFieldValue(this.name);return!i.isTouched&&s===void 0&&this.options.defaultValue!==void 0&&!k(s,this.options.defaultValue)&&(s=this.options.defaultValue),e&&e.value===s&&e.meta===i?e:{value:s,meta:i}}})}get state(){return this.store.state}runValidator(a){return St(a.validate)?j[a.type](a.value,a.validate):a.validate(a.value)}triggerOnBlurListener(){const a=this.form.options.listeners?.onBlurDebounceMs;a&&a>0?(this.timeoutIds.formListeners.blur&&clearTimeout(this.timeoutIds.formListeners.blur),this.timeoutIds.formListeners.blur=setTimeout(()=>{this.form.options.listeners?.onBlur?.({formApi:this.form,fieldApi:this})},a)):this.form.options.listeners?.onBlur?.({formApi:this.form,fieldApi:this});const t=this.options.listeners?.onBlurDebounceMs;t&&t>0?(this.timeoutIds.listeners.blur&&clearTimeout(this.timeoutIds.listeners.blur),this.timeoutIds.listeners.blur=setTimeout(()=>{this.options.listeners?.onBlur?.({value:this.state.value,fieldApi:this})},t)):this.options.listeners?.onBlur?.({value:this.state.value,fieldApi:this})}}function Mt(r){if(r)return r}function Y(r){switch(r){case"submit":return"onSubmit";case"blur":return"onBlur";case"mount":return"onMount";case"server":return"onServer";case"dynamic":return"onDynamic";default:return"onChange"}}const it=typeof window<"u"?A.useLayoutEffect:A.useEffect;function Ut(r){const[a,t]=A.useState(()=>({form:r.form,name:r.name})),[e,i]=A.useState(()=>new pt({...r}));(a.form!==r.form||a.name!==r.name)&&(i(new pt({...r})),t({form:r.form,name:r.name}));const s=_(e.store,r.mode==="array"?d=>Object.keys(d.value??[]).length:d=>d.value),n=_(e.store,d=>d.meta.isTouched),l=_(e.store,d=>d.meta.isBlurred),u=_(e.store,d=>d.meta.isDirty),h=_(e.store,d=>d.meta.errorMap),o=_(e.store,d=>d.meta.errorSourceMap),c=_(e.store,d=>d.meta.isValidating),m=A.useMemo(()=>{const f={...e,get state(){return{value:r.mode==="array"?e.state.value:s,get meta(){return{...e.state.meta,isTouched:n,isBlurred:l,isDirty:u,errorMap:h,errorSourceMap:o,isValidating:c}}}}};return f.Field=Ft,f},[e,r.mode,s,n,l,u,h,o,c]);return it(e.mount,[e]),it(()=>{e.update(r)}),m}const Ft=(({children:r,...a})=>{const t=Ut(a),e=A.useMemo(()=>rt(r,t),[r,t]);return U.jsx(U.Fragment,{children:e})});function Wt(){return A.useState(()=>Vt())[0]}const Nt=A.version.split(".")[0]==="17"?Wt:A.useId;function Gt({form:r,selector:a,children:t}){const e=_(r.store,a);return U.jsx(U.Fragment,{children:rt(t,e)})}function zt(r){const a=Nt(),[t,e]=A.useState(r?.formId),[i,s]=A.useState(()=>new gt({...r,formId:r?.formId??a}));if(t!==r?.formId){const l=r?.formId??a;s(new gt({...r,formId:l})),e(l)}const n=A.useMemo(()=>{const l={...i,handleSubmit:((...u)=>i._handleSubmit(...u)),get formId(){return i._formId},get state(){return i.store.state}};return l.Field=function(h){return U.jsx(Ft,{...h,form:i})},l.Subscribe=function(h){return U.jsx(Gt,{form:i,selector:h.selector,children:h.children})},l},[i]);return it(i.mount,[]),it(()=>{i.update(r)}),n}export{zt as u};
