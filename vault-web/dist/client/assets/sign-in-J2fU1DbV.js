import{c as H,j as e,_ as O,G as D,b as u,J as R,m as f,ai as N,Z as V}from"./main-BdAAzOp_.js";import{I as x}from"./Input-DmXcK8Ek.js";import{C as $,a as G,b as Z,c as z,d as J}from"./Card-BgwA5byp.js";import{T as Y,a as K,b as C,c as S}from"./Tabs-c8LIGITi.js";import{A as L,a as M}from"./Alert-DT3fX0Ix.js";import{u as I}from"./useForm-D0kRy4nt.js";import{H as Q,a as X,d as ee,e as ae,c as se}from"./HostedLayout-C9ABfqpe.js";import{S as te,E as re,a as ne}from"./SocialLoginButtons-DuK6ZazW.js";import{C as E}from"./circle-alert-DITzmtt1.js";import{L as P}from"./lock-PhA2rBqp.js";import{Z as T}from"./zap-Dzw1PjKQ.js";import{M as j}from"./mail-nvpjyHZd.js";import"./index-TAemdWJe.js";import"./index-5WLq0AmM.js";const ie=[["path",{d:"M12 10a2 2 0 0 0-2 2c0 1.02-.1 2.51-.26 4",key:"1nerag"}],["path",{d:"M14 13.12c0 2.38 0 6.38-1 8.88",key:"o46ks0"}],["path",{d:"M17.29 21.02c.12-.6.43-2.3.5-3.02",key:"ptglia"}],["path",{d:"M2 12a10 10 0 0 1 18-6",key:"ydlgp0"}],["path",{d:"M2 16h.01",key:"1gqxmh"}],["path",{d:"M21.8 16c.2-2 .131-5.354 0-6",key:"drycrb"}],["path",{d:"M5 19.5C5.5 18 6 15 6 12a6 6 0 0 1 .34-2",key:"1tidbn"}],["path",{d:"M8.65 22c.21-.66.45-1.32.57-2",key:"13wd9y"}],["path",{d:"M9 6.8a6 6 0 0 1 9 5.2v2",key:"1fr1j5"}]],oe=H("fingerprint-pattern",ie);function Ce(){return e.jsx(Q,{searchParams:new URLSearchParams(window.location.search),children:e.jsx(le,{})})}function le(){const o=O(),{config:t,tenantId:a,redirectUrl:n,error:h}=X(),s=D(),[c,v]=u.useState(!1),[g,p]=u.useState(!1),[w,l]=u.useState(null),[F,_]=u.useState("password"),[q,y]=u.useState(null),[B,U]=u.useState(!1),k=I({defaultValues:{email:"",password:""},onSubmit:async({value:i})=>{if(a){p(!0),l(null);try{const r=await ee({data:{email:i.email,password:i.password,tenantId:a,redirectUrl:n||void 0}});if(r.requiresMfa&&r.mfaToken){o({to:"/hosted/mfa",search:{tenant_id:a,mfa_token:r.mfaToken,redirect_url:n||void 0}});return}window.location.href=r.redirectUrl}catch(r){l(r instanceof Error?r.message:"Sign in failed")}finally{p(!1)}}}}),b=I({defaultValues:{email:""},onSubmit:async({value:i})=>{if(a){p(!0),l(null);try{await ae({data:{email:i.email,tenantId:a,redirectUrl:n||void 0}}),U(!0)}catch(r){l(r instanceof Error?r.message:"Failed to send magic link")}finally{p(!1)}}}}),m=async i=>{if(a){y(i),l(null);try{const r=await se({data:{provider:i,tenantId:a,redirectUrl:n||void 0}});sessionStorage.setItem("hosted_oauth_state",r.state),window.location.href=r.authUrl}catch(r){l(r instanceof Error?r.message:"OAuth failed"),y(null)}}},W=async()=>{l("WebAuthn coming soon")};if(!t||!a)return null;const d=t.oauthProviders.filter(i=>["google","github","apple","slack","discord"].includes(i));return e.jsxs($,{className:"shadow-elevated",children:[e.jsxs(G,{className:"space-y-1",children:[e.jsx(Z,{className:"text-2xl text-center",children:t.signInTitle||`Sign in to ${t.companyName}`}),e.jsx(z,{className:"text-center",children:"Enter your credentials to access your account"})]}),e.jsxs(J,{className:"space-y-4",children:[w&&e.jsxs(L,{variant:"destructive",children:[e.jsx(E,{className:"h-4 w-4"}),e.jsx(M,{children:w})]}),h&&e.jsxs(L,{variant:"destructive",children:[e.jsx(E,{className:"h-4 w-4"}),e.jsx(M,{children:h})]}),d.length>0&&e.jsx(R.div,{initial:s?!1:{opacity:0},animate:{opacity:1},transition:s?{duration:0}:{delay:.1},children:e.jsx(te,{onGoogleClick:d.includes("google")?()=>m("google"):void 0,onGitHubClick:d.includes("github")?()=>m("github"):void 0,onAppleClick:d.includes("apple")?()=>m("apple"):void 0,onSlackClick:d.includes("slack")?()=>m("slack"):void 0,onDiscordClick:d.includes("discord")?()=>m("discord"):void 0,isLoading:!!q})}),t.showMagicLink||t.showWebAuthn?e.jsxs(Y,{value:F,onValueChange:i=>_(i),children:[e.jsxs(K,{className:"grid w-full grid-cols-2",children:[e.jsxs(C,{value:"password",className:"gap-2",children:[e.jsx(P,{className:"h-4 w-4"}),"Password"]}),t.showMagicLink&&e.jsxs(C,{value:"magic-link",className:"gap-2",children:[e.jsx(T,{className:"h-4 w-4"}),"Magic Link"]})]}),e.jsx(S,{value:"password",className:"mt-4 space-y-4",children:e.jsx(A,{form:k,showPassword:c,setShowPassword:v,isLoading:g,config:t})}),t.showMagicLink&&e.jsx(S,{value:"magic-link",className:"mt-4",children:B?e.jsx(de,{email:b.getFieldValue("email")}):e.jsx(ce,{form:b,isLoading:g})})]}):e.jsx(A,{form:k,showPassword:c,setShowPassword:v,isLoading:g,config:t}),t.showWebAuthn&&e.jsxs(f,{variant:"outline",fullWidth:!0,onClick:W,disabled:g,className:"gap-2",children:[e.jsx(oe,{className:"h-4 w-4"}),"Sign in with Passkey"]}),e.jsxs("div",{className:"flex items-center justify-between text-sm pt-4 border-t",children:[t.allowSignUp?e.jsx(N,{to:"/hosted/sign-up",search:{tenant_id:a,redirect_url:n||void 0},className:"text-primary hover:underline",children:"Create account"}):e.jsx("span",{}),e.jsx(N,{to:"/hosted/forgot-password",search:{tenant_id:a},className:"text-primary hover:underline",children:"Forgot password?"})]})]})]})}function A({form:o,showPassword:t,setShowPassword:a,isLoading:n,config:h}){return e.jsxs("form",{onSubmit:s=>{s.preventDefault(),s.stopPropagation(),o.handleSubmit()},className:"space-y-4",children:[e.jsx(o.Field,{name:"email",validators:{onChange:({value:s})=>{if(!s.trim())return"Email is required";if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s))return"Please enter a valid email"}},children:s=>e.jsx(x,{label:"Email",type:"email",placeholder:`you@${h.companyName.toLowerCase().replace(/\s+/g,"")}.com`,value:s.state.value,onChange:c=>s.handleChange(c.target.value),onBlur:s.handleBlur,error:s.state.meta.isTouched?s.state.meta.errors[0]:void 0,leftIcon:e.jsx(j,{className:"h-4 w-4 text-muted-foreground"}),autoComplete:"email",autoCapitalize:"none",spellCheck:!1,required:!0,disabled:n})}),e.jsx(o.Field,{name:"password",validators:{onChange:({value:s})=>{if(!s)return"Password is required"}},children:s=>e.jsx(x,{label:"Password",type:t?"text":"password",placeholder:"••••••••",value:s.state.value,onChange:c=>s.handleChange(c.target.value),onBlur:s.handleBlur,error:s.state.meta.isTouched?s.state.meta.errors[0]:void 0,leftIcon:e.jsx(P,{className:"h-4 w-4 text-muted-foreground"}),autoComplete:"current-password",rightIcon:e.jsx("button",{type:"button",onClick:()=>a(!t),className:"text-muted-foreground hover:text-foreground transition-colors","aria-label":t?"Hide password":"Show password",children:t?e.jsx(re,{className:"h-4 w-4"}):e.jsx(ne,{className:"h-4 w-4"})}),required:!0,disabled:n})}),e.jsx(f,{type:"submit",fullWidth:!0,size:"lg",isLoading:n,rightIcon:e.jsx(V,{className:"h-4 w-4"}),children:"Sign In"})]})}function ce({form:o,isLoading:t}){return e.jsxs("form",{onSubmit:a=>{a.preventDefault(),a.stopPropagation(),o.handleSubmit()},className:"space-y-4",children:[e.jsx(o.Field,{name:"email",validators:{onChange:({value:a})=>{if(!a.trim())return"Email is required";if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a))return"Please enter a valid email"}},children:a=>e.jsx(x,{label:"Email",type:"email",placeholder:"you@example.com",value:a.state.value,onChange:n=>a.handleChange(n.target.value),onBlur:a.handleBlur,error:a.state.meta.isTouched?a.state.meta.errors[0]:void 0,leftIcon:e.jsx(j,{className:"h-4 w-4 text-muted-foreground"}),autoComplete:"email",required:!0,disabled:t})}),e.jsx(f,{type:"submit",fullWidth:!0,isLoading:t,rightIcon:e.jsx(T,{className:"h-4 w-4"}),children:"Send Magic Link"}),e.jsx("p",{className:"text-xs text-center text-muted-foreground",children:"You'll receive an email with a secure link to sign in instantly"})]})}function de({email:o}){return e.jsxs("div",{className:"text-center space-y-4 py-8",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 dark:bg-green-900/20 rounded-full flex items-center justify-center mx-auto",children:e.jsx(j,{className:"w-8 h-8 text-green-600 dark:text-green-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Check your email"}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["We've sent a magic link to ",e.jsx("strong",{children:o})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"Link expires in 15 minutes"})]})]})}export{Ce as component};
