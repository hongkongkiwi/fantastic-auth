import{c as i,L as o,j as e,al as u,m as y,aF as v,a4 as j}from"./main-BdAAzOp_.js";import{u as N,a as g}from"./useQuery-ButOQx42.js";import{u as h}from"./useMutation-BBfU30nI.js";import{S as k}from"./smartphone-Dki1OkCf.js";const _=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],w=i("clock",_);const b=[["path",{d:"M18 5a2 2 0 0 1 2 2v8.526a2 2 0 0 0 .212.897l1.068 2.127a1 1 0 0 1-.9 1.45H3.62a1 1 0 0 1-.9-1.45l1.068-2.127A2 2 0 0 0 4 15.526V7a2 2 0 0 1 2-2z",key:"1pdavp"}],["path",{d:"M20.054 15.987H3.946",key:"14rxg9"}]],C=i("laptop",b);const S=[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]],M=i("map-pin",S);const $=[["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["line",{x1:"8",x2:"16",y1:"21",y2:"21",key:"1svkeh"}],["line",{x1:"12",x2:"12",y1:"17",y2:"21",key:"vw1qmm"}]],q=i("monitor",$);const E=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],F=i("shield-check",E);const L=[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2",key:"76otgf"}],["line",{x1:"12",x2:"12.01",y1:"18",y2:"18",key:"1dp563"}]],z=i("tablet",L);function D({userId:s}){const n=N(),a=!!s,{data:r,isLoading:f}=g({queryKey:["sessions",s||"me"],queryFn:async()=>{const t=a?`/api/v1/admin/users/${s}/sessions`:"/api/v1/auth/sessions",c=await fetch(t);if(!c.ok)throw new Error("Failed to load sessions");return c.json()}}),l=h({mutationFn:async t=>{const c=a?`/api/v1/admin/users/${s}/sessions/${t}`:`/api/v1/auth/sessions/${t}`;await fetch(c,{method:"DELETE"})},onSuccess:()=>{n.invalidateQueries({queryKey:["sessions",s||"me"]}),o.success("Session revoked")},onError:()=>o.error("Failed to revoke session")}),m=h({mutationFn:async()=>{const t=a?`/api/v1/admin/users/${s}/sessions/revoke-all`:"/api/v1/auth/sessions/revoke-all";await fetch(t,{method:"POST"})},onSuccess:()=>{n.invalidateQueries({queryKey:["sessions",s||"me"]}),o.success("All other sessions revoked")},onError:()=>o.error("Failed to revoke sessions")});if(f)return e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(u,{className:"h-6 w-6 animate-spin text-muted-foreground"})});const x=r?.find(t=>t.is_current),d=r?.filter(t=>!t.is_current)||[];return e.jsxs("div",{className:"space-y-6",children:[x&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"text-sm font-medium text-muted-foreground uppercase tracking-wider",children:"Current Session"}),e.jsx(p,{session:x})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"text-sm font-medium text-muted-foreground uppercase tracking-wider",children:"Other Sessions"}),d.length>0&&e.jsxs(y,{variant:"ghost",size:"sm",onClick:()=>m.mutate(),disabled:m.isPending,children:[e.jsx(v,{className:"mr-2 h-4 w-4"}),"Revoke All"]})]}),d.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(F,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No other active sessions"})]}):e.jsx("div",{className:"space-y-2",children:d.map(t=>e.jsx(p,{session:t,onRevoke:()=>l.mutate(t.id),isRevoking:l.isPending},t.id))})]})]})}function p({session:s,onRevoke:n,isRevoking:a}){const r={desktop:C,mobile:k,tablet:z}[s.device_info.device_type]||q;return e.jsx("div",{className:`p-4 rounded-lg border ${s.is_current?"border-primary bg-primary/5":"border-border"}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 rounded-full bg-muted",children:e.jsx(r,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:s.device_info.name}),s.is_current&&e.jsx("span",{className:"px-2 py-0.5 text-xs bg-primary text-primary-foreground rounded-full",children:"Current"})]}),e.jsxs("div",{className:"mt-1 text-sm text-muted-foreground space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:s.device_info.browser}),e.jsx("span",{children:"â€¢"}),e.jsx("span",{children:s.device_info.os})]}),e.jsxs("div",{className:"flex items-center gap-3 text-xs",children:[s.location&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(M,{className:"h-3 w-3"}),s.location]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(w,{className:"h-3 w-3"}),"Active ",j(new Date(s.last_active_at))]})]}),e.jsx("span",{className:"font-mono text-xs text-muted-foreground/60",children:s.ip_address})]})]})]}),!s.is_current&&n&&e.jsx(y,{variant:"ghost",size:"sm",onClick:n,disabled:a,children:a?e.jsx(u,{className:"h-4 w-4 animate-spin"}):e.jsx(v,{className:"h-4 w-4"})})]})})}export{D as SessionManager};
