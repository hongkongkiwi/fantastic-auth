import{b as n,j as e,J as i,m as y,Z as S,_ as T,$ as P,G as I,S as B}from"./main-BdAAzOp_.js";import{I as v}from"./Input-DmXcK8Ek.js";import{C as A,a as M,b as O,c as F,d as q}from"./Card-BgwA5byp.js";import{B as w}from"./Badge-C3IvCy62.js";import{T as z,a as R,b,c as N}from"./Tabs-c8LIGITi.js";import{u as k}from"./useForm-D0kRy4nt.js";import{C as D}from"./circle-check-big-BtZ3JG_-.js";import{M as L}from"./mail-nvpjyHZd.js";import{E as V,a as W,S as $}from"./SocialLoginButtons-DuK6ZazW.js";import{c as G}from"./client-logger-6z4YT9ut.js";import{L as C}from"./lock-PhA2rBqp.js";import{Z as H}from"./zap-Dzw1PjKQ.js";import"./index-TAemdWJe.js";import"./index-5WLq0AmM.js";function J({onSuccess:g}){const[l,u]=n.useState(!1),[o,h]=n.useState(!1),[f,c]=n.useState(""),[x,p]=n.useState(""),d=k({defaultValues:{email:""},onSubmit:async({value:s})=>{c(""),u(!0);try{const t=await fetch("/api/v1/auth/magic-link",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:s.email})});if(!t.ok){const m=await t.json();throw new Error(m.error?.message||"Failed to send magic link")}p(s.email),h(!0),g?.()}catch(t){c(t instanceof Error?t.message:"An error occurred")}finally{u(!1)}}});return o?e.jsxs(i.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"text-center space-y-4 py-8",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 dark:bg-green-900/20 rounded-full flex items-center justify-center mx-auto",children:e.jsx(D,{className:"w-8 h-8 text-green-600 dark:text-green-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Check your email"}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["We've sent a magic link to ",e.jsx("strong",{children:x})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"Link expires in 15 minutes"})]}),e.jsx(y,{variant:"ghost",size:"sm",onClick:()=>{h(!1),p(""),d.reset()},children:"Use a different email"})]}):e.jsxs("form",{onSubmit:s=>{s.preventDefault(),s.stopPropagation(),d.handleSubmit()},className:"space-y-4",children:[e.jsx("div",{className:"space-y-2",children:e.jsx(d.Field,{name:"email",validators:{onChange:({value:s})=>{if(!s.trim())return"Email is required";if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s))return"Please enter a valid email"}},children:s=>e.jsx(v,{label:"Email",type:"email",placeholder:"you@example.com",value:s.state.value,onChange:t=>s.handleChange(t.target.value),onBlur:s.handleBlur,leftIcon:e.jsx(L,{className:"h-4 w-4 text-muted-foreground"}),name:"email",autoComplete:"email",autoCapitalize:"none",spellCheck:!1,required:!0,disabled:l,error:f||(s.state.meta.isTouched?s.state.meta.errors[0]:void 0)})})}),e.jsx(y,{type:"submit",fullWidth:!0,isLoading:l,rightIcon:e.jsx(S,{className:"h-4 w-4"}),children:l?"Sending…":"Send Magic Link"}),e.jsx("p",{className:"text-xs text-center text-muted-foreground",children:"You'll receive an email with a secure link to sign in instantly"})]})}function oe(){const g=T(),{login:l,isAuthenticated:u}=P(),[o,h]=n.useState(!1),[f,c]=n.useState(!1),[x,p]=n.useState("password"),[d,s]=n.useState(null),t=I(),m=k({defaultValues:{email:"",password:""},onSubmit:async({value:a})=>{c(!0);try{await l(a.email,a.password)}finally{c(!1)}}});if(u)return g({to:"/"}),null;const j=async a=>{s(a);try{const r=await fetch(`/api/v1/auth/oauth/${a}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({redirectUri:window.location.origin+"/oauth/callback"})});if(!r.ok)throw new Error("Failed to initiate OAuth");const{authUrl:E}=await r.json();window.location.href=E}catch(r){G.error("OAuth error",r)}finally{s(null)}};return e.jsxs("div",{className:"min-h-screen flex items-center justify-center p-4 bg-gradient-to-br from-background via-background to-muted",children:[e.jsxs("div",{className:"fixed inset-0 overflow-hidden pointer-events-none",children:[e.jsx("div",{className:"absolute -top-1/2 -right-1/2 w-full h-full bg-primary/5 rounded-full blur-3xl"}),e.jsx("div",{className:"absolute -bottom-1/2 -left-1/2 w-full h-full bg-secondary/5 rounded-full blur-3xl"})]}),e.jsxs(i.div,{initial:t?!1:{opacity:0,y:20},animate:{opacity:1,y:0},transition:t?{duration:0}:{duration:.5},className:"w-full max-w-md relative z-10",children:[e.jsx("div",{className:"flex justify-center mb-8",children:e.jsxs(i.div,{initial:t?!1:{scale:.8},animate:{scale:1},transition:t?{duration:0}:{delay:.2,type:"spring"},className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-12 w-12 rounded-xl bg-primary flex items-center justify-center shadow-glow",children:e.jsx(B,{className:"h-7 w-7 text-primary-foreground"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Vault"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Admin Console"})]})]})}),e.jsxs(A,{className:"shadow-elevated",children:[e.jsxs(M,{className:"space-y-1",children:[e.jsx(O,{className:"text-2xl text-center",children:"Welcome back"}),e.jsx(F,{className:"text-center",children:"Sign in to access your admin panel"})]}),e.jsxs(q,{children:[e.jsxs(z,{value:x,onValueChange:a=>p(a),className:"mb-6",children:[e.jsxs(R,{className:"grid w-full grid-cols-2",children:[e.jsxs(b,{value:"password",className:"gap-2",children:[e.jsx(C,{className:"h-4 w-4"}),"Password"]}),e.jsxs(b,{value:"magic-link",className:"gap-2",children:[e.jsx(H,{className:"h-4 w-4"}),"Magic Link"]})]}),e.jsxs(N,{value:"password",className:"mt-4",children:[e.jsxs("form",{onSubmit:a=>{a.preventDefault(),a.stopPropagation(),m.handleSubmit()},className:"space-y-4",children:[e.jsx(i.div,{initial:t?!1:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:t?{duration:0}:{delay:.3},children:e.jsx(m.Field,{name:"email",validators:{onChange:({value:a})=>{if(!a.trim())return"Email is required";if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a))return"Please enter a valid email"}},children:a=>e.jsx(v,{label:"Email",type:"email",placeholder:"admin@vault.local",value:a.state.value,onChange:r=>a.handleChange(r.target.value),onBlur:a.handleBlur,error:a.state.meta.isTouched?a.state.meta.errors[0]:void 0,leftIcon:e.jsx(L,{className:"h-4 w-4 text-muted-foreground"}),autoComplete:"email",autoCapitalize:"none",spellCheck:!1,required:!0})})}),e.jsx(i.div,{initial:t?!1:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:t?{duration:0}:{delay:.4},children:e.jsx("div",{className:"relative",children:e.jsx(m.Field,{name:"password",validators:{onChange:({value:a})=>{if(x==="password"&&!a)return"Password is required"}},children:a=>e.jsx(v,{label:"Password",type:o?"text":"password",placeholder:"••••••••",value:a.state.value,onChange:r=>a.handleChange(r.target.value),onBlur:a.handleBlur,error:a.state.meta.isTouched?a.state.meta.errors[0]:void 0,leftIcon:e.jsx(C,{className:"h-4 w-4 text-muted-foreground"}),autoComplete:"current-password",rightIcon:e.jsx("button",{type:"button",onClick:()=>h(!o),className:"text-muted-foreground hover:text-foreground transition-colors","aria-label":o?"Hide password":"Show password",children:o?e.jsx(V,{className:"h-4 w-4"}):e.jsx(W,{className:"h-4 w-4"})}),required:!0})})})}),e.jsxs(i.div,{initial:t?!1:{opacity:0,y:20},animate:{opacity:1,y:0},transition:t?{duration:0}:{delay:.5},className:"flex items-center justify-between text-sm",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"rounded border-input"}),e.jsx("span",{className:"text-muted-foreground",children:"Remember me"})]}),e.jsx("a",{href:"#",className:"text-primary hover:underline",children:"Forgot password?"})]}),e.jsx(i.div,{initial:t?!1:{opacity:0,y:20},animate:{opacity:1,y:0},transition:t?{duration:0}:{delay:.6},children:e.jsx(y,{type:"submit",fullWidth:!0,size:"lg",isLoading:f,rightIcon:e.jsx(S,{className:"h-4 w-4"}),children:"Sign In"})})]}),e.jsx(i.div,{initial:t?!1:{opacity:0},animate:{opacity:1},transition:t?{duration:0}:{delay:.7},className:"mt-6",children:e.jsx($,{onGoogleClick:()=>j("google"),onGitHubClick:()=>j("github"),onAppleClick:()=>j("apple"),isLoading:!!d})})]}),e.jsx(N,{value:"magic-link",className:"mt-4",children:e.jsx(J,{})})]}),e.jsxs(i.div,{initial:t?!1:{opacity:0},animate:{opacity:1},transition:t?{duration:0}:{delay:.8},className:"mt-6 p-4 rounded-lg bg-muted/50 border border-dashed",children:[e.jsx("p",{className:"text-xs text-muted-foreground text-center mb-2",children:"Demo Credentials"}),e.jsxs("div",{className:"flex items-center justify-center gap-2 text-sm",children:[e.jsx(w,{variant:"secondary",children:"admin@vault.local"}),e.jsx("span",{className:"text-muted-foreground",children:"/"}),e.jsx(w,{variant:"secondary",children:"admin"})]})]})]})]}),e.jsx(i.p,{initial:t?!1:{opacity:0},animate:{opacity:1},transition:t?{duration:0}:{delay:.9},className:"text-center text-sm text-muted-foreground mt-6",children:"Protected by industry-standard encryption"})]})]})}export{oe as component};
