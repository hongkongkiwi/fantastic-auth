import{c as Ut,e as Le,g as Bt,a as Vt,d as Ht,r as Ft,b as o,j as e,D as Ue,f as Be,h as Ve,i as He,k as Fe,B as Kt,l as Ke,m as F,n as Wt,P,u as Oe,o as Pe,p as k,q as $,s as I,t as qt,v as We,w as zt,x as $t,y as Gt,z as Yt,R as Qt,F as Zt,A as Xt,C as G,E as qe,G as Jt,H as en,I as tn,J as nn,K as sn,L as Se,S as on}from"./main-BdAAzOp_.js";import{C as ze,a as rn,D as an,c as ln}from"./DataTable-DZ4Ke5vQ.js";import{B as cn}from"./Badge-C3IvCy62.js";import{C as Ae}from"./Card-BgwA5byp.js";import{R as dn,c as $e,A as un,C as pn,a as mn,D as fn,b as hn,E as xn,d as gn,e as ye}from"./DropdownMenu-DQ1y4H24.js";import{A as Ne,a as Ce}from"./Alert-DT3fX0Ix.js";import{u as Ge,a as _e}from"./useQuery-ButOQx42.js";import{u as Ye}from"./useMutation-BBfU30nI.js";import{T as vn,c as Me}from"./index-DiNIrD90.js";import{u as wn,c as Sn}from"./index-5WLq0AmM.js";import{u as yn}from"./index-CoX5m-mX.js";import{C as Qe}from"./check-OH4VeEnu.js";import{U as Nn}from"./user-CSbn4zdS.js";import{C as ke}from"./circle-alert-DITzmtt1.js";import{M as Cn}from"./mail-nvpjyHZd.js";import{T as jn}from"./trash-2-BL6sv700.js";import"./Input-DmXcK8Ek.js";import"./Skeleton-ChEia7iB.js";import"./Checkbox-C1KPPGQi.js";import"./index-DBCmHaCG.js";import"./download-B8kCLmm8.js";import"./index-TAemdWJe.js";const bn=[["path",{d:"m16 3 4 4-4 4",key:"1x1c3m"}],["path",{d:"M20 7H4",key:"zbl0bi"}],["path",{d:"m8 21-4-4 4-4",key:"h9nckh"}],["path",{d:"M4 17h16",key:"g4d7ey"}]],je=Ut("arrow-right-left",bn),de=Le.VITE_INTERNAL_UI_TOKEN||"";function Tn(t){return _e({queryKey:["ownership","status",t],queryFn:async()=>Bt({data:{userId:t,uiToken:de}}),enabled:!!t})}function In(t){return _e({queryKey:["ownership","canDelete",t],queryFn:async()=>Vt({data:{userId:t,uiToken:de}}),enabled:!!t})}function En(){const t=Ge();return Ye({mutationFn:async({userId:s,tenantId:n})=>Ht({data:{userId:s,tenantId:n,uiToken:de}}),onSuccess:()=>{t.invalidateQueries({queryKey:["users"]}),t.invalidateQueries({queryKey:["ownership"]})}})}function Rn(){const t=Ge();return Ye({mutationFn:async({tenantId:s,fromUserId:n,toUserId:r})=>Ft({data:{tenantId:s,fromUserId:n,toUserId:r,uiToken:de}}),onSuccess:()=>{t.invalidateQueries({queryKey:["ownership","transfers"]})}})}function Pn(t){const{data:s,isLoading:n}=Tn(t),{data:r,isLoading:a}=In(t);return{isLoading:n||a,status:s,canDelete:r?.canDelete??!1,deleteBlockReason:r?.reason??null,deleteBlockMessage:r?.message??null,ownedTenants:r?.ownedTenants??[]}}function _n({user:t,isOpen:s,onClose:n,onSuccess:r,onTransferOwnership:a}){const[u,i]=o.useState(""),c=t?.id??"",{isLoading:d,canDelete:m,deleteBlockReason:g,deleteBlockMessage:v,ownedTenants:N}=Pn(c),w=En(),f=g==="PRIMARY_OWNER",l=!d&&m&&u==="DELETE",h=async()=>{if(!(!l||!t))try{await w.mutateAsync({userId:t.id}),i(""),r?.(),n()}catch{}},y=()=>{t&&a&&(a(t.id),n())};return e.jsx(Ue,{open:s,onOpenChange:n,children:e.jsxs(Be,{className:"sm:max-w-md",children:[e.jsxs(Ve,{children:[e.jsxs(He,{className:"flex items-center gap-2 text-destructive",children:[e.jsx(vn,{className:"h-5 w-5"}),"Delete User"]}),e.jsxs(Fe,{children:["This action cannot be undone. This will permanently delete"," ",e.jsx("strong",{children:t?.email})," and remove their data from our servers."]})]}),f&&e.jsxs(Ne,{variant:"destructive",className:"mt-4",children:[e.jsx(Kt,{className:"h-4 w-4"}),e.jsxs(Ce,{className:"mt-2",children:[e.jsx("p",{className:"font-medium",children:"Cannot Delete Account"}),e.jsx("p",{className:"mt-1 text-sm",children:v}),N.length>0&&e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-sm font-medium",children:"Owned Tenants:"}),e.jsx("ul",{className:"mt-1 list-inside list-disc text-sm",children:N.map(p=>e.jsx("li",{children:p},p))})]})]})]}),!f&&e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["To confirm deletion, type ",e.jsx("strong",{children:"DELETE"})," below:"]}),e.jsx("input",{type:"text",value:u,onChange:p=>i(p.target.value),placeholder:"Type DELETE to confirm",className:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring"})]}),e.jsx(Ke,{className:"gap-2 sm:gap-0",children:f?e.jsxs(e.Fragment,{children:[e.jsx(F,{variant:"outline",onClick:n,children:"Cancel"}),e.jsxs(F,{variant:"outline",onClick:y,className:"gap-2",children:[e.jsx(je,{className:"h-4 w-4"}),"Transfer Ownership"]})]}):e.jsxs(e.Fragment,{children:[e.jsx(F,{variant:"outline",onClick:n,children:"Cancel"}),e.jsx(F,{variant:"destructive",onClick:h,disabled:!l||w.isPending,children:w.isPending?"Deleting…":"Delete User"})]})})]})})}function Dn(t){const s=On(t),n=o.forwardRef((r,a)=>{const{children:u,...i}=r,c=o.Children.toArray(u),d=c.find(Mn);if(d){const m=d.props.children,g=c.map(v=>v===d?o.Children.count(m)>1?o.Children.only(null):o.isValidElement(m)?m.props.children:null:v);return e.jsx(s,{...i,ref:a,children:o.isValidElement(m)?o.cloneElement(m,void 0,g):null})}return e.jsx(s,{...i,ref:a,children:u})});return n.displayName=`${t}.Slot`,n}function On(t){const s=o.forwardRef((n,r)=>{const{children:a,...u}=n;if(o.isValidElement(a)){const i=Ln(a),c=kn(u,a.props);return a.type!==o.Fragment&&(c.ref=r?Wt(r,i):i),o.cloneElement(a,c)}return o.Children.count(a)>1?o.Children.only(null):null});return s.displayName=`${t}.SlotClone`,s}var An=Symbol("radix.slottable");function Mn(t){return o.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===An}function kn(t,s){const n={...s};for(const r in s){const a=t[r],u=s[r];/^on[A-Z]/.test(r)?a&&u?n[r]=(...c)=>{const d=u(...c);return a(...c),d}:a&&(n[r]=a):r==="style"?n[r]={...a,...u}:r==="className"&&(n[r]=[a,u].filter(Boolean).join(" "))}return{...t,...n}}function Ln(t){let s=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,n=s&&"isReactWarning"in s&&s.isReactWarning;return n?t.ref:(s=Object.getOwnPropertyDescriptor(t,"ref")?.get,n=s&&"isReactWarning"in s&&s.isReactWarning,n?t.props.ref:t.props.ref||t.ref)}var Ze=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),Un="VisuallyHidden",Bn=o.forwardRef((t,s)=>e.jsx(P.span,{...t,ref:s,style:{...Ze,...t.style}}));Bn.displayName=Un;var Vn=[" ","Enter","ArrowUp","ArrowDown"],Hn=[" ","Enter"],ee="Select",[ue,pe,Fn]=Sn(ee),[se]=zt(ee,[Fn,$e]),me=$e(),[Kn,Y]=se(ee),[Wn,qn]=se(ee),Xe=t=>{const{__scopeSelect:s,children:n,open:r,defaultOpen:a,onOpenChange:u,value:i,defaultValue:c,onValueChange:d,dir:m,name:g,autoComplete:v,disabled:N,required:w,form:f}=t,l=me(s),[h,y]=o.useState(null),[p,S]=o.useState(null),[K,D]=o.useState(!1),oe=wn(m),[E,A]=Oe({prop:r,defaultProp:a??!1,onChange:u,caller:ee}),[W,Z]=Oe({prop:i,defaultProp:c,onChange:d,caller:ee}),L=o.useRef(null),U=h?f||!!h.closest("form"):!0,[q,B]=o.useState(new Set),V=Array.from(q).map(R=>R.props.value).join(";");return e.jsx(dn,{...l,children:e.jsxs(Kn,{required:w,scope:s,trigger:h,onTriggerChange:y,valueNode:p,onValueNodeChange:S,valueNodeHasChildren:K,onValueNodeHasChildrenChange:D,contentId:Pe(),value:W,onValueChange:Z,open:E,onOpenChange:A,dir:oe,triggerPointerDownPosRef:L,disabled:N,children:[e.jsx(ue.Provider,{scope:s,children:e.jsx(Wn,{scope:t.__scopeSelect,onNativeOptionAdd:o.useCallback(R=>{B(M=>new Set(M).add(R))},[]),onNativeOptionRemove:o.useCallback(R=>{B(M=>{const H=new Set(M);return H.delete(R),H})},[]),children:n})}),U?e.jsxs(Nt,{"aria-hidden":!0,required:w,tabIndex:-1,name:g,autoComplete:v,value:W,onChange:R=>Z(R.target.value),disabled:N,form:f,children:[W===void 0?e.jsx("option",{value:""}):null,Array.from(q)]},V):null]})})};Xe.displayName=ee;var Je="SelectTrigger",et=o.forwardRef((t,s)=>{const{__scopeSelect:n,disabled:r=!1,...a}=t,u=me(n),i=Y(Je,n),c=i.disabled||r,d=k(s,i.onTriggerChange),m=pe(n),g=o.useRef("touch"),[v,N,w]=jt(l=>{const h=m().filter(S=>!S.disabled),y=h.find(S=>S.value===i.value),p=bt(h,l,y);p!==void 0&&i.onValueChange(p.value)}),f=l=>{c||(i.onOpenChange(!0),w()),l&&(i.triggerPointerDownPosRef.current={x:Math.round(l.pageX),y:Math.round(l.pageY)})};return e.jsx(un,{asChild:!0,...u,children:e.jsx(P.button,{type:"button",role:"combobox","aria-controls":i.contentId,"aria-expanded":i.open,"aria-required":i.required,"aria-autocomplete":"none",dir:i.dir,"data-state":i.open?"open":"closed",disabled:c,"data-disabled":c?"":void 0,"data-placeholder":Ct(i.value)?"":void 0,...a,ref:d,onClick:I(a.onClick,l=>{l.currentTarget.focus(),g.current!=="mouse"&&f(l)}),onPointerDown:I(a.onPointerDown,l=>{g.current=l.pointerType;const h=l.target;h.hasPointerCapture(l.pointerId)&&h.releasePointerCapture(l.pointerId),l.button===0&&l.ctrlKey===!1&&l.pointerType==="mouse"&&(f(l),l.preventDefault())}),onKeyDown:I(a.onKeyDown,l=>{const h=v.current!=="";!(l.ctrlKey||l.altKey||l.metaKey)&&l.key.length===1&&N(l.key),!(h&&l.key===" ")&&Vn.includes(l.key)&&(f(),l.preventDefault())})})})});et.displayName=Je;var tt="SelectValue",nt=o.forwardRef((t,s)=>{const{__scopeSelect:n,className:r,style:a,children:u,placeholder:i="",...c}=t,d=Y(tt,n),{onValueNodeHasChildrenChange:m}=d,g=u!==void 0,v=k(s,d.onValueNodeChange);return $(()=>{m(g)},[m,g]),e.jsx(P.span,{...c,ref:v,style:{pointerEvents:"none"},children:Ct(d.value)?e.jsx(e.Fragment,{children:i}):u})});nt.displayName=tt;var zn="SelectIcon",st=o.forwardRef((t,s)=>{const{__scopeSelect:n,children:r,...a}=t;return e.jsx(P.span,{"aria-hidden":!0,...a,ref:s,children:r||"▼"})});st.displayName=zn;var $n="SelectPortal",ot=t=>e.jsx(qt,{asChild:!0,...t});ot.displayName=$n;var te="SelectContent",rt=o.forwardRef((t,s)=>{const n=Y(te,t.__scopeSelect),[r,a]=o.useState();if($(()=>{a(new DocumentFragment)},[]),!n.open){const u=r;return u?We.createPortal(e.jsx(at,{scope:t.__scopeSelect,children:e.jsx(ue.Slot,{scope:t.__scopeSelect,children:e.jsx("div",{children:t.children})})}),u):null}return e.jsx(lt,{...t,ref:s})});rt.displayName=te;var O=10,[at,Q]=se(te),Gn="SelectContentImpl",Yn=Dn("SelectContent.RemoveScroll"),lt=o.forwardRef((t,s)=>{const{__scopeSelect:n,position:r="item-aligned",onCloseAutoFocus:a,onEscapeKeyDown:u,onPointerDownOutside:i,side:c,sideOffset:d,align:m,alignOffset:g,arrowPadding:v,collisionBoundary:N,collisionPadding:w,sticky:f,hideWhenDetached:l,avoidCollisions:h,...y}=t,p=Y(te,n),[S,K]=o.useState(null),[D,oe]=o.useState(null),E=k(s,x=>K(x)),[A,W]=o.useState(null),[Z,L]=o.useState(null),U=pe(n),[q,B]=o.useState(!1),V=o.useRef(!1);o.useEffect(()=>{if(S)return Gt(S)},[S]),Yt();const R=o.useCallback(x=>{const[b,..._]=U().map(T=>T.ref.current),[C]=_.slice(-1),j=document.activeElement;for(const T of x)if(T===j||(T?.scrollIntoView({block:"nearest"}),T===b&&D&&(D.scrollTop=0),T===C&&D&&(D.scrollTop=D.scrollHeight),T?.focus(),document.activeElement!==j))return},[U,D]),M=o.useCallback(()=>R([A,S]),[R,A,S]);o.useEffect(()=>{q&&M()},[q,M]);const{onOpenChange:H,triggerPointerDownPosRef:z}=p;o.useEffect(()=>{if(S){let x={x:0,y:0};const b=C=>{x={x:Math.abs(Math.round(C.pageX)-(z.current?.x??0)),y:Math.abs(Math.round(C.pageY)-(z.current?.y??0))}},_=C=>{x.x<=10&&x.y<=10?C.preventDefault():S.contains(C.target)||H(!1),document.removeEventListener("pointermove",b),z.current=null};return z.current!==null&&(document.addEventListener("pointermove",b),document.addEventListener("pointerup",_,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",b),document.removeEventListener("pointerup",_,{capture:!0})}}},[S,H,z]),o.useEffect(()=>{const x=()=>H(!1);return window.addEventListener("blur",x),window.addEventListener("resize",x),()=>{window.removeEventListener("blur",x),window.removeEventListener("resize",x)}},[H]);const[fe,le]=jt(x=>{const b=U().filter(j=>!j.disabled),_=b.find(j=>j.ref.current===document.activeElement),C=bt(b,x,_);C&&setTimeout(()=>C.ref.current.focus())}),he=o.useCallback((x,b,_)=>{const C=!V.current&&!_;(p.value!==void 0&&p.value===b||C)&&(W(x),C&&(V.current=!0))},[p.value]),xe=o.useCallback(()=>S?.focus(),[S]),ne=o.useCallback((x,b,_)=>{const C=!V.current&&!_;(p.value!==void 0&&p.value===b||C)&&L(x)},[p.value]),ie=r==="popper"?be:it,re=ie===be?{side:c,sideOffset:d,align:m,alignOffset:g,arrowPadding:v,collisionBoundary:N,collisionPadding:w,sticky:f,hideWhenDetached:l,avoidCollisions:h}:{};return e.jsx(at,{scope:n,content:S,viewport:D,onViewportChange:oe,itemRefCallback:he,selectedItem:A,onItemLeave:xe,itemTextRefCallback:ne,focusSelectedItem:M,selectedItemText:Z,position:r,isPositioned:q,searchRef:fe,children:e.jsx(Qt,{as:Yn,allowPinchZoom:!0,children:e.jsx(Zt,{asChild:!0,trapped:p.open,onMountAutoFocus:x=>{x.preventDefault()},onUnmountAutoFocus:I(a,x=>{p.trigger?.focus({preventScroll:!0}),x.preventDefault()}),children:e.jsx(Xt,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:u,onPointerDownOutside:i,onFocusOutside:x=>x.preventDefault(),onDismiss:()=>p.onOpenChange(!1),children:e.jsx(ie,{role:"listbox",id:p.contentId,"data-state":p.open?"open":"closed",dir:p.dir,onContextMenu:x=>x.preventDefault(),...y,...re,onPlaced:()=>B(!0),ref:E,style:{display:"flex",flexDirection:"column",outline:"none",...y.style},onKeyDown:I(y.onKeyDown,x=>{const b=x.ctrlKey||x.altKey||x.metaKey;if(x.key==="Tab"&&x.preventDefault(),!b&&x.key.length===1&&le(x.key),["ArrowUp","ArrowDown","Home","End"].includes(x.key)){let C=U().filter(j=>!j.disabled).map(j=>j.ref.current);if(["ArrowUp","End"].includes(x.key)&&(C=C.slice().reverse()),["ArrowUp","ArrowDown"].includes(x.key)){const j=x.target,T=C.indexOf(j);C=C.slice(T+1)}setTimeout(()=>R(C)),x.preventDefault()}})})})})})})});lt.displayName=Gn;var Qn="SelectItemAlignedPosition",it=o.forwardRef((t,s)=>{const{__scopeSelect:n,onPlaced:r,...a}=t,u=Y(te,n),i=Q(te,n),[c,d]=o.useState(null),[m,g]=o.useState(null),v=k(s,E=>g(E)),N=pe(n),w=o.useRef(!1),f=o.useRef(!0),{viewport:l,selectedItem:h,selectedItemText:y,focusSelectedItem:p}=i,S=o.useCallback(()=>{if(u.trigger&&u.valueNode&&c&&m&&l&&h&&y){const E=u.trigger.getBoundingClientRect(),A=m.getBoundingClientRect(),W=u.valueNode.getBoundingClientRect(),Z=y.getBoundingClientRect();if(u.dir!=="rtl"){const j=Z.left-A.left,T=W.left-j,X=E.left-T,J=E.width+X,ge=Math.max(J,A.width),ve=window.innerWidth-O,we=Me(T,[O,Math.max(O,ve-ge)]);c.style.minWidth=J+"px",c.style.left=we+"px"}else{const j=A.right-Z.right,T=window.innerWidth-W.right-j,X=window.innerWidth-E.right-T,J=E.width+X,ge=Math.max(J,A.width),ve=window.innerWidth-O,we=Me(T,[O,Math.max(O,ve-ge)]);c.style.minWidth=J+"px",c.style.right=we+"px"}const L=N(),U=window.innerHeight-O*2,q=l.scrollHeight,B=window.getComputedStyle(m),V=parseInt(B.borderTopWidth,10),R=parseInt(B.paddingTop,10),M=parseInt(B.borderBottomWidth,10),H=parseInt(B.paddingBottom,10),z=V+R+q+H+M,fe=Math.min(h.offsetHeight*5,z),le=window.getComputedStyle(l),he=parseInt(le.paddingTop,10),xe=parseInt(le.paddingBottom,10),ne=E.top+E.height/2-O,ie=U-ne,re=h.offsetHeight/2,x=h.offsetTop+re,b=V+R+x,_=z-b;if(b<=ne){const j=L.length>0&&h===L[L.length-1].ref.current;c.style.bottom="0px";const T=m.clientHeight-l.offsetTop-l.offsetHeight,X=Math.max(ie,re+(j?xe:0)+T+M),J=b+X;c.style.height=J+"px"}else{const j=L.length>0&&h===L[0].ref.current;c.style.top="0px";const X=Math.max(ne,V+l.offsetTop+(j?he:0)+re)+_;c.style.height=X+"px",l.scrollTop=b-ne+l.offsetTop}c.style.margin=`${O}px 0`,c.style.minHeight=fe+"px",c.style.maxHeight=U+"px",r?.(),requestAnimationFrame(()=>w.current=!0)}},[N,u.trigger,u.valueNode,c,m,l,h,y,u.dir,r]);$(()=>S(),[S]);const[K,D]=o.useState();$(()=>{m&&D(window.getComputedStyle(m).zIndex)},[m]);const oe=o.useCallback(E=>{E&&f.current===!0&&(S(),p?.(),f.current=!1)},[S,p]);return e.jsx(Xn,{scope:n,contentWrapper:c,shouldExpandOnScrollRef:w,onScrollButtonChange:oe,children:e.jsx("div",{ref:d,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:K},children:e.jsx(P.div,{...a,ref:v,style:{boxSizing:"border-box",maxHeight:"100%",...a.style}})})})});it.displayName=Qn;var Zn="SelectPopperPosition",be=o.forwardRef((t,s)=>{const{__scopeSelect:n,align:r="start",collisionPadding:a=O,...u}=t,i=me(n);return e.jsx(pn,{...i,...u,ref:s,align:r,collisionPadding:a,style:{boxSizing:"border-box",...u.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});be.displayName=Zn;var[Xn,De]=se(te,{}),Te="SelectViewport",ct=o.forwardRef((t,s)=>{const{__scopeSelect:n,nonce:r,...a}=t,u=Q(Te,n),i=De(Te,n),c=k(s,u.onViewportChange),d=o.useRef(0);return e.jsxs(e.Fragment,{children:[e.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:r}),e.jsx(ue.Slot,{scope:n,children:e.jsx(P.div,{"data-radix-select-viewport":"",role:"presentation",...a,ref:c,style:{position:"relative",flex:1,overflow:"hidden auto",...a.style},onScroll:I(a.onScroll,m=>{const g=m.currentTarget,{contentWrapper:v,shouldExpandOnScrollRef:N}=i;if(N?.current&&v){const w=Math.abs(d.current-g.scrollTop);if(w>0){const f=window.innerHeight-O*2,l=parseFloat(v.style.minHeight),h=parseFloat(v.style.height),y=Math.max(l,h);if(y<f){const p=y+w,S=Math.min(f,p),K=p-S;v.style.height=S+"px",v.style.bottom==="0px"&&(g.scrollTop=K>0?K:0,v.style.justifyContent="flex-end")}}}d.current=g.scrollTop})})})]})});ct.displayName=Te;var dt="SelectGroup",[Jn,es]=se(dt),ts=o.forwardRef((t,s)=>{const{__scopeSelect:n,...r}=t,a=Pe();return e.jsx(Jn,{scope:n,id:a,children:e.jsx(P.div,{role:"group","aria-labelledby":a,...r,ref:s})})});ts.displayName=dt;var ut="SelectLabel",pt=o.forwardRef((t,s)=>{const{__scopeSelect:n,...r}=t,a=es(ut,n);return e.jsx(P.div,{id:a.id,...r,ref:s})});pt.displayName=ut;var ce="SelectItem",[ns,mt]=se(ce),ft=o.forwardRef((t,s)=>{const{__scopeSelect:n,value:r,disabled:a=!1,textValue:u,...i}=t,c=Y(ce,n),d=Q(ce,n),m=c.value===r,[g,v]=o.useState(u??""),[N,w]=o.useState(!1),f=k(s,p=>d.itemRefCallback?.(p,r,a)),l=Pe(),h=o.useRef("touch"),y=()=>{a||(c.onValueChange(r),c.onOpenChange(!1))};if(r==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return e.jsx(ns,{scope:n,value:r,disabled:a,textId:l,isSelected:m,onItemTextChange:o.useCallback(p=>{v(S=>S||(p?.textContent??"").trim())},[]),children:e.jsx(ue.ItemSlot,{scope:n,value:r,disabled:a,textValue:g,children:e.jsx(P.div,{role:"option","aria-labelledby":l,"data-highlighted":N?"":void 0,"aria-selected":m&&N,"data-state":m?"checked":"unchecked","aria-disabled":a||void 0,"data-disabled":a?"":void 0,tabIndex:a?void 0:-1,...i,ref:f,onFocus:I(i.onFocus,()=>w(!0)),onBlur:I(i.onBlur,()=>w(!1)),onClick:I(i.onClick,()=>{h.current!=="mouse"&&y()}),onPointerUp:I(i.onPointerUp,()=>{h.current==="mouse"&&y()}),onPointerDown:I(i.onPointerDown,p=>{h.current=p.pointerType}),onPointerMove:I(i.onPointerMove,p=>{h.current=p.pointerType,a?d.onItemLeave?.():h.current==="mouse"&&p.currentTarget.focus({preventScroll:!0})}),onPointerLeave:I(i.onPointerLeave,p=>{p.currentTarget===document.activeElement&&d.onItemLeave?.()}),onKeyDown:I(i.onKeyDown,p=>{d.searchRef?.current!==""&&p.key===" "||(Hn.includes(p.key)&&y(),p.key===" "&&p.preventDefault())})})})})});ft.displayName=ce;var ae="SelectItemText",ht=o.forwardRef((t,s)=>{const{__scopeSelect:n,className:r,style:a,...u}=t,i=Y(ae,n),c=Q(ae,n),d=mt(ae,n),m=qn(ae,n),[g,v]=o.useState(null),N=k(s,y=>v(y),d.onItemTextChange,y=>c.itemTextRefCallback?.(y,d.value,d.disabled)),w=g?.textContent,f=o.useMemo(()=>e.jsx("option",{value:d.value,disabled:d.disabled,children:w},d.value),[d.disabled,d.value,w]),{onNativeOptionAdd:l,onNativeOptionRemove:h}=m;return $(()=>(l(f),()=>h(f)),[l,h,f]),e.jsxs(e.Fragment,{children:[e.jsx(P.span,{id:d.textId,...u,ref:N}),d.isSelected&&i.valueNode&&!i.valueNodeHasChildren?We.createPortal(u.children,i.valueNode):null]})});ht.displayName=ae;var xt="SelectItemIndicator",gt=o.forwardRef((t,s)=>{const{__scopeSelect:n,...r}=t;return mt(xt,n).isSelected?e.jsx(P.span,{"aria-hidden":!0,...r,ref:s}):null});gt.displayName=xt;var Ie="SelectScrollUpButton",vt=o.forwardRef((t,s)=>{const n=Q(Ie,t.__scopeSelect),r=De(Ie,t.__scopeSelect),[a,u]=o.useState(!1),i=k(s,r.onScrollButtonChange);return $(()=>{if(n.viewport&&n.isPositioned){let c=function(){const m=d.scrollTop>0;u(m)};const d=n.viewport;return c(),d.addEventListener("scroll",c),()=>d.removeEventListener("scroll",c)}},[n.viewport,n.isPositioned]),a?e.jsx(St,{...t,ref:i,onAutoScroll:()=>{const{viewport:c,selectedItem:d}=n;c&&d&&(c.scrollTop=c.scrollTop-d.offsetHeight)}}):null});vt.displayName=Ie;var Ee="SelectScrollDownButton",wt=o.forwardRef((t,s)=>{const n=Q(Ee,t.__scopeSelect),r=De(Ee,t.__scopeSelect),[a,u]=o.useState(!1),i=k(s,r.onScrollButtonChange);return $(()=>{if(n.viewport&&n.isPositioned){let c=function(){const m=d.scrollHeight-d.clientHeight,g=Math.ceil(d.scrollTop)<m;u(g)};const d=n.viewport;return c(),d.addEventListener("scroll",c),()=>d.removeEventListener("scroll",c)}},[n.viewport,n.isPositioned]),a?e.jsx(St,{...t,ref:i,onAutoScroll:()=>{const{viewport:c,selectedItem:d}=n;c&&d&&(c.scrollTop=c.scrollTop+d.offsetHeight)}}):null});wt.displayName=Ee;var St=o.forwardRef((t,s)=>{const{__scopeSelect:n,onAutoScroll:r,...a}=t,u=Q("SelectScrollButton",n),i=o.useRef(null),c=pe(n),d=o.useCallback(()=>{i.current!==null&&(window.clearInterval(i.current),i.current=null)},[]);return o.useEffect(()=>()=>d(),[d]),$(()=>{c().find(g=>g.ref.current===document.activeElement)?.ref.current?.scrollIntoView({block:"nearest"})},[c]),e.jsx(P.div,{"aria-hidden":!0,...a,ref:s,style:{flexShrink:0,...a.style},onPointerDown:I(a.onPointerDown,()=>{i.current===null&&(i.current=window.setInterval(r,50))}),onPointerMove:I(a.onPointerMove,()=>{u.onItemLeave?.(),i.current===null&&(i.current=window.setInterval(r,50))}),onPointerLeave:I(a.onPointerLeave,()=>{d()})})}),ss="SelectSeparator",yt=o.forwardRef((t,s)=>{const{__scopeSelect:n,...r}=t;return e.jsx(P.div,{"aria-hidden":!0,...r,ref:s})});yt.displayName=ss;var Re="SelectArrow",os=o.forwardRef((t,s)=>{const{__scopeSelect:n,...r}=t,a=me(n),u=Y(Re,n),i=Q(Re,n);return u.open&&i.position==="popper"?e.jsx(mn,{...a,...r,ref:s}):null});os.displayName=Re;var rs="SelectBubbleInput",Nt=o.forwardRef(({__scopeSelect:t,value:s,...n},r)=>{const a=o.useRef(null),u=k(r,a),i=yn(s);return o.useEffect(()=>{const c=a.current;if(!c)return;const d=window.HTMLSelectElement.prototype,g=Object.getOwnPropertyDescriptor(d,"value").set;if(i!==s&&g){const v=new Event("change",{bubbles:!0});g.call(c,s),c.dispatchEvent(v)}},[i,s]),e.jsx(P.select,{...n,style:{...Ze,...n.style},ref:u,defaultValue:s})});Nt.displayName=rs;function Ct(t){return t===""||t===void 0}function jt(t){const s=$t(t),n=o.useRef(""),r=o.useRef(0),a=o.useCallback(i=>{const c=n.current+i;s(c),(function d(m){n.current=m,window.clearTimeout(r.current),m!==""&&(r.current=window.setTimeout(()=>d(""),1e3))})(c)},[s]),u=o.useCallback(()=>{n.current="",window.clearTimeout(r.current)},[]);return o.useEffect(()=>()=>window.clearTimeout(r.current),[]),[n,a,u]}function bt(t,s,n){const a=s.length>1&&Array.from(s).every(m=>m===s[0])?s[0]:s,u=n?t.indexOf(n):-1;let i=as(t,Math.max(u,0));a.length===1&&(i=i.filter(m=>m!==n));const d=i.find(m=>m.textValue.toLowerCase().startsWith(a.toLowerCase()));return d!==n?d:void 0}function as(t,s){return t.map((n,r)=>t[(s+r)%t.length])}var ls=Xe,Tt=et,is=nt,cs=st,ds=ot,It=rt,us=ct,Et=pt,Rt=ft,ps=ht,ms=gt,Pt=vt,_t=wt,Dt=yt;const fs=ls,hs=is,Ot=o.forwardRef(({className:t,children:s,...n},r)=>e.jsxs(Tt,{ref:r,className:G("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",t),...n,children:[s,e.jsx(cs,{asChild:!0,children:e.jsx(ze,{className:"h-4 w-4 opacity-50"})})]}));Ot.displayName=Tt.displayName;const At=o.forwardRef(({className:t,...s},n)=>e.jsx(Pt,{ref:n,className:G("flex cursor-default items-center justify-center py-1",t),...s,children:e.jsx(rn,{className:"h-4 w-4"})}));At.displayName=Pt.displayName;const Mt=o.forwardRef(({className:t,...s},n)=>e.jsx(_t,{ref:n,className:G("flex cursor-default items-center justify-center py-1",t),...s,children:e.jsx(ze,{className:"h-4 w-4"})}));Mt.displayName=_t.displayName;const kt=o.forwardRef(({className:t,children:s,position:n="popper",...r},a)=>e.jsx(ds,{children:e.jsxs(It,{ref:a,className:G("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",n==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:n,...r,children:[e.jsx(At,{}),e.jsx(us,{className:G("p-1",n==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:s}),e.jsx(Mt,{})]})}));kt.displayName=It.displayName;const xs=o.forwardRef(({className:t,...s},n)=>e.jsx(Et,{ref:n,className:G("py-1.5 pl-8 pr-2 text-sm font-semibold",t),...s}));xs.displayName=Et.displayName;const Lt=o.forwardRef(({className:t,children:s,...n},r)=>e.jsxs(Rt,{ref:r,className:G("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...n,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(ms,{children:e.jsx(Qe,{className:"h-4 w-4"})})}),e.jsx(ps,{children:s})]}));Lt.displayName=Rt.displayName;const gs=o.forwardRef(({className:t,...s},n)=>e.jsx(Dt,{ref:n,className:G("-mx-1 my-1 h-px bg-muted",t),...s}));gs.displayName=Dt.displayName;const vs=Le.VITE_INTERNAL_UI_TOKEN||"";function ws({tenantId:t,email:s,page:n}={}){return _e({queryKey:["users",{tenantId:t,email:s,page:n}],queryFn:async()=>{const r=await qe({data:{tenantId:t,email:s,page:n,uiToken:vs}});return{data:r.data??[],pagination:r.pagination}}})}function Ss({user:t,tenantId:s,isOpen:n,onClose:r,onSuccess:a}){const[u,i]=o.useState(""),[c,d]=o.useState("select"),{data:m,isLoading:g}=ws({tenantId:s}),v=Rn(),N=o.useMemo(()=>{const p=m?.data;return p?p.filter(S=>S.id!==t?.id):[]},[m,t]),w=o.useMemo(()=>N.find(p=>p.id===u),[N,u]),f=()=>{u&&d("confirm")},l=()=>{d("select")},h=async()=>{if(!(!t||!u))try{await v.mutateAsync({tenantId:s,fromUserId:t.id,toUserId:u}),i(""),d("select"),a?.(),r()}catch{}},y=()=>{i(""),d("select"),r()};return e.jsx(Ue,{open:n,onOpenChange:y,children:e.jsxs(Be,{className:"sm:max-w-md",children:[e.jsxs(Ve,{children:[e.jsxs(He,{className:"flex items-center gap-2",children:[e.jsx(je,{className:"h-5 w-5"}),"Transfer Ownership"]}),e.jsx(Fe,{children:c==="select"?"Select a new primary owner for this tenant.":"Review and confirm the ownership transfer."})]}),c==="select"?e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Current Owner"}),e.jsxs("div",{className:"flex items-center gap-3 rounded-md border bg-muted/50 px-3 py-2",children:[e.jsx("div",{className:"flex h-8 w-8 items-center justify-center rounded-full bg-primary/10",children:e.jsx(Nn,{className:"h-4 w-4 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium truncate",children:t?.name}),e.jsx("p",{className:"text-xs text-muted-foreground truncate",children:t?.email})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"New Owner"}),e.jsxs(fs,{value:u,onValueChange:i,disabled:g,children:[e.jsx(Ot,{children:e.jsx(hs,{placeholder:"Select a user…"})}),e.jsx(kt,{children:N.map(p=>e.jsx(Lt,{value:p.id,children:e.jsxs("div",{className:"flex flex-col items-start",children:[e.jsx("span",{className:"font-medium",children:p.name}),e.jsx("span",{className:"text-xs text-muted-foreground",children:p.email})]})},p.id))})]}),N.length===0&&!g&&e.jsx("p",{className:"text-xs text-muted-foreground",children:"No eligible users found. Add more users to this tenant first."})]}),e.jsxs(Ne,{variant:"info",className:"bg-blue-500/10 border-blue-500/20",children:[e.jsx(ke,{className:"h-4 w-4 text-blue-500"}),e.jsx(Ce,{className:"text-sm text-blue-700 dark:text-blue-300",children:"The selected user will receive an invitation to accept ownership. They must accept within 7 days."})]})]}):e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsx("div",{className:"rounded-lg border p-4 space-y-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"From"}),e.jsx("p",{className:"font-medium",children:t?.name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t?.email})]}),e.jsx(je,{className:"h-5 w-5 text-muted-foreground"}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"To"}),e.jsx("p",{className:"font-medium",children:w?.name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:w?.email})]})]})}),e.jsxs(Ne,{variant:"warning",children:[e.jsx(ke,{className:"h-4 w-4"}),e.jsx(Ce,{children:"After transfer, you will lose primary owner privileges for this tenant. This action requires the recipient's acceptance."})]})]}),e.jsx(Ke,{className:"gap-2 sm:gap-0",children:c==="select"?e.jsxs(e.Fragment,{children:[e.jsx(F,{variant:"outline",onClick:y,children:"Cancel"}),e.jsx(F,{onClick:f,disabled:!u,children:"Next"})]}):e.jsxs(e.Fragment,{children:[e.jsx(F,{variant:"outline",onClick:l,children:"Back"}),e.jsx(F,{onClick:h,disabled:v.isPending,className:"gap-2",children:v.isPending?"Sending…":e.jsxs(e.Fragment,{children:[e.jsx(Qe,{className:"h-4 w-4"}),"Send Invitation"]})})]})})]})})}const ys={active:{label:"Active",variant:"success"},pending:{label:"Pending",variant:"warning"},suspended:{label:"Suspended",variant:"destructive"}};function Ws(){const[t,s]=o.useState([]),[n,r]=o.useState(!0),[a,u]=o.useState(null),[i,c]=o.useState(null),[d,m]=o.useState(""),g=Jt(),v=en(qe);o.useEffect(()=>{(async()=>{r(!0);try{const l=await v({data:{page:1}});s(l.data||[])}catch{Se.error("Failed to load users")}finally{r(!1)}})()},[]);const N=[ln(),{accessorKey:"name",header:"User",cell:({row:f})=>{const l=f.original;return e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx("span",{className:"text-sm font-medium text-primary",children:l.name?.[0]||(l.email?l.email[0].toUpperCase():"?")})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:l.name||"Unnamed User"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:l.email??"unknown"})]})]})}},{accessorKey:"status",header:"Status",cell:({getValue:f})=>{const l=f(),h=ys[l]||{label:l,variant:"default"};return e.jsx(cn,{variant:h.variant,children:h.label})}},{id:"actions",header:"",cell:({row:f})=>{const l=f.original;return e.jsxs(fn,{children:[e.jsx(hn,{asChild:!0,children:e.jsx(F,{variant:"ghost",size:"icon-sm","aria-label":"Open user actions",children:e.jsx(xn,{className:"h-4 w-4"})})}),e.jsxs(gn,{align:"end",children:[e.jsxs(ye,{children:[e.jsx(Cn,{className:"mr-2 h-4 w-4"}),"Send Email"]}),e.jsxs(ye,{className:"text-destructive",onClick:()=>u({id:l.id??"",email:l.email??"unknown",name:l.name||void 0}),children:[e.jsx(jn,{className:"mr-2 h-4 w-4"}),"Delete"]}),e.jsxs(ye,{onClick:()=>{c({id:l.id??"",email:l.email??"unknown",name:l.name||void 0}),m("tenant-1")},children:[e.jsx(on,{className:"mr-2 h-4 w-4"}),"Transfer Ownership"]})]})]})}}],w={total:t.length||2480,active:t.filter(f=>f.status==="active").length||2100,pending:t.filter(f=>f.status==="pending").length||180,suspended:t.filter(f=>f.status==="suspended").length||45};return e.jsxs("div",{className:"space-y-6",children:[e.jsx(tn,{title:"Users",description:"Manage platform users across all tenants",breadcrumbs:[{label:"Users"}]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[{label:"Total Users",value:w.total,color:"blue"},{label:"Active",value:w.active,color:"green"},{label:"Pending",value:w.pending,color:"amber"},{label:"Suspended",value:w.suspended,color:"rose"}].map((f,l)=>e.jsx(nn.div,{initial:g?!1:{opacity:0,y:20},animate:{opacity:1,y:0},transition:g?{duration:0}:{delay:l*.1},children:e.jsxs(Ae,{className:"p-6 card-hover",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:f.label}),e.jsx("p",{className:"text-3xl font-bold mt-1",children:sn(f.value)})]})},f.label))}),e.jsx(Ae,{children:e.jsx(an,{columns:N,data:t,isLoading:n,searchable:!0,searchPlaceholder:"Search users by name or email…",pagination:!0,pageSize:10,exportable:!0,exportFileName:"users"})}),e.jsx(_n,{user:a,isOpen:!!a,onClose:()=>u(null),onSuccess:()=>{Se.success("User deleted successfully"),v({data:{page:1}}).then(f=>{s(f.data||[])})},onTransferOwnership:f=>{const l=t.find(h=>h.id===f);l&&(c({id:l.id??"",email:l.email??"unknown",name:l.name||void 0}),m("tenant-1"))}}),e.jsx(Ss,{user:i,tenantId:d,isOpen:!!i,onClose:()=>{c(null),m("")},onSuccess:()=>{Se.success("Ownership transfer request sent")}})]})}export{Ws as component};
