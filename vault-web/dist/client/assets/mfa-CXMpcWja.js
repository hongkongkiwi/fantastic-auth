import{j as e,_ as M,G as P,b as t,S as v,J as k,m as I,Z as H,ai as U}from"./main-BdAAzOp_.js";import{I as _}from"./Input-DmXcK8Ek.js";import{C as D,a as V,b as F,c as z,d as B}from"./Card-BgwA5byp.js";import{A as G,a as J}from"./Alert-DT3fX0Ix.js";import{T as K,a as O,b as u,c as W}from"./Tabs-c8LIGITi.js";import{u as Z,H as $,a as q,g as Q}from"./HostedLayout-C9ABfqpe.js";import{L as X}from"./lock-PhA2rBqp.js";import{C as Y}from"./circle-alert-DITzmtt1.js";import{M as C}from"./mail-nvpjyHZd.js";import{S as b}from"./smartphone-Dki1OkCf.js";import{A as ee}from"./arrow-left-BSUvyDQr.js";import"./index-TAemdWJe.js";import"./index-5WLq0AmM.js";const o={totp:{icon:v,title:"Authenticator App",description:"Enter the 6-digit code from your authenticator app",showResend:!1},email:{icon:C,title:"Email Code",description:"Enter the 6-digit code sent to your email",showResend:!0},sms:{icon:b,title:"SMS Code",description:"Enter the 6-digit code sent to your phone",showResend:!0}};function pe(){const x=Z();return e.jsx($,{searchParams:new URLSearchParams(window.location.search),children:e.jsx(se,{searchParams:x})})}function se({searchParams:x}){const S=M(),{config:R,tenantId:c,redirectUrl:d}=q(),T=P(),[m,l]=t.useState(!1),[f,a]=t.useState(null),[r,p]=t.useState(""),[g,E]=t.useState("totp"),[n,j]=t.useState(30),[i,N]=t.useState(!1),y=new URLSearchParams(window.location.search).get("mfa_token");if(t.useEffect(()=>{if(n>0&&!i){const s=setTimeout(()=>j(n-1),1e3);return()=>clearTimeout(s)}else n===0&&N(!0)},[n,i]),!R||!c)return null;if(!y)return S({to:"/hosted/sign-in",search:{tenant_id:c,redirect_url:d||void 0}}),null;const w=async()=>{if(r.length!==6){a("Please enter a 6-digit code");return}l(!0),a(null);try{const s=await Q({data:{code:r,method:g,mfaToken:y,tenantId:c,redirectUrl:d||void 0}});window.location.href=s.redirectUrl}catch(s){a(s instanceof Error?s.message:"Invalid verification code"),p("")}finally{l(!1)}},A=async()=>{if(i){l(!0),a(null);try{j(30),N(!1)}catch(s){a(s instanceof Error?s.message:"Failed to resend code")}finally{l(!1)}}};return e.jsxs(D,{className:"shadow-elevated",children:[e.jsxs(V,{className:"space-y-1",children:[e.jsx("div",{className:"mx-auto w-12 h-12 bg-primary/10 rounded-full flex items-center justify-center mb-2",children:e.jsx(X,{className:"h-6 w-6 text-primary"})}),e.jsx(F,{className:"text-2xl text-center",children:"Two-Factor Authentication"}),e.jsx(z,{className:"text-center",children:"Choose a verification method to continue"})]}),e.jsxs(B,{className:"space-y-4",children:[f&&e.jsxs(G,{variant:"destructive",children:[e.jsx(Y,{className:"h-4 w-4"}),e.jsx(J,{children:f})]}),e.jsxs(K,{value:g,onValueChange:s=>E(s),children:[e.jsxs(O,{className:"grid w-full grid-cols-3",children:[e.jsxs(u,{value:"totp",className:"gap-2",children:[e.jsx(v,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"App"})]}),e.jsxs(u,{value:"email",className:"gap-2",children:[e.jsx(C,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Email"})]}),e.jsxs(u,{value:"sms",className:"gap-2",children:[e.jsx(b,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"SMS"})]})]}),Object.keys(o).map(s=>{const L=o[s].icon;return e.jsx(W,{value:s,className:"mt-4 space-y-4",children:e.jsxs(k.div,{initial:T?!1:{opacity:0,y:10},animate:{opacity:1,y:0},className:"space-y-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 bg-primary/10 rounded-full flex items-center justify-center mx-auto mb-3",children:e.jsx(L,{className:"h-6 w-6 text-primary"})}),e.jsx("h3",{className:"font-semibold",children:o[s].title}),e.jsx("p",{className:"text-sm text-muted-foreground",children:o[s].description})]}),e.jsx("div",{className:"space-y-2",children:e.jsx(_,{type:"text",placeholder:"000000",value:r,onChange:h=>p(h.target.value.replace(/\D/g,"").slice(0,6)),className:"text-center text-2xl tracking-widest font-mono",maxLength:6,inputMode:"numeric",autoComplete:"one-time-code",autoFocus:!0,disabled:m,onKeyDown:h=>{h.key==="Enter"&&r.length===6&&w()}})}),e.jsx(I,{fullWidth:!0,size:"lg",isLoading:m,disabled:r.length!==6,onClick:w,rightIcon:e.jsx(H,{className:"h-4 w-4"}),children:"Verify"}),o[s].showResend&&e.jsx("div",{className:"text-center",children:e.jsx("button",{onClick:A,disabled:!i||m,className:"text-sm text-primary hover:underline disabled:text-muted-foreground disabled:no-underline disabled:cursor-not-allowed",children:i?"Resend code":`Resend code in ${n}s`})})]})},s)})]}),e.jsx("div",{className:"text-center pt-4 border-t",children:e.jsxs(U,{to:"/hosted/sign-in",search:{tenant_id:c,redirect_url:d||void 0},className:"inline-flex items-center gap-2 text-sm text-muted-foreground hover:text-foreground transition-colors",children:[e.jsx(ee,{className:"h-4 w-4"}),"Use a different sign-in method"]})})]})]})}export{pe as component};
