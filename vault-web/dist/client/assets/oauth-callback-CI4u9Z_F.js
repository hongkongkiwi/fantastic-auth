import{j as e,_,G as P,b as l,J as d,al as A,m as f,Z as I,ai as v}from"./main-BdAAzOp_.js";import{C as R,a as U,b as M,c as O,d as T}from"./Card-BgwA5byp.js";import{u as E,H,a as F,f as L}from"./HostedLayout-C9ABfqpe.js";import{C as q}from"./circle-check-big-BtZ3JG_-.js";import{C as W}from"./circle-x-SXQhcWML.js";import"./Alert-DT3fX0Ix.js";import"./circle-alert-DITzmtt1.js";function $(){const x=E();return e.jsx(H,{searchParams:new URLSearchParams(window.location.search),children:e.jsx(B,{searchParams:x})})}function B({searchParams:x}){const w=_(),{config:u,tenantId:s,redirectUrl:i}=F(),m=P(),[t,r]=l.useState("processing"),[C,o]=l.useState(null),[n,N]=l.useState(!1),[g,b]=l.useState(null);if(l.useEffect(()=>{const c=new URLSearchParams(window.location.search),p=c.get("code"),h=c.get("state"),j=c.get("error"),k=c.get("error_description");if(j){r("error"),o(k||`OAuth error: ${j}`);return}if(!s){r("error"),o("Missing tenant_id parameter");return}if(!p||!h){r("error"),o("Invalid OAuth callback: missing code or state");return}const y=sessionStorage.getItem("hosted_oauth_state");if(y&&y!==h){r("error"),o("Invalid state parameter. Possible CSRF attack.");return}sessionStorage.removeItem("hosted_oauth_state"),(async()=>{try{const a=await L({data:{code:p,state:h,tenantId:s,redirectUrl:i||void 0}});if(a.requiresMfa&&a.mfaToken){N(!0),b(a.mfaToken),r("success");return}r("success"),setTimeout(()=>{window.location.href=a.redirectUrl},1500)}catch(a){r("error"),o(a instanceof Error?a.message:"OAuth authentication failed")}})()},[s,i]),!u||!s)return null;const S=()=>{if(n&&g)w({to:"/hosted/mfa",search:{tenant_id:s,mfa_token:g,redirect_url:i||void 0}});else{const c=i||u.afterSignInUrl||"/hosted/sign-in";window.location.href=c}};return e.jsxs(R,{className:"shadow-elevated",children:[e.jsxs(U,{className:"space-y-1",children:[e.jsxs(M,{className:"text-2xl text-center",children:[t==="processing"&&"Completing Sign In...",t==="success"&&n&&"Additional Verification Required",t==="success"&&!n&&"Sign In Successful!",t==="error"&&"Sign In Failed"]}),e.jsxs(O,{className:"text-center",children:[t==="processing"&&"Please wait while we complete the authentication...",t==="success"&&n&&"Please verify your identity to continue.",t==="success"&&!n&&"Redirecting you to your account...",t==="error"&&"We couldn't complete the sign in process."]})]}),e.jsxs(T,{className:"space-y-6",children:[t==="processing"&&e.jsxs(d.div,{initial:m?!1:{opacity:0},animate:{opacity:1},className:"flex flex-col items-center py-8",children:[e.jsx("div",{className:"w-16 h-16 bg-primary/10 rounded-full flex items-center justify-center mb-4",children:e.jsx(A,{className:"w-8 h-8 text-primary animate-spin"})}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Exchanging authorization code..."})]}),t==="success"&&e.jsxs(d.div,{initial:m?!1:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"text-center space-y-6 py-4",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 dark:bg-green-900/20 rounded-full flex items-center justify-center mx-auto",children:e.jsx(q,{className:"w-8 h-8 text-green-600 dark:text-green-400"})}),n?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"For added security, we need to verify your identity with multi-factor authentication."}),e.jsx(f,{onClick:S,fullWidth:!0,rightIcon:e.jsx(I,{className:"h-4 w-4"}),children:"Continue to Verification"})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"You're being redirected to your account..."}),e.jsx("div",{className:"w-full bg-muted rounded-full h-2 overflow-hidden",children:e.jsx(d.div,{initial:{width:"0%"},animate:{width:"100%"},transition:{duration:1.5,ease:"easeInOut"},className:"h-full bg-primary"})})]})]}),t==="error"&&e.jsxs(d.div,{initial:m?!1:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"text-center space-y-6 py-4",children:[e.jsx("div",{className:"w-16 h-16 bg-destructive/10 rounded-full flex items-center justify-center mx-auto",children:e.jsx(W,{className:"w-8 h-8 text-destructive"})}),e.jsx("div",{className:"bg-destructive/5 border border-destructive/20 rounded-lg p-4",children:e.jsx("p",{className:"text-sm text-destructive",children:C||"An unexpected error occurred"})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(v,{to:"/hosted/sign-in",search:{tenant_id:s,redirect_url:i||void 0},className:"block",children:e.jsx(f,{fullWidth:!0,children:"Try Again"})}),u.allowSignUp&&e.jsx(v,{to:"/hosted/sign-up",search:{tenant_id:s,redirect_url:i||void 0},className:"block",children:e.jsx(f,{variant:"outline",fullWidth:!0,children:"Create Account"})})]})]})]})]})}export{$ as component};
